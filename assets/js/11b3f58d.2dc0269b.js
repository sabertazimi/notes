"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["14228"],{51931(e,n,l){l.r(n),l.d(n,{metadata:()=>i,default:()=>h,frontMatter:()=>s,contentTitle:()=>c,toc:()=>a,assets:()=>d});var i=JSON.parse('{"id":"cs/os/architecture","title":"Architecture","description":"\u6D6E\u70B9\u6570","source":"@site/content/cs/os/architecture.md","sourceDirName":"cs/os","slug":"/cs/os/architecture","permalink":"/notes/cs/os/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/cs/os/architecture.md","tags":[{"inline":true,"label":"CS","permalink":"/notes/tags/cs"},{"inline":true,"label":"System","permalink":"/notes/tags/system"},{"inline":true,"label":"OS","permalink":"/notes/tags/os"},{"inline":true,"label":"Architecture","permalink":"/notes/tags/architecture"},{"inline":true,"label":"Optimization","permalink":"/notes/tags/optimization"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"tags":["CS","System","OS","Architecture","Optimization"]},"sidebar":"tutorialSidebar","previous":{"title":"Boot","permalink":"/notes/cs/os/boot"},"next":{"title":"Process","permalink":"/notes/cs/os/process"}}'),t=l(62615),r=l(30416);let s={sidebar_position:3,tags:["CS","System","OS","Architecture","Optimization"]},c="Architecture",d={},a=[{value:"\u6D6E\u70B9\u6570",id:"\u6D6E\u70B9\u6570",level:2},{value:"Stack Frame",id:"stack-frame",level:2},{value:"Control Signal",id:"control-signal",level:2},{value:"Special",id:"special",level:3},{value:"Procedure",id:"procedure",level:3},{value:"Forwarding",id:"forwarding",level:2},{value:"Exception",id:"exception",level:2},{value:"Efficiency",id:"efficiency",level:2},{value:"Optimization",id:"optimization",level:2},{value:"Principles",id:"principles",level:3},{value:"Replacement",id:"replacement",level:3},{value:"Branching",id:"branching",level:3},{value:"Code Motion",id:"code-motion",level:3},{value:"Unrolling",id:"unrolling",level:3}];function o(e){let n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,t.jsx)(n.h2,{id:"\u6D6E\u70B9\u6570",children:"\u6D6E\u70B9\u6570"}),"\n",(0,t.jsxs)(n.p,{children:["\u89C4\u683C\u5316\u6D6E\u70B9\u6570: 1.xxx _ 2^(exp - 127) - e.g. ",(0,t.jsx)(n.code,{children:"5 = 5.0 = 1.25 _ 2^(129 - 127)"})]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"xxx: \u5C3E\u6570"}),"\n",(0,t.jsx)(n.li,{children:"exp: \u9636\u7801"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"stack-frame",children:"Stack Frame"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Stack Frame",src:l(76968).A+"",title:"Stack Frame",width:"285",height:"379"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-cpp",children:"# \u51C6\u5907\u9636\u6BB5\n# Caller-Save: %eax %ecx %edx\n# Callee-Save: %ebx %esi %edi\n# \u4F20\u53C2\u987A\u5E8F: rdi, dsi, rdx, rcx, r8, r9, stack\n\npushl %ebp\nmovl %esp, %ebp\npushl %ebx\n\n# \u7ED3\u675F\u9636\u6BB5\n\nmovl -4(%ebp), %ebx\nmovl %ebp, %esp\npopl %ebp\nret\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"x86_64"}),": \u53EF\u4F7F\u7528\u8D85\u51FA Stack Pointer 128 bytes \u7684\u5185\u5B58\u533A\u57DF, \u79F0\u4E3A Red Zone."]}),"\n",(0,t.jsx)(n.h2,{id:"control-signal",children:"Control Signal"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"State"}),(0,t.jsx)(n.th,{style:{textAlign:"left"},children:"Signal"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Fetch"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"icode,ifun rA,rB valC,valP"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Decode"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"valA,srcA valB,srcB"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Execute"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"valE Condition"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"Memory"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"valM read/write"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"WriteBack"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"E port,dstE M port,dstM"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"PCUpdate"}),(0,t.jsx)(n.td,{style:{textAlign:"left"},children:"PC"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"special",children:"Special"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["handle ret: ",(0,t.jsx)(n.code,{children:"IRET in {D_icode, E_icode, M_icode}"})]}),"\n",(0,t.jsxs)(n.li,{children:["load/use hazard: ",(0,t.jsx)(n.code,{children:"E_icode in {IMRMOVL, IPOPL} && E_dstM in {d_srcA, d_srcB}"})]}),"\n",(0,t.jsxs)(n.li,{children:["mispredicted branch: ",(0,t.jsx)(n.code,{children:"E_icode in {IJXX} && !e_Cnd"})]}),"\n",(0,t.jsxs)(n.li,{children:["exception: ",(0,t.jsx)(n.code,{children:"m_stat in {SADR, SINS, SHLT} || W_stat in {SADR, SINS, SHLT}"})]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"procedure",children:"Procedure"}),"\n",(0,t.jsx)(n.p,{children:"Branch, Loop, Jump:"}),"\n",(0,t.jsxs)(n.p,{children:["PrectPC | ",(0,t.jsx)(n.code,{children:"W_valM"}),"(\u65E0\u6CD5\u9884\u6D4B) | ",(0,t.jsx)(n.code,{children:"M_valP/M_valA"}),"\n(\u5728\u8BD1\u7801\u9636\u6BB5\u5408\u5E76\u4FE1\u53F7\u91CF valA \u4E0E valP: PCUpdate \u4F4D\u4E8E Fetch,\u65E0\u9700\u4F20\u9012 valP, \u53EA\u5269 call/jump \u9700\u8981 valP)"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"AT: always taken"}),"\n",(0,t.jsx)(n.li,{children:"NT: never taken"}),"\n",(0,t.jsx)(n.li,{children:"BTFNT: backward taken forward not taken"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"forwarding",children:"Forwarding"}),"\n",(0,t.jsx)(n.p,{children:"\u6D41\u6C34\u7EBF\u4E2D\u6700\u65E9\u9636\u6BB5\u7684\u8F6C\u53D1\u6E90, \u4F18\u5148\u7EA7\u6700\u9AD8 execute > memory > write"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-verilog",children:"int d_valA = [\n    D_icode in {ICALL, IJXX}: D_valP;\n\n    d_srcA == e_dstE : e_valE;\n    d_srcA == M_dstM : m_valM;\n    d_srcA == M_dstE : M_valE;\n    d_srcA == W_dstM : W_valM;\n    d_srcA == W_dstE : W_valE;\n\n    # register file\n    1 : d_rvalA;\n];\n"})}),"\n",(0,t.jsx)(n.h2,{id:"exception",children:"Exception"}),"\n",(0,t.jsx)(n.p,{children:"\u6D41\u6C34\u7EBF\u4E2D\u6700\u6DF1\u7684\u6307\u4EE4\u5F15\u8D77\u7684\u5F02\u5E38, \u4F18\u5148\u7EA7\u6700\u9AD8 e.g. \u8BBF\u5B58\u9636\u6BB5\u5730\u5740\u8D8A\u754C\u5F02\u5E38\u4F18\u5148\u7EA7\u9AD8\u4E8E\u53D6\u6307\u9636\u6BB5\u5730\u5740\u8D8A\u754C\u5F02\u5E38\u4F18\u5148\u7EA7"}),"\n",(0,t.jsx)(n.h2,{id:"efficiency",children:"Efficiency"}),"\n",(0,t.jsx)(n.p,{children:"CPI = 1.0 + lp + mp + rp:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"lp: load penalty(load/use hazard)"}),"\n",(0,t.jsx)(n.li,{children:"mp: mispredicted branch penalty"}),"\n",(0,t.jsx)(n.li,{children:"rp: return penalty"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"optimization",children:"Optimization"}),"\n",(0,t.jsx)(n.h3,{id:"principles",children:"Principles"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5408\u9002\u7684\u7B97\u6CD5\u548C\u6570\u636E\u7ED3\u6784"}),"\n",(0,t.jsx)(n.li,{children:"\u7F16\u5199\u7F16\u8BD1\u5668\u80FD\u591F\u6709\u6548\u4F18\u5316\u7684\u4EE3\u7801 e.g. \u5BC4\u5B58\u5668\u522B\u540D,\u5B58\u50A8\u5668\u522B\u540D,\u51FD\u6570\u7684\u526F\u4F5C\u7528 \u5BFC\u81F4\u7F16\u8BD1\u5668\u65E0\u6CD5(\u4E0D\u6562)\u5408\u5E76/\u5220\u9664\u5197\u4F59\u4EE3\u7801"}),"\n",(0,t.jsx)(n.li,{children:"\u63D0\u9AD8\u4EE3\u7801\u7684\u5E76\u884C\u6027"}),"\n",(0,t.jsx)(n.li,{children:"\u6D88\u9664\u4E0D\u5FC5\u8981\u7684\u8BBF\u5B58 e.g. \u591A\u6B21\u8BBF\u5B58(\u53EF\u7528\u4E2D\u95F4\u91CF\u4F18\u5316), \u591A\u6B21\u51FD\u6570\u8C03\u7528(\u53EF\u7528\u5B8F/\u5185\u8054\u51FD\u6570\u4F18\u5316)"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"replacement",children:"Replacement"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u7528\u591A\u6761 Shift/Add/Sub \u6307\u4EE4, \u4EE3\u66FF Mul/Div"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"branching",children:"Branching"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5229\u7528\u6761\u4EF6\u8868\u8FBE\u5F0F\u4EE3\u66FF\u6761\u4EF6\u5206\u652F\u8BED\u53E5: \u964D\u4F4E\u9884\u6D4B\u9519\u8BEF\u60E9\u7F5A"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"code-motion",children:"Code Motion"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5C06\u4E0D\u53D8\u6D4B\u8BD5\u6761\u4EF6/\u5E38\u53D8\u91CF\u7684\u8BA1\u7B97\u4ECE\u5FAA\u73AF\u4E2D\u79FB\u51FA"}),"\n",(0,t.jsx)(n.li,{children:"\u5C06\u591A\u6B21\u8BBF\u5B58\u5229\u7528\u4E2D\u95F4\u81EA\u52A8/\u5BC4\u5B58\u5668\u53D8\u91CF\u6539\u5199\u6210\u4E00\u6B21\u8BBF\u5B58"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"unrolling",children:"Unrolling"}),"\n",(0,t.jsx)(n.p,{children:"\u5FAA\u73AF\u5C55\u5F00 (Duff's Device), \u589E\u5927\u5FAA\u73AF\u7684\u6B65\u957F, e.g. \u4EE5 7 \u4E3A\u6B65\u957F:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u63D0\u5347\u5FAA\u73AF\u7684\u8FD0\u884C\u6548\u7387"}),"\n",(0,t.jsx)(n.li,{children:"\u4E00\u6B21\u5FAA\u73AF\u5185: \u53EF\u5148\u5C06\u6240\u6709\u6570\u636E\u5148\u8BFB\u51FA\u6765(Memory State),\u5C06\u8FDB\u884C\u8BA1\u7B97(Execute State), \u4ECE\u800C\u6D88\u9664 Load/Use \u5192\u9669\u800C\u4EA7\u751F\u7684 Bubble"}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},76968(e,n,l){l.d(n,{A:()=>i});let i=l.p+"assets/images/stack-frame-f7e50238d6d113acc092a71f5faa6d62.png"},30416(e,n,l){l.d(n,{R:()=>s,x:()=>c});var i=l(59471);let t={},r=i.createContext(t);function s(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:s(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);