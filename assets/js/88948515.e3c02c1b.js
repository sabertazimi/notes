"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["97807"],{8414(e,n,i){i.r(n),i.d(n,{metadata:()=>r,default:()=>h,frontMatter:()=>l,contentTitle:()=>c,toc:()=>o,assets:()=>d});var r=JSON.parse('{"id":"web/network/http-2","title":"HTTP 2","description":"\u5728 HTTP/1.x \u4E2D, \u6BCF\u6B21\u8BF7\u6C42\u90FD\u4F1A\u5EFA\u7ACB\u4E00\u6B21 HTTP \u8FDE\u63A5:","source":"@site/content/web/network/http-2.md","sourceDirName":"web/network","slug":"/web/network/http-2","permalink":"/notes/web/network/http-2","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/network/http-2.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Network","permalink":"/notes/tags/network"},{"inline":true,"label":"HTTP","permalink":"/notes/tags/http"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":3,"frontMatter":{"sidebar_position":3,"tags":["Web","Network","HTTP"]},"sidebar":"tutorialSidebar","previous":{"title":"HTTP","permalink":"/notes/web/network/http"},"next":{"title":"HTTPS","permalink":"/notes/web/network/https"}}'),s=i(62615),t=i(30416);let l={sidebar_position:3,tags:["Web","Network","HTTP"]},c="HTTP 2",d={},o=[{value:"Optimization",id:"optimization",level:2},{value:"HTTP 3",id:"http-3",level:2}];function a(e){let n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"http-2",children:"HTTP 2"})}),"\n",(0,s.jsx)(n.p,{children:"\u5728 HTTP/1.x \u4E2D, \u6BCF\u6B21\u8BF7\u6C42\u90FD\u4F1A\u5EFA\u7ACB\u4E00\u6B21 HTTP \u8FDE\u63A5:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4E32\u884C\u7684\u6587\u4EF6\u4F20\u8F93. \u5F53\u8BF7\u6C42 a \u6587\u4EF6\u65F6, b \u6587\u4EF6\u53EA\u80FD\u7B49\u5F85."}),"\n",(0,s.jsx)(n.li,{children:"\u8FDE\u63A5\u6570\u8FC7\u591A."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"HTTP/2 \u7684\u591A\u8DEF\u590D\u7528\u5C31\u662F\u4E3A\u4E86\u89E3\u51B3\u4E0A\u8FF0\u7684\u4E24\u4E2A\u6027\u80FD\u95EE\u9898.\n\u5728 HTTP/2 \u4E2D, \u6709\u4E24\u4E2A\u975E\u5E38\u91CD\u8981\u7684\u6982\u5FF5, \u5206\u522B\u662F\u5E27 (frame) \u548C\u6D41 (stream).\n\u5E27\u4EE3\u8868\u7740\u6700\u5C0F\u7684\u6570\u636E\u5355\u4F4D, \u6BCF\u4E2A\u5E27\u4F1A\u6807\u8BC6\u51FA\u8BE5\u5E27\u5C5E\u4E8E\u54EA\u4E2A\u6D41, \u6D41\u4E5F\u5C31\u662F\u591A\u4E2A\u5E27\u7EC4\u6210\u7684\u6570\u636E\u6D41.\n\u591A\u8DEF\u590D\u7528, \u5C31\u662F\u5728\u4E00\u4E2A TCP \u8FDE\u63A5\u4E2D\u53EF\u4EE5\u5B58\u5728\u591A\u6761\u6D41, \u907F\u514D\u961F\u5934\u963B\u585E\u95EE\u9898\u548C\u8FDE\u63A5\u6570\u8FC7\u591A\u95EE\u9898."}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"HTTP 2.0 Binary Frame",src:i(6760).A+"",title:"HTTP 2.0 Binary Frame",width:"1812",height:"934"})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.img,{alt:"HTTP 2.0 Stream",src:i(91687).A+"",title:"HTTP 2.0 Stream",width:"1202",height:"933"})}),"\n",(0,s.jsxs)(n.p,{children:["HTTP/2 = ",(0,s.jsx)(n.code,{children:"HTTP"})," + ",(0,s.jsx)(n.code,{children:"HPack / Stream"})," + ",(0,s.jsx)(n.code,{children:"TLS 1.2+"})," + ",(0,s.jsx)(n.code,{children:"TCP"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"HTTP 2.0 \u7684\u4E3B\u8981\u76EE\u6807\u662F\u6539\u8FDB\u4F20\u8F93\u6027\u80FD, \u5B9E\u73B0\u4F4E\u5EF6\u8FDF\u548C\u9AD8\u541E\u5410\u91CF."}),"\n",(0,s.jsx)(n.li,{children:"\u4E8C\u8FDB\u5236\u4F20\u8F93 (\u4E71\u5E8F\u4E8C\u8FDB\u5236\u5E27 Stream):\nHTTP/1.1 \u4E0D\u662F\u4E8C\u8FDB\u5236\u4F20\u8F93, \u800C\u662F\u901A\u8FC7\u6587\u672C\u8FDB\u884C\u4F20\u8F93.\n\u7531\u4E8E\u6CA1\u6709\u6D41\u7684\u6982\u5FF5, \u5728\u5E76\u884C\u4F20\u8F93\u6570\u636E\u65F6,\n\u63A5\u6536\u7AEF\u65E0\u6CD5\u533A\u5206\u591A\u4E2A\u54CD\u5E94\u5206\u522B\u5BF9\u5E94\u7684\u8BF7\u6C42,\n\u65E0\u6CD5\u5C06\u591A\u4E2A\u54CD\u5E94\u7684\u7ED3\u679C\u91CD\u65B0\u8FDB\u884C\u7EC4\u88C5,\n\u65E0\u6CD5\u5B9E\u73B0\u591A\u8DEF\u590D\u7528."}),"\n",(0,s.jsx)(n.li,{children:"Multiplexing (\u591A\u8DEF\u590D\u7528): more parallelized requests."}),"\n",(0,s.jsxs)(n.li,{children:["Header compression (HPack): \u964D\u4F4E\u534F\u8BAE\u5B57\u8282\u5F00\u9500\u5360\u6BD4 (\u5C24\u5176\u662F ",(0,s.jsx)(n.code,{children:"Cookie"})," \u5E26\u6765\u7684\u6027\u80FD\u74F6\u9888)."]}),"\n",(0,s.jsxs)(n.li,{children:["\u53CC\u5411\u6D41\u91CF\u63A7\u5236 (",(0,s.jsx)(n.code,{children:"WINDOW_UPDATE"})," \u5E27\u66F4\u65B0)."]}),"\n",(0,s.jsxs)(n.li,{children:["Server push:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5BA2\u6237\u7AEF\u53EF\u4EE5\u7F13\u5B58\u63A8\u9001\u8FC7\u6765\u7684\u8D44\u6E90."}),"\n",(0,s.jsx)(n.li,{children:"\u5BA2\u6237\u7AEF\u53EF\u4EE5\u62D2\u7EDD\u63A8\u9001\u8FC7\u6765\u7684\u8D44\u6E90."}),"\n",(0,s.jsx)(n.li,{children:"\u63A8\u9001\u8D44\u6E90\u53EF\u4EE5\u7531\u4E0D\u540C\u7684\u9875\u9762\u5171\u4EAB."}),"\n",(0,s.jsx)(n.li,{children:"\u670D\u52A1\u5668\u53EF\u4EE5\u6309\u7167\u4F18\u5148\u7EA7\u63A8\u9001\u8D44\u6E90."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"HTTPS guaranteed: \u4E8B\u5B9E\u52A0\u5BC6 (Chrome/Firefox \u53EA\u652F\u6301 HTTP/2 over TLS 1.2+)."}),"\n"]}),"\n",(0,s.jsxs)(n.admonition,{title:"Cons",type:"caution",children:[(0,s.jsxs)(n.p,{children:["HTTP/2 \u867D\u7136\u901A\u8FC7\u591A\u8DEF\u590D\u7528\u89E3\u51B3\u4E86 HTTP \u5C42\u7684\u961F\u5934\u963B\u585E,\n\u4F46\u4ECD\u7136\u5B58\u5728 TCP \u5C42\u7684\u961F\u5934\u963B\u585E (",(0,s.jsx)(n.code,{children:"Head-of-line Blocking"}),"):"]}),(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7531\u4E8E TCP \u4E0D\u652F\u6301\u4E71\u5E8F\u786E\u8BA4, \u5F53\u6CA1\u6709\u6536\u5230\u961F\u5934 (\u6ED1\u52A8\u7A97\u53E3\u6700\u5DE6\u7AEF) \u7684 ACK \u786E\u8BA4\u62A5\u6587\u65F6,\n\u53D1\u9001\u7A97\u53E3\u65E0\u6CD5\u5F80\u524D\u79FB\u52A8, \u6B64\u65F6\u53D1\u9001\u65B9\u5C06\u65E0\u6CD5\u7EE7\u7EED\u53D1\u9001\u540E\u9762\u7684\u6570\u636E, \u4EA7\u751F\u53D1\u9001\u7A97\u53E3\u7684\u961F\u5934\u963B\u585E\u95EE\u9898."}),"\n",(0,s.jsx)(n.li,{children:"\u540C\u6837\u5730, \u5F53\u63A5\u6536\u7A97\u53E3\u63A5\u6536\u6709\u5E8F\u6570\u636E\u65F6, \u5F53\u6CA1\u6709\u6536\u5230\u961F\u5934 (\u6ED1\u52A8\u7A97\u53E3\u6700\u5DE6\u7AEF) \u7684\u6570\u636E\u65F6,\n\u63A5\u6536\u7A97\u53E3\u65E0\u6CD5\u5F80\u524D\u79FB\u52A8, \u6B64\u65F6\u63A5\u6536\u65B9\u5C06\u76F4\u63A5\u4E22\u5F03\u6240\u6709\u6ED1\u52A8\u7A97\u53E3\u53F3\u4FA7\u7684\u6570\u636E, \u4EA7\u751F\u63A5\u6536\u7A97\u53E3\u7684\u961F\u5934\u963B\u585E\u95EE\u9898."}),"\n"]}),(0,s.jsx)(n.p,{children:"QUIC (Quick UDP Internet Connections)\n\u7ED9\u6BCF\u4E00\u4E2A Stream \u90FD\u5206\u914D\u4E86\u4E00\u4E2A\u72EC\u7ACB\u7684\u6ED1\u52A8\u7A97\u53E3,\n\u4F7F\u5F97\u4E00\u4E2A\u8FDE\u63A5\u4E0A\u7684\u591A\u4E2A Stream \u4E4B\u95F4\u6CA1\u6709\u4F9D\u8D56\u5173\u7CFB,\n\u62E5\u6709\u76F8\u4E92\u72EC\u7ACB\u5404\u81EA\u63A7\u5236\u7684\u6ED1\u52A8\u7A97\u53E3."})]}),"\n",(0,s.jsx)(n.h2,{id:"optimization",children:"Optimization"}),"\n",(0,s.jsx)(n.p,{children:"HTTP 2 performance:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Reducing HTTP requests:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u91CD\u7528 TCP \u8FDE\u63A5."}),"\n",(0,s.jsx)(n.li,{children:"\u591A\u8DEF\u590D\u7528."}),"\n",(0,s.jsx)(n.li,{children:"\u51CF\u5C11\u4F20\u8F93\u5197\u4F59\u8D44\u6E90."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Caching and reducing DNS lookups:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Remove too much domains."}),"\n",(0,s.jsx)(n.li,{children:"HTML5 DNS prefetch."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"Avoid HTTP redirects."}),"\n",(0,s.jsx)(n.li,{children:"CDN: minimize RTT."}),"\n",(0,s.jsx)(n.li,{children:"Web caches."}),"\n",(0,s.jsx)(n.li,{children:"Resources minification."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Due to asset granularity and ",(0,s.jsx)(n.strong,{children:"caching effectiveness"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"No need for \u57DF\u540D\u5206\u533A (no need for multiple HTTP connection)."}),"\n",(0,s.jsx)(n.li,{children:"No need for CSS/Image sprites."}),"\n",(0,s.jsx)(n.li,{children:"Less need for resources bundling and inlining."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"http-3",children:"HTTP 3"}),"\n",(0,s.jsxs)(n.p,{children:["HTTP/3 = ",(0,s.jsx)(n.code,{children:"HTTP"})," + ",(0,s.jsx)(n.code,{children:"QPack / Stream"})," + ",(0,s.jsx)(n.code,{children:"QUIC / TLS 1.3+"})," + ",(0,s.jsx)(n.code,{children:"UDP"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["QUIC \u5B9E\u73B0\u5FEB\u901F\u63E1\u624B, \u89E3\u51B3\u591A\u6B21\u63E1\u624B\u9AD8\u5EF6\u8FDF\u95EE\u9898:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Establishing connection in HTTP/2 requires 3 RTT."}),"\n",(0,s.jsx)(n.li,{children:"Establishing connection in HTTP/3 only requires 2 RTT."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"QUIC \u534F\u8BAE\u4FDD\u8BC1\u4F20\u8F93\u53EF\u9760: packet loss handling."}),"\n",(0,s.jsxs)(n.li,{children:["QUIC \u7ED9\u6BCF\u4E2A\u8BF7\u6C42\u6D41 (Stream ID) \u90FD\u5206\u914D\u4E00\u4E2A\u72EC\u7ACB\u7684\u6ED1\u52A8\u7A97\u53E3, \u540C\u65F6\u8FDB\u884C\u961F\u5934\u538B\u7F29,\n\u5B9E\u73B0\u4F20\u8F93\u5C42",(0,s.jsx)(n.strong,{children:"\u65E0\u961F\u5934\u963B\u585E\u7684\u591A\u8DEF\u590D\u7528"}),", \u89E3\u51B3\u961F\u5934 (\u6570\u636E\u91CD\u4F20) \u963B\u585E (\u540E\u7EED\u6570\u636E) \u95EE\u9898:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Stream prioritization."}),"\n",(0,s.jsx)(n.li,{children:"Header compression."}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:"QUIC \u96C6\u6210 TLS \u52A0\u5BC6."}),"\n",(0,s.jsx)(n.li,{children:"HTTP/3 brings tunable congestion control and connection migration."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["For a new domain,\nbrowser connects using H/1 or H/2.\nServer sends back an ",(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/HTTP/Headers/Alt-Svc",children:(0,s.jsx)(n.code,{children:"alternative services"})}),"\nheader indicating H/3 support.\nBrowser stores ",(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/HTTP/Headers/Alt-Svc",children:(0,s.jsx)(n.code,{children:"alt-svc"})}),"\ninfo in alt-svc cache.\nFrom then on,\nbrowser tries HTTP/3 in parallel with HTTP/1 and 2\nso that there's an immediate fallback if network blocks."]})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},6760(e,n,i){i.d(n,{A:()=>r});let r=i.p+"assets/images/http2-binary-frame-405c19f70090269c76c16dbb78b4199c.png"},91687(e,n,i){i.d(n,{A:()=>r});let r=i.p+"assets/images/http2-stream-fb882d140874620a1e2f8f861a95bf57.png"},30416(e,n,i){i.d(n,{R:()=>l,x:()=>c});var r=i(59471);let s={},t=r.createContext(s);function l(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:l(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);