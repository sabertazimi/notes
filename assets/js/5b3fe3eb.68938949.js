"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["59489"],{58947(e,n,i){i.r(n),i.d(n,{metadata:()=>s,default:()=>d,frontMatter:()=>t,contentTitle:()=>c,toc:()=>p,assets:()=>r});var s=JSON.parse('{"id":"programming/linux/ffmpeg","title":"FFmpeg","description":"Media conversion:","source":"@site/content/programming/linux/ffmpeg.md","sourceDirName":"programming/linux","slug":"/programming/linux/ffmpeg","permalink":"/notes/programming/linux/ffmpeg","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/programming/linux/ffmpeg.md","tags":[{"inline":true,"label":"Programming","permalink":"/notes/tags/programming"},{"inline":true,"label":"Linux","permalink":"/notes/tags/linux"},{"inline":true,"label":"Media","permalink":"/notes/tags/media"},{"inline":true,"label":"Video","permalink":"/notes/tags/video"},{"inline":true,"label":"FFmpeg","permalink":"/notes/tags/f-fmpeg"}],"version":"current","lastUpdatedBy":"sabertazimi","lastUpdatedAt":1772125331000,"sidebarPosition":32,"frontMatter":{"sidebar_position":32,"tags":["Programming","Linux","Media","Video","FFmpeg"]},"sidebar":"tutorialSidebar","previous":{"title":"ImageMagick","permalink":"/notes/programming/linux/image"},"next":{"title":"Arch Linux","permalink":"/notes/programming/linux/arch"}}'),l=i(62615),a=i(30416);let t={sidebar_position:32,tags:["Programming","Linux","Media","Video","FFmpeg"]},c="FFmpeg",r={},p=[{value:"Probe",id:"probe",level:2},{value:"Transform",id:"transform",level:2},{value:"Cutting",id:"cutting",level:2},{value:"Mixing",id:"mixing",level:2},{value:"Screenshot",id:"screenshot",level:2},{value:"Gif",id:"gif",level:2},{value:"Subtitle",id:"subtitle",level:2},{value:"Watermark",id:"watermark",level:2},{value:"Desktop Recording",id:"desktop-recording",level:2},{value:"Live Streaming",id:"live-streaming",level:2}];function o(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"ffmpeg",children:"FFmpeg"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"sudo pacman -S ffmpeg\n"})}),"\n",(0,l.jsxs)(n.p,{children:[(0,l.jsx)(n.a,{href:"https://web.dev/media-conversion",children:"Media conversion"}),":"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# https://www.yanxurui.cc/posts/tool/2017-10-07-use-ffmpeg-to-edit-video\nffmpeg -global_options -input_1_options -i input_1 -input_2_options -i input_2 \\\n  -output_1_options output_1 ...\n"})}),"\n",(0,l.jsx)(n.h2,{id:"probe",children:"Probe"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ffprobe input.mp4\nffmpeg -hide_banner -i input.mkv\n"})}),"\n",(0,l.jsx)(n.h2,{id:"transform",children:"Transform"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"MP4"}),": ",(0,l.jsx)(n.code,{children:"H264"}),"Video + ",(0,l.jsx)(n.code,{children:"AAC"}),"Audio"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"WebM"}),": ",(0,l.jsx)(n.code,{children:"VP8"}),"Video + ",(0,l.jsx)(n.code,{children:"Vorbis"}),"Audio"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"OGG"}),": ",(0,l.jsx)(n.code,{children:"Theora"}),"Video + ",(0,l.jsx)(n.code,{children:"Vorbis"}),"Audio"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# code decoder information\nffmpeg -codecs\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# mkv to mp4\nffmpeg -i input.mkv -codec copy output.mp4\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# compress\nffmpeg -i input.mkv -c copy -c:v libx264 -vf scale=-2:720 output.mkv\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# make mkv with video and subtitle\nffmpeg -i input.avi -i input.srt \\\n  -map 0:0 -map 0:1 -map 1:0 -c:v libx264 -c:a aac -c:s srt output.mkv\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# flac to mp3\nffmpeg -i "Michael Jackson - Billie Jean.flac" \\\n  -ab 320k "Michael Jackson - Billie Jean.mp3"\nffmpeg -i music_flac.flac \\\n  -acodec libmp3lame      \\\n  -ar 44100               \\\n  -ab 320k                \\\n  -ac 2 music_flac_mp3.mp3\n# - acodec: Audio Coder Decoder \u97F3\u9891\u7F16\u7801\u89E3\u7801\u5668\n# - libmp3lame: MP3 \u89E3\u7801\u5668\n# - ar: audio rate \u97F3\u9891\u91C7\u6837\u7387, \u9ED8\u8BA4\u7528\u539F\u97F3\u9891\u7684\u91C7\u6837\u7387\n# - ab: audio bit rate \u97F3\u9891\u6BD4\u7279\u7387, \u9ED8\u8BA4 128K\n# - ac: audio channels \u97F3\u9891\u58F0\u9053, \u9ED8\u8BA4\u91C7\u7528\u6E90\u97F3\u9891\u7684\u58F0\u9053\u6570\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# mp4 to avi\nffmpeg -i video.mp4 \\\n  -s 1920x1080      \\\n  -pix_fmt yuv420p  \\\n  -vcodec libx264   \\\n  -preset medium    \\\n  -profile:v high   \\\n  -level:v 4.1      \\\n  -crf 23           \\\n  -r 30             \\\n  -acodec aac       \\\n  -ar 44100         \\\n  -ac 2             \\\n  -b:a 128k video_avi.avi\n# - s: \u7F29\u653E\u89C6\u9891\u65B0\u5C3A\u5BF8 (size)\n# - pix_fmt\uFF1Apixel format, \u8BBE\u7F6E\u89C6\u9891\u989C\u8272\u7A7A\u95F4\n# - vcodec: Video Coder Decoder, \u89C6\u9891\u7F16\u7801\u89E3\u7801\u5668\n# - preset: \u7F16\u7801\u5668\u9884\u8BBE\n# - profile:v: \u7F16\u7801\u5668\u914D\u7F6E, \u4E0E\u538B\u7F29\u6BD4\u6709\u5173. \u5B9E\u65F6\u901A\u8BAF-baseline, \u6D41\u5A92\u4F53-main, \u8D85\u6E05\u89C6\u9891-high\n# - level:v: \u5BF9\u7F16\u7801\u5668\u8BBE\u7F6E\u7684\u5177\u4F53\u89C4\u8303\u548C\u9650\u5236, \u6743\u8861\u538B\u7F29\u6BD4\u548C\u753B\u8D28\n# - crf: \u8BBE\u7F6E\u7801\u7387\u63A7\u5236\u6A21\u5F0F, constant rate factor\u6052\u5B9A\u901F\u7387\u56E0\u5B50\u6A21\u5F0F, \u8303\u56F4 0~51, \u6570\u503C\u8D8A\u5C0F, \u753B\u8D28\u8D8A\u9AD8\n# - r:\u8BBE\u7F6E\u89C6\u9891\u5E27\u7387\n# - b:a: \u97F3\u9891\u6BD4\u7279\u7387, \u5927\u591A\u6570\u7F51\u7AD9\u9650\u5236\u97F3\u9891\u6BD4\u7279\u7387 128k, 129k\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# Scale pictures\nffmpeg -i input.jpg -vf scale=320:240 output_320x240.png\n"})}),"\n",(0,l.jsx)(n.h2,{id:"cutting",children:"Cutting"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# audio only\nffmpeg -i cut.mp4 -vn output.mp3\nffmpeg -i video.mp4 -vn -acodec copy video_noVideo.m4a\n\n# video only\nffmpeg -i video.mp4 -vcodec copy -an video_silent.mp4\n"})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# from to cutting\nffmpeg -i music.mp3 -ss 00:00:30 -to 00:02:00 -acodec copy music_cutout.mp3\nffmpeg -i in.mp4 -ss 00:01:00 -to 00:01:10 -c copy out.mp4\nffmpeg -ss 00:01:00 -i in.mp4 -to 00:01:10 -c copy -copyts out.mp4\n\n# 30s duration cutting\nffmpeg -ss 00:02:00.0 -i input.mkv -t 30 -c copy output.mkv\nffmpeg -i input.mkv -ss 00:02:00.0 -t 30 -c copy output.mkv\nffmpeg -ss 00:01:30.0 -i input.mkv -ss 00:00:30.0 -t 30 output.mkv\n"})}),"\n",(0,l.jsx)(n.h2,{id:"mixing",children:"Mixing"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# replace audio\nffmpeg -i input.mkv -i input.mp3 -map 0:v -map 1:a -c copy -shortest output.mp4\n\n# merge audio and video\nffmpeg -i video_noVideo.m4a -i video_silent.mp4 -c copy video_merge.mp4\n\nffmpeg -i "concat:01.mp4|02.mp4|03.mp4" -c copy out.mp4\n\nffmpeg -i input.mkv -i output.aac \\\n  -filter_complex "[0:a][1:a]amerge=inputs=2[a]" -map 0:v -map "[a]" \\\n  -c:v copy -c:a aac -ac 2 -shortest output.mp4\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# Merge pictures\nffmpeg -i 1.png -i 2.png -filter_complex "vstack" output.png\n'})}),"\n",(0,l.jsx)(n.h2,{id:"screenshot",children:"Screenshot"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# -vf -> -filter:v\nffmpeg -ss 00:30:14.435 -i input.mkv -vframes 1 out.png\nffmpeg -i input.mkv -vf fps=1/60 -strftime 1 out_%Y%m%d%H%M%S.jpg\n"})}),"\n",(0,l.jsx)(n.h2,{id:"gif",children:"Gif"}),"\n",(0,l.jsx)(n.p,{children:"GIF \u683C\u5F0F\u6548\u7387\u8F83\u4F4E\uFF0C\u901A\u5E38\u9700\u8981\u964D\u4F4E\u5E27\u7387\u548C\u5206\u8FA8\u7387\u4EE5\u63A7\u5236\u6587\u4EF6\u5927\u5C0F:"}),"\n",(0,l.jsxs)(n.ol,{children:["\n",(0,l.jsxs)(n.li,{children:["\u5E27\u7387\u9009\u62E9:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"10-15 fps: \u64CD\u4F5C\u6B65\u9AA4\u3001UI \u4EA4\u4E92\u5C55\u793A"}),"\n",(0,l.jsx)(n.li,{children:"24-30 fps: \u6D41\u7545\u52A8\u753B\u3001\u6E38\u620F\u753B\u9762"}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["\u5206\u8FA8\u7387\u9009\u62E9:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"960px: \u7F51\u9875\u5D4C\u5165\u3001\u6587\u6863\u914D\u56FE"}),"\n",(0,l.jsx)(n.li,{children:"1280-1920px: \u4FDD\u6301\u539F\u5BBD"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# 10fps + 960px \u5BBD\u5EA6 + \u8C03\u8272\u677F\u4F18\u5316\u753B\u8D28\nffmpeg -i input.mp4 \\\n  -vf "fps=10,scale=960:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" \\\n  -loop 0 output.gif\n\n# 15fps + 1280px \u5BBD\u5EA6\nffmpeg -i input.mp4 \\\n  -vf "fps=15,scale=1280:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse" \\\n  -loop 0 output.gif\n'})}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'# \u57FA\u7840\u8F6C\u6362\nffmpeg -i video.mp4 -ss 7.5 -to 8.5 -s 640x320 -r 15 video_gif.gif\n\n# \u4F7F\u7528\u81EA\u5B9A\u4E49\u8C03\u8272\u677F\npalette="/tmp/palette.png"\nfilters="fps=10,scale=-1:144:flags=lanczos"\nffmpeg -ss 30 -t 5 -i input.mp4 -vf "$filters,palettegen" -y $palette\nffmpeg -ss 30 -t 5 -i input.mp4 -i $palette \\\n  -filter_complex "$filters [x]; [x][1:v] paletteuse" -y output.gif\n'})}),"\n",(0,l.jsx)(n.p,{children:"\u53C2\u6570\u8BF4\u660E:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"fps=N"}),": \u8BBE\u7F6E\u5E27\u7387"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"scale=W:H"}),": \u8BBE\u7F6E\u5206\u8FA8\u7387\uFF0C",(0,l.jsx)(n.code,{children:"-1"})," \u8868\u793A\u81EA\u52A8\u8BA1\u7B97\u4FDD\u6301\u6BD4\u4F8B"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"flags=lanczos"}),": \u4F7F\u7528 Lanczos \u7B97\u6CD5\u8FDB\u884C\u9AD8\u8D28\u91CF\u7F29\u653E"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"palettegen"}),": \u751F\u6210\u81EA\u5B9A\u4E49\u8C03\u8272\u677F (\u4ECE 88842 \u8272\u4E2D\u751F\u6210 256 \u8272)"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"paletteuse"}),": \u5E94\u7528\u8C03\u8272\u677F"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"-loop 0"}),": \u65E0\u9650\u5FAA\u73AF"]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"split[s0][s1]"}),": \u5206\u6D41\u89C6\u9891\u6D41, \u4E00\u8DEF\u7528\u4E8E\u751F\u6210\u8C03\u8272\u677F, \u4E00\u8DEF\u7528\u4E8E\u5E94\u7528"]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"subtitle",children:"Subtitle"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"ffmpeg -i input.mkv -vf subtitles=input.srt output.mp4\nffmpeg -i input.mkv -vf ass=input.ass output.mp4\n"})}),"\n",(0,l.jsx)(n.h2,{id:"watermark",children:"Watermark"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ffmpeg -i input.mkv -i input.png \\\n  -filter_complex "overlay=W-w-5:5" -c copy -c:v libx264 output.mkv\n'})}),"\n",(0,l.jsx)(n.h2,{id:"desktop-recording",children:"Desktop Recording"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:"# windows\nffmpeg -f gdigrab -i desktop rec.mp4\n\n# linux\nsudo ffmpeg -f fbdev -framerate 10 -i /dev/fb0 rec.mp4\n"})}),"\n",(0,l.jsx)(n.h2,{id:"live-streaming",children:"Live Streaming"}),"\n",(0,l.jsx)(n.pre,{children:(0,l.jsx)(n.code,{className:"language-bash",children:'ffmpeg -re i rec.mp4 \u6309\u7167\u7F51\u7AD9\u8981\u6C42\u7F16\u7801 -f flv "\u4F60\u7684 RTMP \u5730\u5740/\u4F60\u7684\u76F4\u64AD\u7801"\n'})})]})}function d(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},30416(e,n,i){i.d(n,{R:()=>t,x:()=>c});var s=i(59471);let l={},a=s.createContext(l);function t(e){let n=s.useContext(a);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:t(e.components),s.createElement(a.Provider,{value:n},e.children)}}}]);