"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["84611"],{71114(e,n,r){r.r(n),r.d(n,{metadata:()=>t,default:()=>u,frontMatter:()=>a,contentTitle:()=>l,toc:()=>c,assets:()=>i});var t=JSON.parse('{"id":"web/javascript/generator","title":"Generator","description":"- \u51FD\u6570\u540D\u79F0\u524D\u9762\u52A0\u4E00\u4E2A\u661F\u53F7 (*) \u8868\u793A\u5B83\u662F\u4E00\u4E2A\u751F\u6210\u5668\u51FD\u6570.","source":"@site/content/web/javascript/generator.md","sourceDirName":"web/javascript","slug":"/web/javascript/generator","permalink":"/notes/web/javascript/generator","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/javascript/generator.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/notes/tags/ecma-script"},{"inline":true,"label":"Generator","permalink":"/notes/tags/generator"},{"inline":true,"label":"Iterator","permalink":"/notes/tags/iterator"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":19,"frontMatter":{"sidebar_position":19,"tags":["Web","JavaScript","ECMAScript","Generator","Iterator"]},"sidebar":"tutorialSidebar","previous":{"title":"Iterator","permalink":"/notes/web/javascript/iterator"},"next":{"title":"Promise","permalink":"/notes/web/javascript/promise"}}'),s=r(62615),o=r(30416);let a={sidebar_position:19,tags:["Web","JavaScript","ECMAScript","Generator","Iterator"]},l="Generator",i={},c=[{value:"Types",id:"types",level:2},{value:"Roles",id:"roles",level:2},{value:"Default Iterator",id:"default-iterator",level:2},{value:"Early Return",id:"early-return",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Next Value",id:"next-value",level:2},{value:"Asynchronous",id:"asynchronous",level:2},{value:"Default Asynchronous Iterator",id:"default-asynchronous-iterator",level:3},{value:"Events Stream",id:"events-stream",level:3},{value:"Delegation",id:"delegation",level:2},{value:"Recursion",id:"recursion",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"generator",children:"Generator"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u51FD\u6570\u540D\u79F0\u524D\u9762\u52A0\u4E00\u4E2A\u661F\u53F7 (",(0,s.jsx)(n.code,{children:"*"}),") \u8868\u793A\u5B83\u662F\u4E00\u4E2A\u751F\u6210\u5668\u51FD\u6570."]}),"\n",(0,s.jsx)(n.li,{children:"\u7BAD\u5934\u51FD\u6570\u4E0D\u80FD\u7528\u6765\u5B9A\u4E49\u751F\u6210\u5668\u51FD\u6570."}),"\n",(0,s.jsxs)(n.li,{children:["\u8C03\u7528\u751F\u6210\u5668\u51FD\u6570\u4F1A\u4EA7\u751F\u4E00\u4E2A\u751F\u6210\u5668\u5BF9\u8C61, \u5176\u662F\u4E00\u4E2A",(0,s.jsx)(n.strong,{children:"\u81EA\u5F15\u7528\u53EF\u8FED\u4EE3\u5BF9\u8C61"}),":\n\u5176\u672C\u8EAB\u662F\u4E00\u4E2A\u8FED\u4EE3\u5668, \u540C\u65F6\u5B9E\u73B0\u4E86 ",(0,s.jsx)(n.code,{children:"Iterable"})," \u63A5\u53E3 (\u8FD4\u56DE ",(0,s.jsx)(n.code,{children:"this"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* gen() {\n  yield 1\n  yield 2\n  yield 3\n}\n\nconst g = gen()\n\ng.next() // { value: 1, done: false }\ng.next() // { value: 2, done: false }\ng.next() // { value: 3, done: false }\ng.next() // { value: undefined, done: true }\ng.return() // { value: undefined, done: true }\ng.return(1) // { value: 1, done: true }\n"})}),"\n",(0,s.jsx)(n.h2,{id:"types",children:"Types"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"interface GeneratorFunction {\n  (...args: any[]): Generator\n  readonly length: number\n  readonly name: string\n  readonly prototype: Generator\n}\n\ninterface Generator<T> extends Iterator<T> {\n  next: (...args: []) => IteratorResult<T>\n  return: (value: T) => IteratorResult<T> // Required\n  throw: (e: any) => IteratorResult<T> // Required\n  [Symbol.iterator]: () => Generator<T>\n}\n\ninterface AsyncGeneratorFunction {\n  (...args: any[]): AsyncGenerator\n  readonly length: number\n  readonly name: string\n  readonly prototype: AsyncGenerator\n}\n\ninterface AsyncGenerator<T> extends AsyncIterator<T> {\n  next: (...args: []) => Promise<IteratorResult<T>>\n  return: (value: T | PromiseLike<T>) => Promise<IteratorResult<T>> // Required\n  throw: (e: any) => Promise<IteratorResult<T>> // Required\n  [Symbol.asyncIterator]: () => AsyncGenerator<T>\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* generatorFn() {}\nconsole.log(generatorFn)\n// f* generatorFn() {}\n\nconsole.log(generatorFn()[Symbol.iterator])\n// f [Symbol.iterator]() {native code}\n\nconsole.log(generatorFn())\n// generatorFn {<suspended>}\n\nconsole.log(generatorFn()[Symbol.iterator]())\n// generatorFn {<suspended>}\n\nconst g = generatorFn() // IterableIterator\nconsole.log(g === g[Symbol.iterator]())\n// true\n"})}),"\n",(0,s.jsx)(n.h2,{id:"roles",children:"Roles"}),"\n",(0,s.jsx)(n.p,{children:"Generators can play 3 roles:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Iterators (data producers):\ngenerators can produce sequences of values via loops and recursion."}),"\n",(0,s.jsxs)(n.li,{children:["Observers (data consumers):\ngenerators become data consumers that pause\nuntil a new value is pushed into them via ",(0,s.jsx)(n.code,{children:"next(value)"}),"\n(",(0,s.jsx)(n.code,{children:"yield"})," can receive a value from ",(0,s.jsx)(n.code,{children:"next(value)"}),")."]}),"\n",(0,s.jsx)(n.li,{children:"Coroutines (data producers and consumers):\ngenerators are pauseable and can be both data producers and data consumers,\ngenerators can be coroutines (cooperatively multi-tasked tasks)."}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["Generators can help\n",(0,s.jsx)(n.a,{href:"https://macarthur.me/posts/generators",children:"reduce tight coupling"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"let windowStart = 0\n\nfunction calculateMovingAverage(values, windowSize) {\n  const section = values.slice(windowStart, windowStart + windowSize)\n\n  if (section.length < windowSize)\n    return null\n\n  return section.reduce((sum, val) => sum + val, 0) / windowSize\n}\n\nloadButton.addEventListener('click', () => {\n  const avg = calculateMovingAverage(prices, 5)\n  average.innerHTML = `Average: $${avg}`\n  windowStart++\n})\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"windowStart"})," is only exposed where needed,\nstate and logic are self-contained with generators:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* calculateMovingAverage(values, windowSize) {\n  let windowStart = 0\n\n  while (windowStart <= values.length - 1) {\n    const section = values.slice(windowStart, windowStart + windowSize)\n\n    yield section.reduce((sum, val) => sum + val, 0) / windowSize\n\n    windowStart++\n  }\n}\n\nconst generator = calculateMovingAverage(prices, 5)\n\nloadButton.addEventListener('click', () => {\n  const { value } = generator.next()\n  average.innerHTML = `Average: $${value}`\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:"Ugly callback-based code:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async function monitorVitals(cb) {\n  while (true) {\n    await new Promise(r => setTimeout(r, 1000))\n\n    const vitals = await requestVitals()\n    cb(vitals)\n  }\n}\n\nmonitorVitals((vitals) => {\n  console.log('Update the UI...', vitals)\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:"No callbacks and timing risks with generators:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async function* generateVitals() {\n  while (true) {\n    const result = await requestVitals()\n\n    await new Promise(r => setTimeout(r, 1000))\n\n    yield result\n  }\n}\n\nfor await (const vitals of generateVitals()) {\n  console.log('Update the UI...', vitals)\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"default-iterator",children:"Default Iterator"}),"\n",(0,s.jsxs)(n.p,{children:["\u751F\u6210\u5668\u51FD\u6570\u548C\u9ED8\u8BA4\u8FED\u4EE3\u5668",(0,s.jsx)(n.strong,{children:"\u88AB\u8C03\u7528"}),"\u4E4B\u540E\u90FD\u4EA7\u751F\u8FED\u4EE3\u5668\n(\u751F\u6210\u5668\u5BF9\u8C61\u662F",(0,s.jsx)(n.strong,{children:"\u81EA\u5F15\u7528\u53EF\u8FED\u4EE3\u5BF9\u8C61"}),", \u81EA\u8EAB\u662F\u4E00\u4E2A\u8FED\u4EE3\u5668),\n\u6240\u4EE5\u751F\u6210\u5668\u9002\u5408\u4F5C\u4E3A\u9ED8\u8BA4\u8FED\u4EE3\u5668:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const users = {\n  james: false,\n  andrew: true,\n  alexander: false,\n  daisy: false,\n  luke: false,\n  clare: true,\n\n  * [Symbol.iterator]() {\n    // this === 'users'\n    for (const key in this) {\n      if (this[key])\n        yield key\n    }\n  },\n}\n\nfor (const key of users)\n  console.log(key)\n\n// andrew\n// clare\n\nclass Foo {\n  constructor() {\n    this.values = [1, 2, 3]\n  }\n\n  * [Symbol.iterator]() {\n    yield* this.values\n  }\n}\n\nconst f = new Foo()\n\nfor (const x of f)\n  console.log(x)\n\n// 1\n// 2\n// 3\n"})}),"\n",(0,s.jsx)(n.h2,{id:"early-return",children:"Early Return"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"return()"})," \u65B9\u6CD5\u4F1A\u5F3A\u5236\u751F\u6210\u5668\u8FDB\u5165\u5173\u95ED\u72B6\u6001."]}),"\n",(0,s.jsxs)(n.li,{children:["\u63D0\u4F9B\u7ED9 ",(0,s.jsx)(n.code,{children:"return()"})," \u7684\u503C, \u5C31\u662F\u7EC8\u6B62\u8FED\u4EE3\u5668\u5BF9\u8C61\u7684\u503C."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* gen() {\n  yield 1\n  yield 2\n  yield 3\n}\n\nconst g = gen()\n\ng.next() // { value: 1, done: false }\ng.return('foo') // { value: \"foo\", done: true }\ng.next() // { value: undefined, done: true }\n"})}),"\n",(0,s.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"throw()"})," \u65B9\u6CD5\u4F1A\u5728\u6682\u505C\u7684\u65F6\u5019\u5C06\u4E00\u4E2A\u63D0\u4F9B\u7684\u9519\u8BEF\u6CE8\u5165\u5230\u751F\u6210\u5668\u5BF9\u8C61\u4E2D.\n\u5982\u679C\u9519\u8BEF\u672A\u88AB\u5904\u7406, \u751F\u6210\u5668\u5C31\u4F1A\u5173\u95ED."]}),"\n",(0,s.jsx)(n.li,{children:"\u5047\u5982\u751F\u6210\u5668\u51FD\u6570\u5185\u90E8\u5904\u7406\u4E86\u8FD9\u4E2A\u9519\u8BEF, \u90A3\u4E48\u751F\u6210\u5668\u5C31\u4E0D\u4F1A\u5173\u95ED, \u53EF\u4EE5\u6062\u590D\u6267\u884C.\n\u9519\u8BEF\u5904\u7406\u4F1A\u8DF3\u8FC7\u5BF9\u5E94\u7684 yield (\u8DF3\u8FC7\u4E00\u4E2A\u503C)."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* generator() {\n  try {\n    yield 1\n  } catch (e) {\n    console.log(e)\n  }\n\n  yield 2\n  yield 3\n  yield 4\n  yield 5\n}\n\nconst it = generator()\n\nit.next() // {value: 1, done: false}\n\n// the error will be handled and printed (\"Error: Handled!\"),\n// then the flow will continue, so we will get the\n// next yielded value as result.\nit.throw(new Error('Handled!')) // {value: 2, done: false}\n\nit.next() // {value: 3, done: false}\n\n// now the generator instance is paused on the\n// third yield that is not inside a try-catch.\n// the error will be re-thrown out\nit.throw(new Error('Not handled!')) // !!! Uncaught Error: Not handled! !!!\n\n// now the iterator is exhausted\nit.next() // {value: undefined, done: true}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"next-value",children:"Next Value"}),"\n",(0,s.jsxs)(n.p,{children:["\u5F53\u4E3A ",(0,s.jsx)(n.code,{children:"next"})," \u4F20\u9012\u503C\u8FDB\u884C\u8C03\u7528\u65F6,\n\u4F20\u5165\u7684\u503C\u4F1A\u88AB\u5F53\u4F5C\u4E0A\u4E00\u6B21\u751F\u6210\u5668\u51FD\u6570\u6682\u505C\u65F6 ",(0,s.jsx)(n.code,{children:"yield"})," \u5173\u952E\u5B57\u7684\u8FD4\u56DE\u503C\u5904\u7406.\n\u7B2C\u4E00\u6B21\u8C03\u7528 ",(0,s.jsx)(n.code,{children:"g.next()"})," \u4F20\u5165\u53C2\u6570\u662F\u6BEB\u65E0\u610F\u4E49,\n\u56E0\u4E3A\u9996\u6B21\u8C03\u7528 ",(0,s.jsx)(n.code,{children:"next"})," \u51FD\u6570\u65F6,\n\u751F\u6210\u5668\u51FD\u6570\u5E76\u6CA1\u6709\u5728 ",(0,s.jsx)(n.code,{children:"yield"})," \u5173\u952E\u5B57\u5904\u6682\u505C:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* lazyCalculator(operator) {\n  const firstOperand = yield\n  const secondOperand = yield\n\n  switch (operator) {\n    case '+':\n      yield firstOperand + secondOperand\n      return\n    case '-':\n      yield firstOperand - secondOperand\n      return\n    case '*':\n      yield firstOperand * secondOperand\n      return\n    case '/':\n      yield firstOperand / secondOperand\n      return\n    default:\n      throw new Error('Unsupported operation!')\n  }\n}\n\nconst g = gen('*')\ng.next() // { value: undefined, done: false }\ng.next(10) // { value: undefined, done: false }\ng.next(2) // { value: 20, done: false }\ng.next() // { value: undefined, done: true }\n"})}),"\n",(0,s.jsx)(n.h2,{id:"asynchronous",children:"Asynchronous"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async function* remotePostsAsyncGenerator() {\n  let i = 1\n\n  while (true) {\n    const res = await fetch(\n      `https://jsonplaceholder.typicode.com/posts/${i++}`\n    ).then(r => r.json())\n\n    // when no more remote posts will be available,\n    // it will break the infinite loop.\n    // the async iteration will end\n    if (Object.keys(res).length === 0)\n      break\n\n    yield res\n  }\n}\n\nfor await (const chunk of remotePostsAsyncGenerator())\n  console.log(chunk)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"default-asynchronous-iterator",children:"Default Asynchronous Iterator"}),"\n",(0,s.jsx)(n.p,{children:"Default asynchronous iterator:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const asyncSource = {\n  async* [Symbol.asyncIterator]() {\n    yield await new Promise(resolve => setTimeout(resolve, 1000, 1))\n  },\n}\n\nfor await (const chunk of asyncSource)\n  console.log(chunk)\n"})}),"\n",(0,s.jsx)(n.h3,{id:"events-stream",children:"Events Stream"}),"\n",(0,s.jsx)(n.p,{children:"Asynchronous UI events stream (RxJS):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"class Observable {\n  constructor() {\n    this.promiseQueue = []\n    // \u4FDD\u5B58\u7528\u4E8E\u961F\u5217\u4E0B\u4E00\u4E2A promise \u7684 resolve \u65B9\u6CD5\n    this.resolve = null\n    // \u628A\u6700\u521D\u7684 promise \u63A8\u5230\u961F\u5217, \u8BE5 promise \u4F1A resolve \u4E3A\u7B2C\u4E00\u4E2A\u89C2\u5BDF\u5230\u7684\u4E8B\u4EF6\n    this.enqueue()\n  }\n\n  // \u521B\u5EFA\u65B0 promise, \u4FDD\u5B58\u5176 resolve \u65B9\u6CD5, \u5E76\u628A\u5B83\u4FDD\u5B58\u5230\u961F\u5217\u4E2D\n  enqueue() {\n    this.promiseQueue.push(new Promise(resolve => (this.resolve = resolve)))\n  }\n\n  // \u4ECE\u961F\u5217\u524D\u7AEF\u79FB\u9664 promise, \u5E76\u8FD4\u56DE\u5B83\n  dequeue() {\n    return this.promiseQueue.shift()\n  }\n\n  async* fromEvent(element, eventType) {\n    // \u5728\u6709\u4E8B\u4EF6\u751F\u6210\u65F6, \u7528\u4E8B\u4EF6\u5BF9\u8C61\u6765 resolve \u961F\u5217\u5934\u90E8\u7684 promise\n    // \u540C\u65F6\u628A\u53E6\u4E00\u4E2A promise \u52A0\u5165\u961F\u5217\n    element.addEventListener(eventType, (event) => {\n      this.resolve(event)\n      this.enqueue()\n    })\n\n    // \u6BCF\u6B21 resolve \u961F\u5217\u5934\u90E8\u7684 promise \u540E, \u90FD\u4F1A\u5411\u5F02\u6B65\u8FED\u4EE3\u5668\u8FD4\u56DE\u76F8\u5E94\u7684\u4E8B\u4EF6\u5BF9\u8C61\n    while (true)\n      yield await this.dequeue()\n  }\n}\n\nconst observable = new Observable()\nconst button = document.querySelector('button')\nconst mouseClickIterator = observable.fromEvent(button, 'click')\n\nfor await (const clickEvent of mouseClickIterator)\n  console.log(clickEvent)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Generator based asynchronous control flow goodness for nodejs and the browser,\nusing promises, letting you write non-blocking code in a nice-ish way\n(just like ",(0,s.jsx)(n.a,{href:"https://github.com/tj/co",children:"tj/co"}),")."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function coroutine(generatorFunc) {\n  const generator = generatorFunc()\n\n  function nextResponse(value) {\n    const response = generator.next(value)\n\n    if (response.done)\n      return\n\n    if (value instanceof Promise)\n      value.then(nextResponse)\n    else\n      nextResponse(response.value)\n  }\n\n  nextResponse()\n}\n\ncoroutine(function* bounce() {\n  yield bounceUp\n  yield bounceDown\n})\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5229\u7528 ",(0,s.jsx)(n.code,{children:"async"}),"/",(0,s.jsx)(n.code,{children:"await"})," \u53EF\u4EE5\u5B9E\u73B0\u76F8\u540C\u6548\u679C:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function co(gen) {\n  return new Promise((resolve, reject) => {\n    const g = gen()\n\n    function next(param) {\n      const { done, value } = g.next(param)\n\n      if (!done) {\n        // Resolve chain.\n        Promise.resolve(value).then(res => next(res))\n      } else {\n        resolve(value)\n      }\n    }\n\n    // First invoke g.next() without params.\n    next()\n  })\n}\n\nfunction promise1() {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve('1')\n    }, 1000)\n  })\n}\n\nfunction promise2(value) {\n  return new Promise((resolve) => {\n    setTimeout(() => {\n      resolve(`value:${value}`)\n    }, 1000)\n  })\n}\n\nfunction* readFileGenerator() {\n  const value = yield promise1()\n  const result = yield promise2(value)\n  return result\n}\n\nasync function readFile() {\n  const value = await promise1()\n  const result = await promise2(value)\n  return result\n}\n\nco(readFileGenerator).then(res => console.log(res))\n// const g = readFileGenerator();\n// const value = g.next();\n// const result = g.next(value);\n// resolve(result);\n\nreadFile().then(res => console.log(res))\n"})}),"\n",(0,s.jsx)(n.h2,{id:"delegation",children:"Delegation"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"yield*"})," \u80FD\u591F\u8FED\u4EE3\u4E00\u4E2A\u53EF\u8FED\u4EE3\u5BF9\u8C61 (",(0,s.jsx)(n.code,{children:"yield* iterable"}),"):"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u53EF\u4EE5\u8FED\u4EE3\u6807\u51C6\u5E93\u63D0\u4F9B\u7684 ",(0,s.jsx)(n.code,{children:"Iterable"})," \u96C6\u5408."]}),"\n",(0,s.jsxs)(n.li,{children:["\u751F\u6210\u5668\u51FD\u6570\u4EA7\u751F\u7684\u751F\u6210\u5668\u5BF9\u8C61\u662F\u4E00\u4E2A",(0,s.jsx)(n.strong,{children:"\u81EA\u5F15\u7528\u53EF\u8FED\u4EE3\u5BF9\u8C61"}),",\n\u53EF\u4EE5\u4F7F\u7528 ",(0,s.jsx)(n.code,{children:"yield*"})," \u805A\u5408\u751F\u6210\u5668 (",(0,s.jsx)(n.code,{children:"Delegating Generator"}),")."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* generatorFn() {\n  console.log('iter value:', yield* [1, 2, 3])\n}\n\nfor (const x of generatorFn())\n  console.log('value:', x)\n\n// value: 1\n// value: 2\n// value: 3\n// iter value: undefined\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* innerGeneratorFn() {\n  yield 'foo'\n  return 'bar'\n}\n\nfunction* outerGeneratorFn(genObj) {\n  console.log('iter value:', yield* innerGeneratorFn())\n}\n\nfor (const x of outerGeneratorFn())\n  console.log('value:', x)\n\n// value: foo\n// iter value: bar\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* chunkify(array, n) {\n  yield array.slice(0, n)\n  array.length > n && (yield* chunkify(array.slice(n), n))\n}\n\nasync function* getRemoteData() {\n  let hasMore = true\n  let page\n\n  while (hasMore) {\n    const { next_page, results } = await fetch(URL, { params: { page } }).then(\n      r => r.json()\n    )\n\n    // Return 5 elements with each iteration.\n    yield* chunkify(results, 5)\n\n    hasMore = next_page !== null\n    page = next_page\n  }\n}\n\nfor await (const chunk of getRemoteData())\n  console.log(chunk)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"recursion",children:"Recursion"}),"\n",(0,s.jsxs)(n.p,{children:["\u5728\u751F\u6210\u5668\u51FD\u6570\u5185\u90E8,\n\u7528 ",(0,s.jsx)(n.code,{children:"yield*"})," \u53BB\u8FED\u4EE3\u81EA\u8EAB\u4EA7\u751F\u7684\u751F\u6210\u5668\u5BF9\u8C61,\n\u5B9E\u73B0\u9012\u5F52\u7B97\u6CD5."]}),"\n",(0,s.jsx)(n.p,{children:"Tree traversal:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Tree traversal\nclass BinaryTree {\n  constructor(value, left = null, right = null) {\n    this.value = value\n    this.left = left\n    this.right = right\n  }\n\n  * [Symbol.iterator]() {\n    yield this.value\n\n    if (this.left) {\n      // Short for: yield* this.left[Symbol.iterator]()\n      yield* this.left\n    }\n\n    if (this.right) {\n      // Short for: yield* this.right[Symbol.iterator]()\n      yield* this.right\n    }\n  }\n}\n\nconst tree = new BinaryTree(\n  'a',\n  new BinaryTree('b', new BinaryTree('c'), new BinaryTree('d')),\n  new BinaryTree('e')\n)\n\nfor (const x of tree)\n  console.log(x)\n\n// Output:\n// a\n// b\n// c\n// d\n// e\n"})}),"\n",(0,s.jsx)(n.p,{children:"Graph traversal:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Graph traversal\nfunction* graphTraversal(nodes) {\n  for (const node of nodes) {\n    if (!visitedNodes.has(node)) {\n      yield node\n      yield* graphTraversal(node.neighbors)\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(n.p,{children:"DOM traversal:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function* domTraversal(element) {\n  yield element\n  element = element.firstElementChild\n\n  while (element) {\n    yield* domTraversal(element)\n    element = element.nextElementSibling\n  }\n}\n\nfor (const element of domTraversal(document.getElementById('subTree')))\n  console.log(element.nodeName)\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u7ED3\u5408 ",(0,s.jsx)(n.code,{children:"Promise"}),"/",(0,s.jsx)(n.code,{children:"async"}),"/",(0,s.jsx)(n.code,{children:"await"})," \u53EF\u4EE5\u5B9E\u73B0\u5F02\u6B65\u9012\u5F52\u7B97\u6CD5:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"import { promises as fs } from 'node:fs'\nimport { basename, dirname, join } from 'node:path'\n\nasync function* walk(dir: string): AsyncGenerator<string> {\n  for await (const d of await fs.opendir(dir)) {\n    const entry = join(dir, d.name)\n\n    if (d.isDirectory())\n      yield* walk(entry)\n    else if (d.isFile())\n      yield entry\n  }\n}\n\nasync function run(arg = '.') {\n  if ((await fs.lstat(arg)).isFile())\n    return runTestFile(arg)\n\n  for await (const file of walk(arg)) {\n    if (\n      !dirname(file).includes('node_modules')\n      && (basename(file) === 'test.js' || file.endsWith('.test.js'))\n    ) {\n      console.log(file)\n      await runTestFile(file)\n    }\n  }\n}\n"})})]})}function u(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},30416(e,n,r){r.d(n,{R:()=>a,x:()=>l});var t=r(59471);let s={},o=t.createContext(s);function a(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);