"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["56805"],{37551(e,n,i){i.r(n),i.d(n,{metadata:()=>t,default:()=>p,frontMatter:()=>d,contentTitle:()=>l,toc:()=>a,assets:()=>o});var t=JSON.parse('{"id":"cs/os/device-io","title":"Device I/O","description":"\u8BBE\u5907\u7BA1\u7406","source":"@site/content/cs/os/device-io.md","sourceDirName":"cs/os","slug":"/cs/os/device-io","permalink":"/notes/cs/os/device-io","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/cs/os/device-io.md","tags":[{"inline":true,"label":"CS","permalink":"/notes/tags/cs"},{"inline":true,"label":"System","permalink":"/notes/tags/system"},{"inline":true,"label":"OS","permalink":"/notes/tags/os"},{"inline":true,"label":"Device","permalink":"/notes/tags/device"},{"inline":true,"label":"I/O","permalink":"/notes/tags/i-o"},{"inline":true,"label":"Network","permalink":"/notes/tags/network"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":8,"frontMatter":{"sidebar_position":8,"tags":["CS","System","OS","Device","I/O","Network"]},"sidebar":"tutorialSidebar","previous":{"title":"Memory","permalink":"/notes/cs/os/memory"},"next":{"title":"Filesystem","permalink":"/notes/cs/os/filesystem"}}'),r=i(62615),s=i(30416);let d={sidebar_position:8,tags:["CS","System","OS","Device","I/O","Network"]},l="Device I/O",o={},a=[{value:"\u8BBE\u5907\u7BA1\u7406",id:"\u8BBE\u5907\u7BA1\u7406",level:2},{value:"CGA EGA and ChromaText Video Buffer",id:"cga-ega-and-chromatext-video-buffer",level:3},{value:"Input and Output",id:"input-and-output",level:3},{value:"\u7CFB\u7EDF\u7EA7 I/O",id:"\u7CFB\u7EDF\u7EA7-io",level:2},{value:"socket I/O",id:"socket-io",level:2},{value:"\u9650\u5236",id:"\u9650\u5236",level:3},{value:"I/O \u51FD\u6570\u7684\u9009\u62E9",id:"io-\u51FD\u6570\u7684\u9009\u62E9",level:3},{value:"Zero Copy",id:"zero-copy",level:2},{value:"Network",id:"network",level:2}];function c(e){let n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"device-io",children:"Device I/O"})}),"\n",(0,r.jsx)(n.h2,{id:"\u8BBE\u5907\u7BA1\u7406",children:"\u8BBE\u5907\u7BA1\u7406"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"CPU \u4E00\u822C\u90FD\u662F\u901A\u8FC7\u5BC4\u5B58\u5668\u7684\u5F62\u5F0F\u6765\u8BBF\u95EE\u5916\u90E8\u8BBE\u5907"}),"\n",(0,r.jsx)(n.li,{children:"\u5916\u8BBE\u7684\u5BC4\u5B58\u5668\u901A\u5E38\u5305\u62EC\u63A7\u5236\u5BC4\u5B58\u5668\u3001\u72B6\u6001\u5BC4\u5B58\u5668\u4E0E\u6570\u636E\u5BC4\u5B58\u5668\u4E09\u7C7B, \u5206\u522B\u7528\u4E8E\u53D1\u9001\u547D\u4EE4/\u8BFB\u53D6\u72B6\u6001/\u8BFB\u5199\u6570\u636E."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"cga-ega-and-chromatext-video-buffer",children:"CGA EGA and ChromaText Video Buffer"}),"\n",(0,r.jsx)(n.p,{children:"\u5728\u5185\u5B58\u7684\u4F4E 1MB \u4E2D, \u6709\u8BB8\u591A\u5730\u5740\u88AB\u6620\u5C04\u81F3\u5916\u90E8\u8BBE\u5907, \u5176\u4E2D\u5C31\u5305\u542B\u6587\u5B57\u663E\u793A\u6A21\u5757(\u663E\u5361\u63A7\u5236\u663E\u793A\u5668):"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u4ECE 0xB8000 \u5F00\u59CB, \u6BCF 2 \u4E2A\u5B57\u8282\u8868\u793A\u5C4F\u5E55\u4E0A\u663E\u793A\u7684\u4E00\u4E2A\u5B57\u7B26(80 x 25)"}),"\n",(0,r.jsx)(n.li,{children:"\u524D\u4E00\u4E2A\u5B57\u8282\u4E3A \u5B57\u7B26 ASCII \u7801, \u540E\u4E00\u4E2A\u5B57\u8282\u4E3A\n\u5B57\u7B26\u989C\u8272\u548C\u5C5E\u6027\u7684\u63A7\u5236\u4FE1\u606F\n(back_twinkle, back_r, back_g, back_b, front_light, front_r, front_g, front_b)"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"input-and-output",children:"Input and Output"}),"\n",(0,r.jsxs)(n.p,{children:["\u8C03\u7528 ",(0,r.jsx)(n.code,{children:"io_delay()"})," \u51FD\u6570: \u5BF9\u4E8E\u4E00\u4E9B\u8001\u5F0F\u603B\u7EBF\u7684\u5916\u90E8\u8BBE\u5907, \u8BFB\u5199 I/O \u7AEF\u53E3\u7684\u901F\u5EA6\u82E5\u8FC7\u5FEB\u5C31\u5BB9\u6613\u51FA\u73B0\u4E22\u5931\u6570\u636E\u7684\u73B0\u8C61"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"I/O Model",src:i(69474).A+"",title:"I/O Model",width:"761",height:"427"})}),"\n",(0,r.jsx)(n.h2,{id:"\u7CFB\u7EDF\u7EA7-io",children:"\u7CFB\u7EDF\u7EA7 I/O"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"// robust I/O\nssize_t rio_read_n(int fd, void *usr_buf, size_t n) {\n    size_t n_left = n;\n    ssize_t n_read;\n    char *buf_p = usr_buf;\n\n    while (n_left > 0) {\n        if ((n_read = read(fd, buf_p, n_left)) < 0) {\n            if (errno == EINTR) {\n                n_read = 0; // interrupted by signal_handler, re-call read()\n            } else {\n                return -1;\n            }\n        } else if (n_read == 0) {\n            break;\n        }\n\n        n_left -= n_read;\n        buf_p += n_read; // remove data from buf_p\n    }\n\n    return (n - n_left);\n}\n\nssize_t rio_write_n(int fd, void *usr_buf, size_t n) {\n    size_t n_left = n;\n    ssize_t n_written;\n    char *buf_p = usr_buf;\n\n    while (n_left > 0) {\n        if ((n_written = read(fd, buf_p, n_left)) < 0) {\n            if (errno == EINTR) {\n                n_written = 0; // interrupted by signal_handler, re-call read()\n            } else {\n                return -1;\n            }\n        }\n\n        n_left -= n_written;\n        buf_p += n_written; // remove data from buf_p\n    }\n\n    return n;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"socket-io",children:"socket I/O"}),"\n",(0,r.jsx)(n.h3,{id:"\u9650\u5236",children:"\u9650\u5236"}),"\n",(0,r.jsx)(n.p,{children:"\u8F93\u51FA\u51FD\u6570+\u8F93\u5165\u51FD\u6570: \u4E2D\u95F4\u5FC5\u987B\u63D2\u5165 fflush, fseek, fsetpos, rewind\n\u8F93\u5165\u51FD\u6570+\u8F93\u51FA\u51FD\u6570: \u4E2D\u95F4\u5FC5\u987B\u63D2\u5165 fseek, fsetpos, rewind"}),"\n",(0,r.jsx)(n.h3,{id:"io-\u51FD\u6570\u7684\u9009\u62E9",children:"I/O \u51FD\u6570\u7684\u9009\u62E9"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"sprintf+rio_written: \u683C\u5F0F\u5316\u8F93\u51FA\u81F3\u5957\u63A5\u53E3"}),"\n",(0,r.jsx)(n.li,{children:"rio_readlineb + sscanf: \u683C\u5F0F\u5316\u8F93\u5165"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"zero-copy",children:"Zero Copy"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"read()"}),": 2 \u6B21\u72B6\u6001\u5207\u6362, 1 \u6B21 CPU Copy, 1 \u6B21 DMA Copy.\n",(0,r.jsx)(n.code,{children:"write()"}),": 2 \u6B21\u72B6\u6001\u5207\u6362, 1 \u6B21 CPU Copy, 1 \u6B21 DMA Copy."]}),"\n",(0,r.jsx)(n.p,{children:"\u603B\u8BA1 4 \u6B21\u72B6\u6001\u5207\u6362, 2 \u6B21 CPU Copy, 2 \u6B21 DMA Copy.\n\u6D89\u53CA\u591A\u6B21\u7A7A\u95F4\u5207\u6362\u548C\u6570\u636E\u5197\u4F59\u62F7\u8D1D, \u6548\u7387\u4F4E\u4E0B\uFF0C\u53EF\u4F7F\u7528\u96F6\u62F7\u8D1D\u6280\u672F\u8FDB\u884C\u4F18\u5316:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"mmap"})," + ",(0,r.jsx)(n.code,{children:"write"}),": 4 \u6B21\u72B6\u6001\u5207\u6362, 1 \u6B21 CPU Copy, 2 \u6B21 DMA Copy."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sendfile"}),": 2 \u6B21\u72B6\u6001\u5207\u6362, 1 \u6B21 CPU Copy, 2 \u6B21 DMA Copy."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"sendfile"})," + ",(0,r.jsx)(n.code,{children:"DMA \u6536\u96C6"}),": 2 \u6B21\u72B6\u6001\u5207\u6362, 0 \u6B21 CPU Copy, 2 \u6B21 DMA Copy (\u53EA\u53EF\u8BFB)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"splice"}),": 2 \u6B21\u72B6\u6001\u5207\u6362, 0 \u6B21 CPU Copy, 2 \u6B21 DMA Copy (\u53EA\u53EF\u7BA1\u9053)."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"network",children:"Network"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:'#include <netinet/in.h>\n#include <arpa/inet.h>\n#include <netdb.h>\n\nint main(int argc, char *argv) {\n    char **pp;\n    struct in_addr addr;\n    struct hostent *host_p;\n\n    if (argc != 2) {\n        fprintf(stderr, "usage: %s <domain name or dotted-decimal>\\n", argv[0]);\n        exit(0);\n    }\n\n    if (inet_aton(argv[1], &addr) != 0) {\n        host_p = gethostbyaddr((const char*)&addr, sizeof(addr), AF_INET);\n    } else {\n        host_p = gethostbyname(argv[1]);\n    }\n\n    printf("official hostname: %s\\n:", host_p->h_name);\n\n    for (pp = host_p->h_aliases; *pp != NULL; pp++) {\n        printf("alias: %s\\n", *pp);\n    }\n\n    for (pp = host_p->h_addr_list; *pp != NULL; pp++) {\n        addr.s_addr = ((struct in_addr *)*pp)->s_addr;\n        printf("address: %s\\n", inet_ntoa(addr));\n    }\n\n    exit(0);\n}\n'})})]})}function p(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(c,{...e})}):c(e)}},69474(e,n,i){i.d(n,{A:()=>t});let t=i.p+"assets/images/io-model-044fd75adf7a5668e38b6f1364db8cad.png"},30416(e,n,i){i.d(n,{R:()=>d,x:()=>l});var t=i(59471);let r={},s=t.createContext(r);function d(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:d(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);