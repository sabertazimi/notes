"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["59025"],{64610(e,n,l){l.r(n),l.d(n,{metadata:()=>i,default:()=>x,frontMatter:()=>d,contentTitle:()=>c,toc:()=>h,assets:()=>t});var i=JSON.parse('{"id":"cs/os/memory","title":"Memory","description":"Boot Loader","source":"@site/content/cs/os/memory.md","sourceDirName":"cs/os","slug":"/cs/os/memory","permalink":"/notes/cs/os/memory","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/cs/os/memory.md","tags":[{"inline":true,"label":"CS","permalink":"/notes/tags/cs"},{"inline":true,"label":"System","permalink":"/notes/tags/system"},{"inline":true,"label":"OS","permalink":"/notes/tags/os"},{"inline":true,"label":"Memory","permalink":"/notes/tags/memory"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":7,"frontMatter":{"sidebar_position":7,"tags":["CS","System","OS","Memory"]},"sidebar":"tutorialSidebar","previous":{"title":"Concurrency","permalink":"/notes/cs/os/concurrency"},"next":{"title":"Device I/O","permalink":"/notes/cs/os/device-io"}}'),s=l(62615),r=l(30416);let d={sidebar_position:7,tags:["CS","System","OS","Memory"]},c="Memory",t={},h=[{value:"Boot Loader",id:"boot-loader",level:2},{value:"Target",id:"target",level:3},{value:"\u65B9\u5F0F",id:"\u65B9\u5F0F",level:3},{value:"\u63A2\u6D4B\u673A\u5668\u5185\u5B58\u5206\u5E03",id:"\u63A2\u6D4B\u673A\u5668\u5185\u5B58\u5206\u5E03",level:3},{value:"\u5730\u5740\u751F\u6210",id:"\u5730\u5740\u751F\u6210",level:3},{value:"\u5730\u5740\u6620\u5C04",id:"\u5730\u5740\u6620\u5C04",level:3},{value:"\u5730\u5740\u68C0\u67E5",id:"\u5730\u5740\u68C0\u67E5",level:3},{value:"\u7279\u6743\u7EA7",id:"\u7279\u6743\u7EA7",level:2},{value:"\u68C0\u67E5",id:"\u68C0\u67E5",level:3},{value:"\u5207\u6362",id:"\u5207\u6362",level:3},{value:"Ring 0 to Ring 3",id:"ring-0-to-ring-3",level:4},{value:"Ring 3 to Ring 0",id:"ring-3-to-ring-0",level:4},{value:"TSS",id:"tss",level:3},{value:"\u8FDE\u7EED\u5206\u914D",id:"\u8FDE\u7EED\u5206\u914D",level:2},{value:"\u5185\u5B58\u788E\u7247",id:"\u5185\u5B58\u788E\u7247",level:3},{value:"\u52A8\u6001\u5206\u914D",id:"\u52A8\u6001\u5206\u914D",level:3},{value:"\u788E\u7247\u6574\u7406",id:"\u788E\u7247\u6574\u7406",level:3},{value:"Ucore",id:"ucore",level:2},{value:"\u7D27\u51D1",id:"\u7D27\u51D1",level:3},{value:"\u5206\u533A\u5BF9\u6362",id:"\u5206\u533A\u5BF9\u6362",level:3},{value:"Malloc",id:"malloc",level:2},{value:"\u542F\u53D1\u5F0F\u7F16\u7A0B",id:"\u542F\u53D1\u5F0F\u7F16\u7A0B",level:3},{value:"\u4F19\u4F34\u7CFB\u7EDF",id:"\u4F19\u4F34\u7CFB\u7EDF",level:3},{value:"\u5408\u5E76\u7A7A\u95F2\u5757",id:"\u5408\u5E76\u7A7A\u95F2\u5757",level:4},{value:"\u975E\u8FDE\u7EED\u5206\u914D",id:"\u975E\u8FDE\u7EED\u5206\u914D",level:2},{value:"\u6BB5\u5F0F",id:"\u6BB5\u5F0F",level:2},{value:"GDT",id:"gdt",level:3},{value:"\u9875\u5F0F",id:"\u9875\u5F0F",level:2},{value:"\u865A\u62DF\u5730\u5740",id:"\u865A\u62DF\u5730\u5740",level:3},{value:"\u7269\u7406\u5730\u5740",id:"\u7269\u7406\u5730\u5740",level:3},{value:"\u9875\u8868",id:"\u9875\u8868",level:3},{value:"TLB",id:"tlb",level:3},{value:"\u591A\u7EA7\u9875\u8868",id:"\u591A\u7EA7\u9875\u8868",level:3},{value:"\u53CD\u7F6E\u9875\u8868",id:"\u53CD\u7F6E\u9875\u8868",level:3},{value:"\u6BB5\u9875\u5F0F",id:"\u6BB5\u9875\u5F0F",level:2},{value:"\u865A\u62DF\u9875\u5F0F",id:"\u865A\u62DF\u9875\u5F0F",level:2},{value:"Page Fault",id:"page-fault",level:2},{value:"\u8986\u76D6",id:"\u8986\u76D6",level:3},{value:"\u4EA4\u6362",id:"\u4EA4\u6362",level:3},{value:"\u6807\u5FD7\u4F4D",id:"\u6807\u5FD7\u4F4D",level:3},{value:"\u5C40\u90E8\u7F6E\u6362",id:"\u5C40\u90E8\u7F6E\u6362",level:3},{value:"\u6700\u8FDC\u672A\u7528",id:"\u6700\u8FDC\u672A\u7528",level:4},{value:"\u65F6\u949F",id:"\u65F6\u949F",level:4},{value:"\u6700\u4E0D\u5E38\u7528",id:"\u6700\u4E0D\u5E38\u7528",level:4},{value:"\u5168\u5C40\u7F6E\u6362",id:"\u5168\u5C40\u7F6E\u6362",level:3},{value:"\u5DE5\u4F5C\u96C6",id:"\u5DE5\u4F5C\u96C6",level:4},{value:"\u7F3A\u9875\u7387",id:"\u7F3A\u9875\u7387",level:4},{value:"Toolchain",id:"toolchain",level:2},{value:"Perf",id:"perf",level:3},{value:"Trace",id:"trace",level:3},{value:"Vmstat",id:"vmstat",level:3},{value:"Pmap",id:"pmap",level:3},{value:"Hot Plug",id:"hot-plug",level:3},{value:"TCMalloc",id:"tcmalloc",level:3},{value:"Oprofile",id:"oprofile",level:3}];function a(e){let n={a:"a",admonition:"admonition",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"memory",children:"Memory"})}),"\n",(0,s.jsx)(n.h2,{id:"boot-loader",children:"Boot Loader"}),"\n",(0,s.jsx)(n.h3,{id:"target",children:"Target"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u62BD\u8C61: \u903B\u8F91\u5730\u5740\u7A7A\u95F4(\u7EBF\u6027\u7269\u7406\u5730\u5740\u6620\u5C04)"}),"\n",(0,s.jsx)(n.li,{children:"\u4FDD\u62A4: \u72EC\u7ACB\u5730\u5740\u7A7A\u95F4(\u8FDB\u7A0B\u95F4\u4E92\u4E0D\u5F71\u54CD)"}),"\n",(0,s.jsx)(n.li,{children:"\u5171\u4EAB: \u8BBF\u95EE\u76F8\u540C\u5185\u5B58(\u5185\u6838\u7A7A\u95F4\u4E0E\u5171\u4EAB\u5E93)"}),"\n",(0,s.jsx)(n.li,{children:"\u865A\u62DF\u5316: \u72EC\u5360\u5185\u5B58\u7A7A\u95F4\u5047\u8C61"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u65B9\u5F0F",children:"\u65B9\u5F0F"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u91CD\u5B9A\u4F4D (relocation)"}),"\n",(0,s.jsx)(n.li,{children:"\u5206\u6BB5 (segmentation): \u4EE3\u7801\u6BB5/\u6570\u636E\u6BB5"}),"\n",(0,s.jsx)(n.li,{children:"\u5206\u9875 (paging)"}),"\n",(0,s.jsx)(n.li,{children:"\u865A\u62DF\u5B58\u50A8 (virtual memory): \u5185\u5B58\u89C6\u4F5C\u786C\u76D8\u7684\u7F13\u5B58, \u786C\u76D8\u89C6\u4F5C\u865A\u62DF\u5185\u5B58"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u63A2\u6D4B\u673A\u5668\u5185\u5B58\u5206\u5E03",children:"\u63A2\u6D4B\u673A\u5668\u5185\u5B58\u5206\u5E03"}),"\n",(0,s.jsx)(n.p,{children:"\u4E3A\u5185\u5B58\u7BA1\u7406\u6A21\u5757\u63D0\u4F9B\u57FA\u7840: \u5728\u8FDB\u5165\u5B9E\u6A21\u5F0F\u524D, \u8C03\u7528 int 15h(88h, e801h, e820h), \u501F\u52A9 BIOS \u4E2D\u65AD\u83B7\u53D6\u5185\u5B58\u4FE1\u606F"}),"\n",(0,s.jsx)(n.h3,{id:"\u5730\u5740\u751F\u6210",children:"\u5730\u5740\u751F\u6210"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7F16\u8BD1\u65F6"}),"\n",(0,s.jsx)(n.li,{children:"\u94FE\u63A5\u65F6"}),"\n",(0,s.jsx)(n.li,{children:"\u52A0\u8F7D\u65F6"}),"\n",(0,s.jsx)(n.li,{children:"\u6267\u884C\u65F6(\u76F8\u5BF9\u5BFB\u5740)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5730\u5740\u6620\u5C04",children:"\u5730\u5740\u6620\u5C04"}),"\n",(0,s.jsx)(n.p,{children:"\u8F6F\u786C\u4EF6\u7ED3\u5408:"}),"\n",(0,s.jsx)(n.p,{children:"\u903B\u8F91\u5730\u5740 ---\x3e \u7269\u7406\u5730\u5740"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u786C\u4EF6(CPU/MMU)\u5B8C\u6210\u6620\u5C04\u5730\u5740"}),"\n",(0,s.jsx)(n.li,{children:"\u64CD\u4F5C\u7CFB\u7EDF\u5EFA\u7ACB\u6620\u5C04\u89C4\u5219(\u9875\u8868)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5730\u5740\u68C0\u67E5",children:"\u5730\u5740\u68C0\u67E5"}),"\n",(0,s.jsx)(n.p,{children:"\u8F6F\u786C\u4EF6\u7ED3\u5408:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u64CD\u4F5C\u7CFB\u7EDF\u8BBE\u7F6E\u7684\u6BB5\u673A\u5236\u548C\u6BB5\u957F\u5EA6"}),"\n",(0,s.jsx)(n.li,{children:"\u786C\u4EF6(CPU/MMU)\u6839\u636E\u6BB5\u4FE1\u606F\u8FDB\u884C\u5730\u5740\u68C0\u67E5(\u5185\u5B58\u8BBF\u95EE\u662F\u5426\u5F02\u5E38)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u7279\u6743\u7EA7",children:"\u7279\u6743\u7EA7"}),"\n",(0,s.jsx)(n.p,{children:"0: \u6700\u9AD8\u7279\u6743\u7EA7, 3: \u6700\u4F4E\u7279\u6743\u7EA7"}),"\n",(0,s.jsx)(n.h3,{id:"\u68C0\u67E5",children:"\u68C0\u67E5"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"CPL/RPL: \u8BBF\u95EE\u8005\u7279\u6743\u7EA7"}),"\n",(0,s.jsx)(n.li,{children:"DRL: \u6BB5\u63CF\u8FF0\u7B26/\u95E8\u63CF\u8FF0\u7B26(\u4E2D\u65AD/\u9677\u9631\u95E8)\u4E2D\u4FDD\u5B58\u7684\u7279\u6743\u7EA7, \u8868\u793A\u88AB\u8BBF\u95EE\u6BB5/\u4E2D\u65AD\u670D\u52A1/\u9677\u9631\u7684\u7279\u6743\u7EA7"}),"\n",(0,s.jsxs)(n.li,{children:["CPL/RPL ",(0,s.jsx)(n.code,{children:"<="})," DRL e.g. 0 < 3"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5207\u6362",children:"\u5207\u6362"}),"\n",(0,s.jsx)(n.h4,{id:"ring-0-to-ring-3",children:"Ring 0 to Ring 3"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["interrupt/trap: push SS(",(0,s.jsx)(n.strong,{children:"RPL=3"}),") -> ESP -> EFLAGS\n-> CS(",(0,s.jsx)(n.strong,{children:"RPL=3"}),") -> EIP -> Error Code"]}),"\n",(0,s.jsx)(n.li,{children:"iret: pop above variables, move to ring 3"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"ring-3-to-ring-0",children:"Ring 3 to Ring 0"}),"\n",(0,s.jsx)(n.p,{children:"\u7279\u6743\u7EA7\u63D0\u5347:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"interrupt/trap: stack switch"}),"\n",(0,s.jsxs)(n.li,{children:["push EFLAGS -> CS(",(0,s.jsx)(n.strong,{children:"RPL=0"}),") -> EIP -> Error Code"]}),"\n",(0,s.jsx)(n.li,{children:"iret: pop above variables, move to ring 0"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"tss",children:"TSS"}),"\n",(0,s.jsx)(n.p,{children:"Task State Segment:"}),"\n",(0,s.jsx)(n.p,{children:"\u4FDD\u5B58\u4E0D\u540C\u7279\u6743\u7EA7\u7684\u5806\u6808\u4FE1\u606F(SS/ESP)"}),"\n",(0,s.jsx)(n.p,{children:"\u5168\u5C40\u63CF\u8FF0\u7B26\u8868\u4E2D\u4FDD\u5B58\u4E00\u4E2A TSS Descriptor(TSS base + TSS limit):\nallocate TSS memory -> init TSS\n-> fill TSS descriptor in GDT -> set TSS selector(task register)"}),"\n",(0,s.jsx)(n.h2,{id:"\u8FDE\u7EED\u5206\u914D",children:"\u8FDE\u7EED\u5206\u914D"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"malloc"}),"\n",(0,s.jsx)(n.li,{children:"free"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5185\u5B58\u788E\u7247",children:"\u5185\u5B58\u788E\u7247"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5916\u90E8\u788E\u7247: \u5DF2\u5206\u914D\u5355\u5143\u95F4\u65E0\u6CD5\u5229\u7528\u7A7A\u95F2\u5355\u5143(\u8BF7\u6C42\u5185\u5B58\u5355\u5143\u8FC7\u5927)"}),"\n",(0,s.jsx)(n.li,{children:"\u5185\u90E8\u788E\u7247: \u5DF2\u5206\u914D\u5355\u5143\u5185\u7A7A\u95F2\u5355\u5143"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u52A8\u6001\u5206\u914D",children:"\u52A8\u6001\u5206\u914D"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Fist-fit(\u6700\u5148\u5339\u914D): \u4F7F\u7528\u7B2C\u4E00\u4E2A\u53EF\u5229\u7528\u7A7A\u95F2\u5757 - \u5BB9\u6613\u4EA7\u751F\u5916\u90E8\u788E\u7247, \u5206\u914D\u5927\u5757\u6548\u7387\u4F4E"}),"\n",(0,s.jsx)(n.li,{children:"Best-fit(\u6700\u4F73\u5339\u914D): \u4F7F\u7528\u5229\u7528\u5EA6\u6700\u9AD8\u7684\u7A7A\u95F2\u5757 - \u5916\u90E8\u788E\u7247\u8FC7\u5C0F, \u91CA\u653E\u65F6\u9700\u91CD\u65B0\u6392\u5217\u7A7A\u95F2\u5757\u94FE\u8868(\u5347\u5E8F)"}),"\n",(0,s.jsx)(n.li,{children:"Worst-fit(\u6700\u5DEE\u5339\u914D): \u4F7F\u7528\u5229\u7528\u5EA6\u6700\u5DEE\u7684\u7A7A\u95F2\u5757 - \u5206\u914D\u4E2D\u5757\u6548\u7387\u9AD8, \u91CA\u653E\u65F6\u9700\u91CD\u65B0\u6392\u5217\u7A7A\u95F2\u5757\u94FE\u8868(\u964D\u5E8F)"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u788E\u7247\u6574\u7406",children:"\u788E\u7247\u6574\u7406"}),"\n",(0,s.jsx)(n.h2,{id:"ucore",children:"Ucore"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u8FDE\u7EED\u5B58\u653E n \u4E2A page \u7ED3\u6784, \u5F62\u5F0F\u8868\u793A\u5185\u5B58\u9875, \u5E76\u5728\u8FDE\u7EED\u5185\u5B58\u5757\u7684\u9996\u9875(header page)\u4FDD\u5B58\u6B64\u8FDE\u7EED\u5757\u7684\u8FDE\u7EED\u9875\u6570\u76EE"}),"\n",(0,s.jsx)(n.li,{children:"\u7EF4\u62A4\u4E00\u4E2A\u94FE\u8868, \u94FE\u8868\u6BCF\u9879\u4E3A\u5927\u5757\u8FDE\u7EED\u5185\u5B58\u5757\u7684\u8D77\u59CB\u9875(header page address) \u548C \u8FDE\u7EED\u9875\u6570\u76EE, \u7BA1\u7406\u5206\u6563\u7684\u8FDE\u7EED\u5185\u5B58\u5757"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u7D27\u51D1",children:"\u7D27\u51D1"}),"\n",(0,s.jsx)(n.p,{children:"Compaction, \u5C06\u4E0D\u540C\u8FDB\u7A0B\u5360\u7528\u5185\u5B58\u5355\u5143\u79FB\u81F3\u8F83\u4E3A\u96C6\u4E2D\u7684\u5730\u65B9:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u53EA\u53EF\u79FB\u52A8 \u53EF\u52A8\u6001\u91CD\u5B9A\u4F4D\u7A0B\u5E8F"}),"\n",(0,s.jsx)(n.li,{children:"\u53EA\u53EF\u79FB\u52A8 \u7B49\u5F85\u72B6\u6001\u8FDB\u7A0B"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5206\u533A\u5BF9\u6362",children:"\u5206\u533A\u5BF9\u6362"}),"\n",(0,s.jsx)(n.p,{children:"Swapping In and Swapping Out:"}),"\n",(0,s.jsx)(n.p,{children:"\u5C06\u7B49\u5F85\u72B6\u6001\u8FDB\u7A0B\u7684\u5206\u533A\u5BF9\u6362\u81F3\u5916\u5B58,\u4EE5\u589E\u5927\u53EF\u7528\u5185\u5B58\u5355\u5143"}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"e.g. Linux Swap \u5206\u533A: \u5B89\u88C5\u7CFB\u7EDF\u65F6\u4E00\u822C\u5207\u5272\u5927\u5C0F\u4E3A\u5185\u5B58\u5927\u5C0F\u7684 50%~100% \u7684\u5916\u5B58\u4F5C\u4E3A Swap \u5206\u533A"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"malloc",children:"Malloc"}),"\n",(0,s.jsx)(n.h3,{id:"\u542F\u53D1\u5F0F\u7F16\u7A0B",children:"\u542F\u53D1\u5F0F\u7F16\u7A0B"}),"\n",(0,s.jsx)(n.p,{children:"Heuristic Programming:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5EFA\u7ACB\u5DF2\u5206\u914D void \u6307\u9488\u8868,free \u51FD\u6570\u6267\u884C\u65F6,\u53EA\u56DE\u6536\u8868\u4E2D\u5B58\u5728\u7684\u6307\u9488;\u4E0D\u5B58\u5728\u5219\u62A5\u9519"}),"\n",(0,s.jsx)(n.li,{children:"\u5BF9 heap \u8FDB\u884C\u5206\u533A - \u5C0F/\u4E2D/\u5927\u5757\u5185\u5B58\u8BF7\u6C42,\u5206\u522B\u4ECE\u4E0D\u540C\u533A\u57DF(8/16/32 \u6700\u5C0F\u5355\u4F4D\u533A)\u5206\u914D"}),"\n",(0,s.jsx)(n.li,{children:"\u8BB0\u5F55\u5F53\u524D\u5806\u5757\u7684\u4FE1\u606F\uFF0C\u5982\u957F\u5EA6\uFF0C\u7A7A\u95F2\u72B6\u6001"}),"\n",(0,s.jsx)(n.li,{children:"\u8BB0\u5F55\u5468\u56F4\u73AF\u5883\u4FE1\u606F\uFF0C\u5982\u4FDD\u7559\u4E0A/\u4E0B\u4E00\u5806\u5757\u7684\u6307\u9488\u6216\u8BB0\u5F55\u4E0A/\u4E0B\u5806\u5757\u7A7A\u95F2\u72B6\u6001"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u4F19\u4F34\u7CFB\u7EDF",children:"\u4F19\u4F34\u7CFB\u7EDF"}),"\n",(0,s.jsx)(n.p,{children:"Buddy System:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u53EF\u5206\u914D\u5185\u5B58\u5355\u5143\u603B\u5927\u5C0F\u4E3A 2^n"}),"\n",(0,s.jsxs)(n.li,{children:["\u603B\u662F\u5C06\u5927\u5C0F ",(0,s.jsx)(n.strong,{children:"\u5C0F\u4E8E"}),"\u8BF7\u6C42\u5927\u5C0F\u7684",(0,s.jsx)(n.strong,{children:"2 \u500D"}),"\u4E14\u4E3A",(0,s.jsx)(n.strong,{children:"2 \u7684\u5E42\u6B21\u65B9"})," \u7684\u67D0\u5757\u5185\u5B58\u5355\u5143\u5206\u914D\u51FA\u53BB(\u5927\u5C0F\u4E3A 2^(i-1))"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"\u5408\u5E76\u7A7A\u95F2\u5757",children:"\u5408\u5E76\u7A7A\u95F2\u5757"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7A7A\u95F2\u5757\u76F8\u90BB"}),"\n",(0,s.jsx)(n.li,{children:"\u7A7A\u95F2\u5757\u7B49\u5927"}),"\n",(0,s.jsx)(n.li,{children:"\u4F4E\u5730\u5740\u7A7A\u95F2\u5757\u7684 \u8D77\u59CB\u5730\u5740 \u5FC5\u987B\u4E3A \u7A7A\u95F2\u5757\u5927\u5C0F \u7684 2 \u7684\u5E42\u6B21\u65B9\u500D(2 \u500D\u4EE5\u4E0A)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u975E\u8FDE\u7EED\u5206\u914D",children:"\u975E\u8FDE\u7EED\u5206\u914D"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u652F\u6301\u4E00\u4E2A\u7A0B\u5E8F\u4F7F\u7528\u975E\u8FDE\u7EED\u7684\u7269\u7406\u5730\u5740\u7A7A\u95F4"}),"\n",(0,s.jsx)(n.li,{children:"\u652F\u6301\u5171\u4EAB\u4EE3\u7801\u4E0E\u6570\u636E"}),"\n",(0,s.jsx)(n.li,{children:"\u652F\u6301\u52A8\u6001\u52A0\u8F7D\u4E0E\u52A8\u6001\u94FE\u63A5"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6BB5\u5F0F",children:"\u6BB5\u5F0F"}),"\n",(0,s.jsx)(n.p,{children:"\u5C06\u903B\u8F91\u5730\u5740\u5212\u5206, \u4F4E\u4F4D\u8868\u793A\u6BB5\u5185\u504F\u79FB, \u9AD8\u4F4D(\u53D6\u6478)\u8868\u793A\u6BB5\u53F7(\u7C7B\u6BD4\u7F13\u5B58\u4E2D\u7684\u5185\u5B58\u5730\u5740)"}),"\n",(0,s.jsx)(n.h3,{id:"gdt",children:"GDT"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"typedef struct gdt_ptr {\n    uint16_t gdt_limit;     // gdt_length - 1\n    uint32_t gdt_base;\n} __attribute__((packed)) gdt_ptr_t;\n"})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7528 16 \u4F4D\u6765\u8868\u793A\u8868\u7684\u957F\u5EA6(2 ^ 16 = 65532 bytes), \u9664\u4EE5\u6BCF\u4E00\u4E2A\u63CF\u8FF0\u7B26\u7684 8 \u5B57\u8282, \u6700\u591A\u80FD\u521B\u5EFA 8192 \u4E2A\u63CF\u8FF0\u7B26"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u9875\u5F0F",children:"\u9875\u5F0F"}),"\n",(0,s.jsx)(n.p,{children:"\u5F00\u542F\u9875\u673A\u5236:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"init page directory(\u9996\u5740\u4F4D\u4E8E cr3 \u5BC4\u5B58\u5668), page table"}),"\n",(0,s.jsx)(n.li,{children:"update GDT"}),"\n",(0,s.jsx)(n.li,{children:"update ds,es,ss"}),"\n",(0,s.jsx)(n.li,{children:"update cs with jmp instruction"}),"\n",(0,s.jsx)(n.li,{children:"cr0 \u5BC4\u5B58\u5668 bit31(most bit) \u7F6E 1"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u865A\u62DF\u5730\u5740",children:"\u865A\u62DF\u5730\u5740"}),"\n",(0,s.jsx)(n.p,{children:"TLB (Translation Lookaside Buffer in CPU/PM):"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Virtual Address =\n",(0,s.jsx)(n.code,{children:"2^(bits of virtual page offset) * virtual page number + virtual page offset"}),"."]}),"\n",(0,s.jsx)(n.li,{children:"VA = VPN (virtual page number point to PPN) + VPO(virtual page offset = PPO)."}),"\n",(0,s.jsx)(n.li,{children:"\u6839\u636E VPN \u5728\u9875\u8868\u4E2D\u627E\u5230\u5BF9\u5E94\u8868\u9879(VPN \u8868\u793A\u9879\u53F7), \u6BCF\u9879\u4FDD\u5B58\u7740 PPN."}),"\n",(0,s.jsx)(n.li,{children:"TLB = TLBT (tag) + TLBI(index) + VPO."}),"\n",(0,s.jsxs)(n.li,{children:["\u56E0\u4E3A\u5185\u5B58\u5C40\u90E8\u6027\u539F\u7406, TLB \u4E00\u822C\u53EA\u9700\u8981\u5F88\u5C0F (\u6BD4\u5982 ",(0,s.jsx)(n.strong,{children:"64 \u9879"}),") \u5373\u53EF\u8FBE\u5230\u4E0D\u9519\u7684\u6548\u679C."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u7269\u7406\u5730\u5740",children:"\u7269\u7406\u5730\u5740"}),"\n",(0,s.jsx)(n.p,{children:"C(cache) PPO = VPO:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Page Frame (\u5E27): \u9AD8\u4F4D\u4E3A\u5E27\u53F7, \u4F4E\u4F4D\u4E3A\u504F\u79FB."}),"\n",(0,s.jsxs)(n.li,{children:["Physical Address =\n",(0,s.jsx)(n.code,{children:"2^(bits of phy page offset) * phy page/frame frame number + phy page offset"})]}),"\n",(0,s.jsx)(n.li,{children:"PA = PPN (physical page number) + PPO (physical page offset = VPO)."}),"\n",(0,s.jsx)(n.li,{children:"CA = CT(tag) + CI(index) + CO(offset)."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u9875\u8868",children:"\u9875\u8868"}),"\n",(0,s.jsx)(n.p,{children:"\u9875\u8868\u7531\u64CD\u4F5C\u7CFB\u7EDF\u5EFA\u7ACB, \u786C\u4EF6(CPU/MMU)\u6839\u636E\u9875\u8868\u4FE1\u606F\u5C06\u865A\u62DF\u5730\u5740\u6620\u5C04\u4E3A\u7269\u7406\u5730\u5740:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"FN/PPN"}),"\n",(0,s.jsxs)(n.li,{children:["\u6807\u5FD7\u4F4D: ",(0,s.jsx)(n.code,{children:"resident"})," bit (\u5B58\u5728\u4F4D) + ",(0,s.jsx)(n.code,{children:"dirty"})," bit (\u4FEE\u6539\u4F4D) + ",(0,s.jsx)(n.code,{children:"reference"})," bit (\u5F15\u7528\u4F4D)"]}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Cons",type:"caution",children:(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u4E24\u6B21\u8BBF\u5B58: \u7B2C\u4E00\u6B21\u83B7\u53D6\u9875\u8868\u9879, \u7B2C\u4E8C\u6B21\u8BBF\u95EE\u5B9E\u9645\u6570\u636E"}),"\n",(0,s.jsx)(n.li,{children:"\u9875\u8868\u5360\u636E\u5927\u91CF\u5185\u5B58\u5355\u5143"}),"\n"]})}),"\n",(0,s.jsx)(n.h3,{id:"tlb",children:"TLB"}),"\n",(0,s.jsx)(n.p,{children:"Translation Lookaside Buffer:"}),"\n",(0,s.jsx)(n.p,{children:"\u7F13\u5B58\u9875\u8868\u9879 - key: VPN, value: PPN \u4E0D\u7528\u8BBF\u95EE\u9875\u8868."}),"\n",(0,s.jsx)(n.h3,{id:"\u591A\u7EA7\u9875\u8868",children:"\u591A\u7EA7\u9875\u8868"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5207\u5272\u9875\u8868: \u5EFA\u7ACB\u5B50\u9875\u8868"}),"\n",(0,s.jsx)(n.li,{children:"Page Directory -> Page Table -> Physical Address"}),"\n",(0,s.jsx)(n.li,{children:"\u5C06\u7EBF\u6027\u5730\u5740\u5206\u6210\u4E09\u90E8\u5206 Directory+Table+Offset:\ncr3+Dir \u53D6\u51FA page table base,\nptb+Tab \u53D6\u51FA physical address base, pab+offset = pa"}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"CR3 \u5BC4\u5B58\u5668: \u4FDD\u5B58\u4E00\u7EA7\u9875\u8868\u7684\u57FA\u5740"}),"\n"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u7236\u9875\u8868\u8868\u9879\u4FDD\u5B58\u5B50\u9875\u8868\u8D77\u59CB\u5730\u5740, \u903B\u8F91\u5730\u5740\u67D0\u90E8\u5206\u4FDD\u5B58\u504F\u79FB\u5730\u5740(\u5B50\u8868\u9879\u53F7)"}),"\n",(0,s.jsx)(n.li,{children:"\u5B58\u5728\u4F4D\u4E3A 0 \u65F6, \u4E0D\u7528\u4FDD\u5B58\u5B50\u8868, \u8282\u7701\u5185\u5B58\u5355\u5143"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u53CD\u7F6E\u9875\u8868",children:"\u53CD\u7F6E\u9875\u8868"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"PPN \u4F5C\u4E3A\u9875\u8868\u7D22\u5F15, \u9875\u8868\u9879\u4FDD\u5B58 VPN(\u6216\u8005 Hash(VPN|PID))"}),"\n",(0,s.jsx)(n.li,{children:"\u5C06 VPN \u6620\u5C04\u4E3A PPN \u65F6, \u9700\u904D\u5386\u6574\u4E2A\u9875\u8868(\u4F46\u6B64\u9875\u8868\u53EA\u5360\u7528\u5C11\u91CF\u5185\u5B58\u5355\u5143)"}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u6BB5\u9875\u5F0F",children:"\u6BB5\u9875\u5F0F"}),"\n",(0,s.jsx)(n.p,{children:"\u5728\u9875\u5F0F\u5B58\u50A8\u7BA1\u7406\u57FA\u7840\u4E0A, \u5F15\u5165\u6BB5\u5F0F\u5B58\u50A8\u7BA1\u7406"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"<--- vsn --- vpn --- vpo ---\x3e"})," \u6620\u5C04\u4E3A ",(0,s.jsx)(n.code,{children:"<--- ppn --- ppo ---\x3e"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["sn: segment number, pn",":page"," number, po: page offset"]}),"\n"]}),"\n",(0,s.jsxs)(n.p,{children:["\u82E5\u4EE5 4K(limit) \u4E3A 1 \u4E2A\u9875\u8868\u5927\u5C0F, \u5219\u4E0B\u7EA7\u9875\u8868\u9996\u5740\u4E3A ",(0,s.jsx)(n.code,{children:"\u6BB5/\u9875\u8868\u4E2D\u67D0\u9879\u7684\u503C << 12"}),"(2^12 = 4K)"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u4EE5 vsn \u4E3A\u7D22\u5F15\u5728\u8FDB\u7A0B\u6BB5\u8868\u4E2D\u627E\u5230\u6BB5\u8868\u9879,\n\u83B7\u53D6\u6BB5(\u9875\u8868)\u57FA\u5740\u4E0E\u6BB5\u5927\u5C0F\u4FE1\u606F(item_value/limit):\nbase = item_value ",(0,s.jsx)(n.code,{children:"<<"})," log2(limit)"]}),"\n",(0,s.jsx)(n.li,{children:"\u4EE5 vpn \u4E3A\u7D22\u5F15\u5728\u8FDB\u7A0B\u9875\u8868(\u9875\u8868\u57FA\u5740 = base \u4E2D\u627E\u5230\u9875\u8868\u9879, \u83B7\u53D6 ppn"}),"\n",(0,s.jsxs)(n.li,{children:["ppn ",(0,s.jsx)(n.code,{children:"<<"})," log2(limit) + vpo(ppo) \u4E3A\u5B9E\u9645\u7269\u7406\u5730\u5740"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"\u865A\u62DF\u9875\u5F0F",children:"\u865A\u62DF\u9875\u5F0F"}),"\n",(0,s.jsx)(n.p,{children:"\u865A\u62DF\u5185\u5B58 = \u7269\u7406\u5185\u5B58 + \u5916\u5B58:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u53EA\u5C06\u8FD0\u884C\u8FDB\u7A0B\u6240\u5FC5\u9700\u9875\u9762\u88C5\u5165\u5185\u5B58, \u5176\u4F59\u9875\u9762\u81F3\u4E8E\u5916\u5B58"}),"\n",(0,s.jsx)(n.li,{children:"\u8FDB\u7A0B\u53D1\u751F\u7F3A\u9875\u5F02\u5E38\u65F6, \u5C06\u6240\u8981\u6C42\u7F3A\u9875\u88C5\u5165\u5185\u5B58:\n\u9009\u62E9\u76EE\u6807\u7269\u7406\u9875\u9762 -> \u65E0\u672A\u5360\u7528\u7269\u7406\u9875\u9762, \u5219\u6362\u51FA\u95F2\u7F6E\u7269\u7406\u9875\u9762(\u8BBF\u95EE\u4F4D)\n-> \u88C5\u5165\u7269\u7406\u5185\u5B58,\u66F4\u65B0\u9875\u8868\u9879\n(\u6362\u5165\u903B\u8F91\u5730\u5740\u4E0E\u6362\u51FA\u903B\u8F91\u5730\u5740\u5BF9\u5E94\u7684\u9875\u8868\u9879\u7684\u9A7B\u7559\u4F4D/\u4FEE\u6539\u4F4D/\u8BBF\u95EE\u4F4D/\u9501\u5B9A\u4F4D\u4EE5\u53CA\u7269\u7406\u9875\u53F7 ppn)"}),"\n",(0,s.jsx)(n.li,{children:"\u76D1\u63A7\u5DF2\u7ECF\u88C5\u5165\u5185\u5B58\u7684\u9875\u9762, \u53CA\u65F6\u5C06\u4E0D\u9700\u8981\u9875\u9762\u6362\u51FA\u81F3\u5916\u5B58"}),"\n",(0,s.jsx)(n.li,{children:"\u4E3A\u6BCF\u4E2A\u8FDB\u7A0B\u5206\u914D\u4E00\u4E2A vma \u5757, \u6A21\u62DF\u4E00\u4E2A\u5B8C\u6574\u7684\u7269\u7406\u5185\u5B58"}),"\n",(0,s.jsxs)(n.li,{children:["vmas \u6309\u8D77\u59CB",(0,s.jsx)(n.strong,{children:"\u5730\u5740\u4ECE\u5C0F\u81F3\u5927"}),"\u5F62\u6210\u4E00\u4E2A\u53CC\u5411\u94FE\u8868, \u4E14\u5730\u5740\u7A7A\u95F4",(0,s.jsx)(n.strong,{children:"\u6CA1\u6709\u4EFB\u4F55\u4EA4\u96C6"})]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"#define VM_READ  0x00000001\n#define VM_WRITE 0x00000002\n#define VM_EXEC  0x00000004\n#define VM_USER  (VM_READ | VM_WRITE | VM_EXEC)\n\ntypedef struct __mm {\n    list_entry_t mmap_list; // header of vmas' list\n    vma *mmap_cache;        // current accessed vma(used for speed purpose)\n    pde_t *pgdir;           // PDT for vmas\n    int map_count;          // count of vmas\n    void *sm_priv;          // private data for swap manager\n} mm;\n\ntypedef struct __vma {\n    struct mm *vm_mm;       // all vmas use the same PDT(page directory table)\n    uintptr_t vm_start;     // start address of vma (align to PGSIZE)\n    uintptr_t vm_end;       // end address of vma   (align to PGSIZE)\n    uint32_t vm_flags;      // flags of vma\n    list_entry_t vma_list;  // doubly linked list: sort all vmas by start address\n} vma;\n"})}),"\n",(0,s.jsx)(n.h2,{id:"page-fault",children:"Page Fault"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u865A\u62DF\u5730\u5740\u8D8A\u754C: \u8BBF\u95EE\u4E0D\u5B58\u5728\u7684\u865A\u62DF\u5730\u5740"}),"\n",(0,s.jsx)(n.li,{children:"\u5BF9\u53EA\u8BFB\u5730\u5740\u8FDB\u884C\u5199\u64CD\u4F5C"}),"\n",(0,s.jsx)(n.li,{children:"\u8BBF\u95EE\u672A\u6620\u5C04\u865A\u62DF\u9875 (swap in/out)"}),"\n",(0,s.jsxs)(n.li,{children:["CPU \u5C06\u4EA7\u751F\u5F02\u5E38\u7684\u7684\u7EBF\u6027\u5730\u5740 (linear address) \u5B58\u50A8\u5728 ",(0,s.jsx)(n.code,{children:"CR2"})," \u5BC4\u5B58\u5668\u4E2D,\n\u5C06 errorCode (2 -> \u8BBF\u95EE\u6743\u9650\u5F02\u5E38, 1 -> \u5199\u5F02\u5E38, 0 -> \u7269\u7406\u9875\u4E0D\u5B58\u5728) \u538B\u5165\u4E2D\u65AD\u6808"]}),"\n"]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:"CR0: \u5904\u7406\u5668\u6A21\u5F0F (\u5B9E/\u4FDD\u62A4/\u5206\u6BB5/\u5206\u9875\u6A21\u5F0F)\nCR2: Page Fault Linear Address\nCR3: Page-Directory Base Address Register"}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5F53\u51FA\u73B0\u7F3A\u9875\u5F02\u5E38\u4E14\u7269\u7406\u5185\u5B58\u5DF2\u6EE1\u65F6, \u9700\u8981\u4EE5\u9875\u9762\u7F6E\u6362\u7B97\u6CD5\u4E3A\u6307\u5BFC, \u6362\u51FA\u95F2\u7F6E\u7269\u7406\u9875\u9762, \u6362\u5165\u6240\u8981\u6C42\u7F3A\u9875, \u5E76\u66F4\u65B0\u9875\u8868\u9879:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5C3D\u53EF\u80FD\u51CF\u5C11\u7269\u7406\u9875\u9762\u7684\u6362\u5165\u6362\u51FA\u6B21\u6570"}),"\n",(0,s.jsx)(n.li,{children:"\u53EA\u53EF\u4EA4\u6362\u6620\u5C04\u5230\u7528\u6237\u7A7A\u95F4\u7684\u7269\u7406\u9875"}),"\n",(0,s.jsxs)(n.li,{children:["\u5F53\u9875\u8868\u9879\u4E2D ",(0,s.jsx)(n.code,{children:"PTE_P"})," \u4E3A 0 \u65F6, \u5BF9\u5E94\u9AD8\u4F4D\u5730\u5740\u8868\u793A\u6247\u533A\u5730\u5740(\u800C\u4E0D\u662F\u7269\u7406\u4F4D\u79FB)"]}),"\n",(0,s.jsxs)(n.li,{children:["\u6362\u5165\u65F6\u673A: ",(0,s.jsx)(n.code,{children:"Page Fault"})," \u7F3A\u9875"]}),"\n",(0,s.jsx)(n.li,{children:"\u6362\u51FA\u65F6\u673A: \u79EF\u6781/\u6D88\u6781\u6362\u51FA\u7B56\u7565"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u8986\u76D6",children:"\u8986\u76D6"}),"\n",(0,s.jsx)(n.p,{children:"Overlay:"}),"\n",(0,s.jsx)(n.p,{children:"\u5C06\u7A0B\u5E8F\u4E2D\u76F8\u4E92\u72EC\u7ACB\u7684\u6A21\u5757\u5206\u6210\u4E00\u7EC4, \u4E3A\u6BCF\u7EC4\u6309\u6700\u5927\u6A21\u5757\u5206\u914D\u5185\u5B58\u5355\u5143"}),"\n",(0,s.jsx)(n.h3,{id:"\u4EA4\u6362",children:"\u4EA4\u6362"}),"\n",(0,s.jsx)(n.p,{children:"Swap:"}),"\n",(0,s.jsx)(n.p,{children:"\u5C06\u6302\u8D77\u8FDB\u7A0B\u7684\u6574\u4E2A\u5730\u5740\u7A7A\u95F4\u6362\u51FA\u81F3\u5916\u5B58(swap out), \u5C06\u9700\u7528\u8FDB\u7A0B\u7684\u6574\u4E2A\u5730\u5740\u7A7A\u95F4\u6362\u5165\u81F3\u5185\u5B58(swap in), \u8FDB\u7A0B\u4EA4\u66FF\u8FD0\u884C"}),"\n",(0,s.jsx)(n.h3,{id:"\u6807\u5FD7\u4F4D",children:"\u6807\u5FD7\u4F4D"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u9A7B\u7559\u4F4D: \u6B64\u903B\u8F91\u5730\u5740\u5BF9\u5E94\u7684\u9875\u9762\u5728\u5185\u5B58\u4E2D"}),"\n",(0,s.jsx)(n.li,{children:"\u4FEE\u6539\u4F4D: \u6B64\u9875\u9762\u662F\u5426\u88AB\u4FEE\u6539\u8FC7, \u5224\u5B9A\u6B64\u9875\u9762\u6362\u51FA\u65F6\u7B56\u7565(\u5199\u56DE\u5916\u5B58/\u76F4\u63A5\u4E22\u5F03)"}),"\n",(0,s.jsx)(n.li,{children:"\u8BBF\u95EE\u4F4D: \u6B64\u9875\u9762\u662F\u5426\u88AB\u8BFB/\u5199\u8FC7, \u5224\u5B9A\u6B64\u9875\u9762\u662F\u5426\u9700\u8981\u6362\u51FA\u81F3\u5916\u5B58"}),"\n",(0,s.jsx)(n.li,{children:"\u9501\u5B9A\u4F4D: \u6B64\u9875\u9762\u4E0D\u4F1A\u88AB\u6362\u51FA"}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5C40\u90E8\u7F6E\u6362",children:"\u5C40\u90E8\u7F6E\u6362"}),"\n",(0,s.jsx)(n.p,{children:"\u6362\u5165\u8FDB\u7A0B A \u7684\u67D0\u4E2A\u9875\u9762\u65F6, \u53EA\u53EF\u6362\u51FA\u8FDB\u7A0B A \u7684\u67D0\u4E2A\u9875\u9762: \u4E3A\u8FDB\u7A0B\u5206\u914D\u56FA\u5B9A\u6570\u76EE\u7684\u9875\u9762"}),"\n",(0,s.jsx)(n.h4,{id:"\u6700\u8FDC\u672A\u7528",children:"\u6700\u8FDC\u672A\u7528"}),"\n",(0,s.jsx)(n.p,{children:"Least Recently Used (LRU) Algorithm:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5229\u7528",(0,s.jsx)(n.strong,{children:"\u94FE\u8868\u7B49\u7EBF\u6027\u7ED3\u6784"}),"\u7EF4\u62A4\u9875\u9762\u8BBF\u95EE\u65F6\u95F4, \u961F\u9996\u4E3A\u6700\u8FD1\u4E00\u6B21\u8BBF\u95EE\u9875\u9762(\u6BCF\u6B21\u8BBF\u95EE\u4E00\u4E2A\u9875\u9762\u540E, \u628A\u5B83\u4ECE\u7EBF\u6027\u7ED3\u6784\u4E2D\u95F4\u62BD\u51FA\u81F3\u961F\u9996), \u961F\u5C3E\u4E3A\u6700\u8FDC\u4E00\u6B21\u8BBF\u95EE\u9875\u9762"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"\u65F6\u949F",children:"\u65F6\u949F"}),"\n",(0,s.jsx)(n.p,{children:"Clock Algorithm:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5229\u7528",(0,s.jsx)(n.strong,{children:"\u5FAA\u73AF\u94FE\u8868"}),"\u7EF4\u62A4\u9875\u9762(\u6307\u9488\u6307\u5411\u6700\u5148\u6362\u5165\u5185\u5B58\u7684\u9875\u9762), \u9875\u8868\u9879\u8BBF\u95EE\u4F4D\u7EF4\u62A4\u8BBF\u95EE\u8BB0\u5F55(\u8BBF\u95EE\u540E\u5C06\u8BBF\u95EE\u4F4D\u7F6E 1)"]}),"\n",(0,s.jsx)(n.li,{children:"\u7F3A\u9875\u65F6, \u4ECE\u6307\u9488\u5904\u5F00\u59CB\u67E5\u627E\u9875\u9762\u8FDB\u884C\u7F6E\u6362: \u82E5\u8BBF\u95EE\u4F4D\u4E3A 0, \u5219\u8FDB\u884C\u7F6E\u6362; \u82E5\u8BBF\u95EE\u4F4D\u4E3A 1, \u5219\u5C06\u6B64\u9875\u9762\u8BBF\u95EE\u4F4D\u7F6E 0, \u7EE7\u7EED\u67E5\u627E\u672A\u8BBF\u95EE\u9875\u9762"}),"\n",(0,s.jsx)(n.li,{children:"\u6539\u8FDB: \u589E\u52A0\u4FEE\u6539\u4F4D"}),"\n"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u6307\u9488\u626B\u63CF\u524D"}),(0,s.jsx)(n.th,{style:{textAlign:"left"},children:"\u6307\u9488\u626B\u63CF\u540E"})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u8BBF\u95EE\u4F4D \u4FEE\u6539\u4F4D"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u8BBF\u95EE\u4F4D \u4FEE\u6539\u4F4D"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"0 0"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"\u7F6E\u6362"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"0 1"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"0 0"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"1 0"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"0 0"})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"1 1"}),(0,s.jsx)(n.td,{style:{textAlign:"left"},children:"0 1"})]})]})]}),"\n",(0,s.jsx)(n.h4,{id:"\u6700\u4E0D\u5E38\u7528",children:"\u6700\u4E0D\u5E38\u7528"}),"\n",(0,s.jsx)(n.p,{children:"Least Frequently Used (LFU) Algorithm:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5229\u7528",(0,s.jsx)(n.strong,{children:"\u94FE\u8868\u7B49\u7EBF\u6027\u7ED3\u6784"}),"\u7EF4\u62A4\u9875\u9762\u8BBF\u95EE\u65F6\u95F4, \u961F\u9996\u4E3A\u6700\u591A\u8BBF\u95EE\u6B21\u6570\u9875\u9762(\u6BCF\u6B21\u8BBF\u95EE\u4E00\u4E2A\u9875\u9762\u540E, \u8BBF\u95EE\u6B21\u6570+1, \u5E76\u6392\u5E8F), \u961F\u5C3E\u4E3A\u6700\u5C11\u8BBF\u95EE\u6B21\u6570\u9875\u9762"]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"\u5168\u5C40\u7F6E\u6362",children:"\u5168\u5C40\u7F6E\u6362"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u6362\u5165\u8FDB\u7A0B A \u7684\u67D0\u4E2A\u9875\u9762\u65F6, \u53EF\u6362\u51FA\u5176\u4ED6\u8FDB\u7A0B\u7684\u67D0\u4E2A\u9875\u9762: \u4E3A\u8FDB\u7A0B\u5206\u914D\u53EF\u53D8\u6570\u76EE\u7684\u9875\u9762"}),"\n",(0,s.jsx)(n.li,{children:"\u5173\u952E: \u786E\u5B9A\u4E3A\u4E0D\u540C\u8FDB\u7A0B\u5206\u914D\u7684\u9875\u9762\u6570\u76EE"}),"\n",(0,s.jsxs)(n.li,{children:["\u6296\u52A8(thrashing): \u8FDB\u7A0B\u8FC7\u591A, \u5BFC\u81F4\u5927\u90E8\u5206\u8FDB\u7A0B\u7684\u5E38\u9A7B\u96C6 ",(0,s.jsx)(n.code,{children:"<"})," \u5DE5\u4F5C\u96C6, \u7F3A\u9875\u7387\u8F83\u9AD8"]}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"\u5DE5\u4F5C\u96C6",children:"\u5DE5\u4F5C\u96C6"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5DE5\u4F5C\u96C6(\u968F\u65F6\u95F4\u52A8\u6001\u53D8\u5316\u96C6): \u4E00\u4E2A\u8FDB\u7A0B\u5F53\u524D\u6B63\u5728\u4F7F\u7528\u7684\u903B\u8F91\u9875\u9762\u96C6\u5408,\nWorkingSet(currentTime, workingSetWindow(\u8BBF\u95EE\u65F6\u95F4\u7A97\u53E3)) ",(0,s.jsx)(n.code,{children:"(cT - wSW, cT + wSW)"})]}),"\n",(0,s.jsx)(n.li,{children:"\u6839\u636E\u5DE5\u4F5C\u96C6\u5927\u5C0F(\u903B\u8F91\u9875\u9762\u96C6\u5408), \u4E3A\u8BE5\u8FDB\u7A0B\u5206\u914D\u5E38\u9A7B\u96C6(\u5408\u9002\u6570\u76EE\u7684\u7269\u7406\u9875\u9762\u96C6\u5408): \u82E5\u5E38\u9A7B\u96C6 > \u5DE5\u4F5C\u96C6, \u5219\u7F3A\u9875\u7387\u8F83\u4F4E"}),"\n",(0,s.jsx)(n.li,{children:"\u518D\u989D\u5916\u7EF4\u62A4\u4E00\u4E2A\u7C7B\u5E0C LRU \u7B97\u6CD5\u4E2D\u7684\u8BBF\u5B58\u94FE\u8868, \u8BB0\u5F55\u8FD1\u671F\u8BBF\u95EE\u8FC7\u7684\u7269\u7406\u9875\u9762, \u5C06\u5176\u4E5F\u52A0\u5165\u5E38\u9A7B\u96C6"}),"\n"]}),"\n",(0,s.jsx)(n.h4,{id:"\u7F3A\u9875\u7387",children:"\u7F3A\u9875\u7387"}),"\n",(0,s.jsx)(n.p,{children:"\u5F53\u7F3A\u9875\u9891\u7E41\u65F6, \u7F3A\u9875\u65F6\u5C06\u7F3A\u9875\u7684\u9875\u9762\u52A0\u5165\u5E38\u9A7B\u96C6; \u5F53\u7F3A\u9875\u4E0D\u9891\u7E41\u65F6, \u7F3A\u9875\u65F6\u5C06\u4E0D\u5C5E\u4E8E\u5DE5\u4F5C\u96C6\u7684\u9875\u9762\u79FB\u51FA\u5E38\u9A7B\u96C6"}),"\n",(0,s.jsx)(n.h2,{id:"toolchain",children:"Toolchain"}),"\n",(0,s.jsx)(n.h3,{id:"perf",children:"Perf"}),"\n",(0,s.jsx)(n.h3,{id:"trace",children:"Trace"}),"\n",(0,s.jsx)(n.h3,{id:"vmstat",children:"Vmstat"}),"\n",(0,s.jsx)(n.p,{children:"check usage of virtual memory and swap region"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"vmstat 2\n"})}),"\n",(0,s.jsx)(n.h3,{id:"pmap",children:"Pmap"}),"\n",(0,s.jsx)(n.p,{children:"check detailed usage of memory"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"pmap PID\n"})}),"\n",(0,s.jsx)(n.h3,{id:"hot-plug",children:"Hot Plug"}),"\n",(0,s.jsxs)(n.p,{children:["Memory hotplug user ",(0,s.jsx)(n.a,{href:"http://www.kernel.org/doc/Documentation/memory-hotplug.txt",children:"guide"}),"."]}),"\n",(0,s.jsx)(n.h3,{id:"tcmalloc",children:"TCMalloc"}),"\n",(0,s.jsx)(n.p,{children:"Google TCMalloc."}),"\n",(0,s.jsx)(n.h3,{id:"oprofile",children:"Oprofile"}),"\n",(0,s.jsxs)(n.p,{children:["Oprofile user ",(0,s.jsx)(n.a,{href:"http://oprofile.sourceforge.net",children:"guide"}),"."]})]})}function x(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},30416(e,n,l){l.d(n,{R:()=>d,x:()=>c});var i=l(59471);let s={},r=i.createContext(s);function d(e){let n=i.useContext(r);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:d(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);