"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["90285"],{57830(e,n,r){r.r(n),r.d(n,{metadata:()=>t,default:()=>u,frontMatter:()=>i,contentTitle:()=>s,toc:()=>c,assets:()=>d});var t=JSON.parse('{"id":"programming/android/storage","title":"Storage","description":"Files","source":"@site/content/programming/android/storage.md","sourceDirName":"programming/android","slug":"/programming/android/storage","permalink":"/notes/programming/android/storage","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/programming/android/storage.md","tags":[{"inline":true,"label":"Programming","permalink":"/notes/tags/programming"},{"inline":true,"label":"Android","permalink":"/notes/tags/android"},{"inline":true,"label":"Storage","permalink":"/notes/tags/storage"},{"inline":true,"label":"File","permalink":"/notes/tags/file"},{"inline":true,"label":"Database","permalink":"/notes/tags/database"},{"inline":true,"label":"Preference","permalink":"/notes/tags/preference"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":11,"frontMatter":{"sidebar_position":11,"tags":["Programming","Android","Storage","File","Database","Preference"]},"sidebar":"tutorialSidebar","previous":{"title":"Broadcast","permalink":"/notes/programming/android/broadcast"},"next":{"title":"Service","permalink":"/notes/programming/android/service"}}'),a=r(62615),l=r(30416);let i={sidebar_position:11,tags:["Programming","Android","Storage","File","Database","Preference"]},s="Storage",d={},c=[{value:"Files",id:"files",level:2},{value:"Shared Preferences",id:"shared-preferences",level:2},{value:"SQLite",id:"sqlite",level:2},{value:"Create Table",id:"create-table",level:3},{value:"Operators",id:"operators",level:3},{value:"Transactions",id:"transactions",level:3},{value:"Content Provider",id:"content-provider",level:2},{value:"Read",id:"read",level:3},{value:"Provide",id:"provide",level:3}];function o(e){let n={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.header,{children:(0,a.jsx)(n.h1,{id:"storage",children:"Storage"})}),"\n",(0,a.jsx)(n.h2,{id:"files",children:"Files"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"/data/data/<packageName>/files/"})}),"\n",(0,a.jsx)(n.p,{children:"Write"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'String data = "Data to save";\nFileOutputStream out = null;\nBufferedWriter writer = null;\ntry {\n    out = openFileOutput("data", Context.MODE_PRIVATE);\n    writer = new BufferedWriter(new OutputStreamWriter(out));\n    writer.write(data);\n} catch (IOException e) {\n    e.printStackTrace();\n} finally {\n    try {\n        if (writer != null) {\n            writer.close();\n        }\n    } catch (IOException e) {\n        e.printStackTrace();\n    }\n}\n'})}),"\n",(0,a.jsx)(n.p,{children:"Read"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'FileInputStream in = null;\nBufferedReader reader = null;\nStringBuilder content = new StringBuilder();\ntry {\n    in = openFileInput("data");\n    reader = new BufferedReader(new InputStreamReader(in));\n    String line = "";\n    while ((line = reader.readLine()) != null) {\n        content.append(line);\n    }\n} catch (IOException e) {\n    e.printStackTrace();\n} finally {\n    if (reader != null) {\n        try {\n            reader.close();\n        } catch (IOException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\nreturn content.toString();\n'})}),"\n",(0,a.jsx)(n.h2,{id:"shared-preferences",children:"Shared Preferences"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"/data/data/<packageName>/shared_preferences/"})}),"\n",(0,a.jsx)(n.p,{children:"Write"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'//get Editor\nSharedPreferences.Editor editor = getSharedPreferences("data", MODE_PRIVATE).edit();\n//store date\neditor.putString("name", "Tom");\neditor.putInt("age", 28);\neditor.putBoolean("married", false);\n//commit\neditor.commit();\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"editor.clear();\n"})}),"\n",(0,a.jsx)(n.p,{children:"clear pref file content"}),"\n",(0,a.jsx)(n.p,{children:"Read"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'SharedPreferences pref = getSharedPreferences("data", MODE_PRIVATE);\n//second argument - default value if target key don\'t exists\nString name = pref.getString("name", "");\nint age = pref.getInt("age", 0);\nboolean married = pref.getBoolean("married", false);\n'})}),"\n",(0,a.jsx)(n.h2,{id:"sqlite",children:"SQLite"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.code,{children:"/data/data/<package name>/databases/"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'@Override\nonCreate()\n@Override\npublic void onUpgrade(SQLiteDatabase db, int oldVersion, int newVersion) {\n    switch (oldVersion) {\n        case 1:\n            db.execSQL(CREATE_CATEGORY);\n        case 2:\n            db.execSQL("alter table Book add column category_id integer");\n        default:\n    }\n}\n'})}),"\n",(0,a.jsxs)(n.p,{children:["Custom \u5B9E\u73B0\u521B\u5EFA\u3001\u5347\u7EA7\u6570\u636E\u5E93\u7684\u903B\u8F91\n\u6784\u5EFA\u51FA SQLiteOpenHelper \u7684\u5B9E\u4F8B\u540E,\u518D\u8C03\u7528",(0,a.jsx)(n.code,{children:"getReadableDatabase()"}),"\u6216",(0,a.jsx)(n.code,{children:"getWritableDatabase()"}),"\u65B9\u6CD5\u521B\u5EFA\u6570\u636E\u5E93"]}),"\n",(0,a.jsx)(n.h3,{id:"create-table",children:"Create Table"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-sql",children:"create table Book (\n    id integer primary key autoIncrement,\n    author text,\n    price real,\n    pages integer,\n    name text\n    )\n"})}),"\n",(0,a.jsx)(n.h3,{id:"operators",children:"Operators"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u521B\u5EFA\u4E00\u4E2A\u65B0\u7684\u6570\u636E\u5E93\u5E76\u8FD4\u56DE\u4E00\u4E2A SQLiteDatabase \u5BF9\u8C61"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"Context.createDatabase(String name,int version ,int mode,CursorFactory factory);\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u5220\u9664\u6570\u636E\u5E93"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'this.deleteDatabase("myDatabase.db");\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u6253\u5F00\u6570\u636E\u5E93"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'SQLiteDatabase my_DataBase =\nthis.openOrCreateDatabase("myDateBase.db",MODE_PRIVATE , null);\nmy_DataBase.close();\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u975E\u67E5\u8BE2 SQL \u6307\u4EE4"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'//\u521B\u5EFA\u4E00\u4E2A\u540D\u4E3A"test"\u5E76\u5E26\u4E24\u4E2A\u53C2\u6570\u7684\u8868\nmy_DataBase.execSQL("CREATE TABLE test (_id INTEGER PRIMARY KEY,\nsomeNumber INTEGER);");\n//\u5728\u6570\u636E\u5E93\u4E2D\u63D2\u5165\u4E00\u4E2A\u5143\u7EC4\nmy_DataBase.execSQL("INSERT INTO test (_id,someNumber) values(1,8);");\n\nSQLiteDatabase db = dbHelper.getWritableDatabase();\n\n//INSERT\nContentValues values = new ContentValues();\n// \u5F00\u59CB\u7EC4\u88C5\u7B2C\u4E00\u6761\u6570\u636E\nvalues.put("name", "The Da Vinci Code");\nvalues.put("author", "Dan Brown");\nvalues.put("pages", 454);\nvalues.put("price", 16.96);\ndb.insert("Book", null, values); // \u63D2\u5165\u7B2C\u4E00\u6761\u6570\u636E\nvalues.clear();\n// \u5F00\u59CB\u7EC4\u88C5\u7B2C\u4E8C\u6761\u6570\u636E\nvalues.put("name", "The Lost Symbol");\nvalues.put("author", "Dan Brown");\nvalues.put("pages", 510);\nvalues.put("price", 19.95);\ndb.insert("Book", null, values); // \u63D2\u5165\u7B2C\u4E8C\u6761\u6570\u636E\n\n//update\nContentValues values = new ContentValues();\nvalues.put("price", 10.99);\ndb.update("Book", values, "name = ?", new String[] { "The DaVinci Code"  });\n\n//delete\ndb.delete("Book", "pages > ?", new String[] { "500"  });\n\n//\u5220\u9664\u8868\nmy_DataBase.execSQL("DROP TABLE test");\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["\u67E5\u8BE2 SQL \u6307\u4EE4-\u6E38\u6807 Cursors","\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:(0,a.jsx)(n.code,{children:"query()"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{style:{textAlign:"left"},children:"\u65B9\u6CD5\u53C2\u6570"}),(0,a.jsx)(n.th,{style:{textAlign:"left"},children:"\u5BF9\u5E94 SQL \u90E8\u5206"}),(0,a.jsx)(n.th,{style:{textAlign:"left"},children:"\u63CF\u8FF0"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"table"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"from tableName"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5B9A\u67E5\u8BE2\u7684\u8868\u540D"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"columns"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"select column1, column2"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5B9A\u67E5\u8BE2\u7684\u5217\u540D"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"selection"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"where column = value"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5B9A where \u7684\u7EA6\u675F\u6761\u4EF6"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"selectionArgs"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"-"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u4E3A where \u4E2D\u7684\u5360\u4F4D\u7B26\u63D0\u4F9B\u5177\u4F53\u7684\u503C"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"groupBy"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"group by column"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5B9A\u9700\u8981 group by \u7684\u5217"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"having"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"having column = value"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u5BF9 group by \u540E\u7684\u7ED3\u679C\u8FDB\u4E00\u6B65\u7EA6\u675F"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"orderBy"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"order by column1, column2"}),(0,a.jsx)(n.td,{style:{textAlign:"left"},children:"\u6307\u5B9A\u67E5\u8BE2\u7ED3\u679C\u7684\u6392\u5E8F\u65B9\u5F0F"})]})]})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'SQLiteDatabase db = dbHelper.getWritableDatabase();\n// \u67E5\u8BE2Book\u8868\u4E2D\u6240\u6709\u7684\u6570\u636E\nCursor cursor = db.query("Book", null, null, null, null, null, null);\n// \u904D\u5386Cursor\u5BF9\u8C61,\u53D6\u51FA\u6570\u636E\n//cursor.moveToFirst()\n//cursor.moveToNext()\nString name = cursor.getString(cursor.getColumnIndex("name"));\nString author = cursor.getString(cursor.getColumnIndex("author"));\nint pages = cursor.getInt(cursor.getColumnIndex("pages"));\ndouble price = cursor.getDouble(cursor.getColumnIndex("price"));\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'//\u4E3A\u4E86\u521B\u5EFA\u4E00\u4E2ACursor(\u6E38\u6807),\u5FC5\u987B\u6267\u884C\u4E00\u4E2A\u67E5\u8BE2,\u8981\u4E48\u901A\u8FC7SQL\u4F7F\u7528rawQuery()\u65B9\u6CD5\n//\u6216\u662F\u66F4\u7CBE\u5FC3\u8BBE\u8BA1\u7684\u65B9\u6CD5,\u50CFquery()\u65B9\u6CD5\nCursor cur = my_DataBase.rawQuery("SELECT * FORM test", null);\n\nif(cur!=null) {//\u6E38\u6807\u4E0D\u4E3A\u7A7A\n    //\u8FD4\u56DE\u7ED9\u5B9A\u540D\u79F0\u7684\u5217\u7684\u57FA\u4E8E0\u5F00\u59CB\u7684index,\u5982\u679C\u8BE5\u5C5E\u6027\u5217\u4E0D\u5B58\u5728\u5219\u8FD4\u56DE-1\n    //\u901A\u8FC7\u5B83\u4EEC\u7684index\u6765\u68C0\u7D22\u5C5E\u6027\u503C\n    int numColumn=cur.getColumnIndex("someNumber");\n\n    if(cur.moveToFirst()) {\n        //cur.moveToFirst()\u8BA9\u6E38\u6807\u6307\u5411\u7B2C\u4E00\u884C,\u5982\u679C\u6E38\u6807\u6307\u5411\u7B2C\u4E00\u884C,\u5219\u8FD4\u56DEtrue\n        do {\n        int num=cur.getInt(numColumn);//\u83B7\u5F97\u5F53\u524D\u884C\u8BE5\u5C5E\u6027\u7684\u503C\n        /*Cursor\u63D0\u4F9B\u4E86\u4E0D\u540C\u7684\u65B9\u6CD5\u6765\u56DE\u7D22\u4E0D\u540C\u7684\u6570\u636E\u7C7B\u578B\n        \u4F8B\u5982getInt(int index)/getString(int index)\u7B49\u7B49*/\n        /*\u505A\u4E00\u4E9B\u4E8B\u60C5*/\n        } while (cur.moveToNext());\n        /*\u6E38\u6807\u79FB\u52A8\u5230\u4E0B\u4E00\u884C,\u5982\u679C\u6E38\u6807\u5DF2\u7ECF\u901A\u8FC7\u4E86\u7ED3\u679C\u96C6\u4E2D\u7684\u6700\u540E,\n        \u5373\u6CA1\u6709\u884C\u53EF\u4EE5\u79FB\u52A8\u65F6,\u5219\u8FD4\u56DEfalse*/\n        //\u5176\u4ED6\u53EF\u80FD\u79FB\u52A8\u7684\u662F previous() \u548Cfirst()\u65B9\u6CD5\n    }\n}\n'})}),"\n",(0,a.jsx)(n.h3,{id:"transactions",children:"Transactions"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:["SQLiteDatabase \u7684",(0,a.jsx)(n.code,{children:"beginTransaction()"}),"\u65B9\u6CD5"]}),"\n",(0,a.jsxs)(n.li,{children:["\u8C03\u7528",(0,a.jsx)(n.code,{children:"setTransactionSuccessful()"}),"\u8868\u793A\u4E8B\u52A1\u5DF2\u7ECF\u6267\u884C\u6210\u529F"]}),"\n",(0,a.jsxs)(n.li,{children:["finally \u4EE3\u7801\u5757\u4E2D\u8C03\u7528",(0,a.jsx)(n.code,{children:"endTransaction()"}),"\u6765\u7ED3\u675F\u4E8B\u52A1"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"content-provider",children:"Content Provider"}),"\n",(0,a.jsx)(n.h3,{id:"read",children:"Read"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:'Uri uri = Uri.parse("content://com.example.app.provider/table1");\ngetContentResolver().query/insert/delete/update();\n'})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"ContactsContract.CommonDataKinds.Phone.DISPLAY_NAME"}),"\n",(0,a.jsx)(n.li,{children:"ContactsContract.CommonDataKinds.Phone.NUMBER"}),"\n"]}),"\n",(0,a.jsx)(n.h3,{id:"provide",children:"Provide"}),"\n",(0,a.jsx)(n.p,{children:"With ContentProvider:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"public class MyProvider extends ContentProvider {\n    @Override\n    public boolean onCreate() {\n        return false;\n    }\n    @Override\n    public Cursor query(Uri uri, String[] projection, String selection,\n      String[] selectionArgs, String sortOrder) {\n        return null;\n    }\n    @Override\n    public Uri insert(Uri uri, ContentValues values) {\n        return null;\n    }\n    @Override\n    public int update(Uri uri, ContentValues values, String selection,\n      String[] selectionArgs) {\n        return 0;\n    }\n    @Override\n    public int delete(Uri uri, String selection, String[] selectionArgs) {\n        return 0;\n    }\n    @Override\n    public String getType(Uri uri) {\n        return null;\n    }\n}\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-java",children:"UriMatcher.addURI(uri, customNumber)/.match(uri)\n"})}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsx)(n.li,{children:"\u4E3A\u4F20\u5165 URI \u6307\u5B9A\u81EA\u5B9A\u4E49\u5E38\u91CF\u4F5C\u4E3A\u4EE3\u53F7"}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},30416(e,n,r){r.d(n,{R:()=>i,x:()=>s});var t=r(59471);let a={},l=t.createContext(a);function i(e){let n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:i(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);