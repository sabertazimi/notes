"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["48482"],{51644(e,n,r){r.r(n),r.d(n,{metadata:()=>s,default:()=>h,frontMatter:()=>l,contentTitle:()=>c,toc:()=>o,assets:()=>d});var s=JSON.parse('{"id":"web/security/csrf","title":"CSRF","description":"Attack","source":"@site/content/web/security/csrf.md","sourceDirName":"web/security","slug":"/web/security/csrf","permalink":"/notes/web/security/csrf","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/security/csrf.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Security","permalink":"/notes/tags/security"},{"inline":true,"label":"CSRF","permalink":"/notes/tags/csrf"},{"inline":true,"label":"Vulnerability","permalink":"/notes/tags/vulnerability"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":11,"frontMatter":{"sidebar_position":11,"tags":["Web","Security","CSRF","Vulnerability"]},"sidebar":"tutorialSidebar","previous":{"title":"XSS","permalink":"/notes/web/security/xss"},"next":{"title":"SQL Injection","permalink":"/notes/web/security/sql"}}'),i=r(62615),t=r(30416);let l={sidebar_position:11,tags:["Web","Security","CSRF","Vulnerability"]},c="CSRF",d={},o=[{value:"Attack",id:"attack",level:2},{value:"Protection",id:"protection",level:2}];function a(e){let n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"csrf",children:"CSRF"})}),"\n",(0,i.jsx)(n.h2,{id:"attack",children:"Attack"}),"\n",(0,i.jsxs)(n.p,{children:["Cross-site request forgery (\u8DE8\u7AD9\u8BF7\u6C42\u4F2A\u9020)\n\u631F\u5236\u7528\u6237\u5728\u5F53\u524D\u5DF2\u767B\u5F55\u7684 Web \u5E94\u7528\u7A0B\u5E8F\u4E0A\u6267\u884C",(0,i.jsx)(n.strong,{children:"\u975E\u672C\u610F"}),"\u7684\u64CD\u4F5C,\n\u5229\u7528\u5DF2\u8BA4\u8BC1\u7528\u6237 (\u957F\u671F\u672C\u5730 ",(0,i.jsx)(n.code,{children:"Cookie"}),"), \u8BBF\u95EE\u653B\u51FB\u8005\u7F51\u7AD9, \u5E76\u88AB\u5F3A\u5236\u6267\u884C\u811A\u672C,\n\u5728\u7528\u6237\u4E0D\u77E5\u60C5\u7684\u60C5\u51B5\u4E0B\u63D0\u4EA4 ",(0,i.jsx)(n.code,{children:"GET"}),"/",(0,i.jsx)(n.code,{children:"POST"})," request (\u957F\u671F\u672C\u5730 ",(0,i.jsx)(n.code,{children:"Cookie"}),"):"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<link href="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<a href="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<img src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<img lowsrc="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<img dynsrc="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<iframe src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<frame src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<meta http-equiv="refresh" content="0; url=">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<script src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<bgsound src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<embed src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<video src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<audio src="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<table background="">'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'@import ""'}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'background: url("")'}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.admonition,{title:"XSS vs CSRF",type:"tip",children:(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"XSS \u5229\u7528\u7684\u662F\u7F51\u7AD9\u5BF9\u7528\u6237 (\u8F93\u5165) \u7684\u4FE1\u4EFB."}),"\n",(0,i.jsx)(n.li,{children:"CSRF \u5229\u7528\u7684\u662F\u7F51\u7AD9\u5BF9\u7528\u6237\u7F51\u9875\u6D4F\u89C8\u5668\u7684\u4FE1\u4EFB."}),"\n"]})}),"\n",(0,i.jsx)(n.h2,{id:"protection",children:"Protection"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"REST"})," (representational state transfer) \u539F\u5219:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"GET"})," request: only read objects, \u786E\u4FDD\u65E0\u526F\u4F5C\u7528."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"PUT"})," request: only create new objects."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"POST"})," request: only modify objects."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"DELETE"})," request: only delete objects."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u786E\u4FDD ",(0,i.jsx)(n.code,{children:"request"})," \u6B63\u5E38\u53D1\u8D77\u6E20\u9053:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Anti-CSRF cookie:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u4E0D\u53EF\u9884\u6D4B salt token: ",(0,i.jsx)(n.code,{children:"Set-Cookie: _xsrf=5978e29d4ef434a1"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Hidden token check in ",(0,i.jsx)(n.code,{children:"<form>"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u5F00\u542F\u540C\u6E90\u7B56\u7565: ",(0,i.jsx)(n.code,{children:"Set-Cookie: _xsrf=5978e29d4ef434a1; SameSite=Strict;"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["\u68C0\u67E5 HTTP ",(0,i.jsx)(n.code,{children:"Referer"})," \u8BF7\u6C42\u5934."]}),"\n",(0,i.jsxs)(n.li,{children:["\u68C0\u67E5\u7B2C\u4E09\u65B9\u7F51\u7AD9 ",(0,i.jsx)(n.code,{children:"URL"}),", \u663E\u793A\u7B2C\u4E09\u65B9\u5730\u5740\u8DF3\u8F6C\u8B66\u544A\u9875\u9762:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Remove sensitive data in URL query and ",(0,i.jsx)(n.code,{children:"Referer"})," header."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:'<a href="https://3rd.com" target="_blank" rel="noopener noreferrer nofollow">'}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"Require re-authentication for sensitive action:\n\u652F\u4ED8\u8D26\u5355, \u4FEE\u6539\u90AE\u7BB1, \u5220\u9664\u8D26\u53F7."}),"\n",(0,i.jsxs)(n.li,{children:["Use mature ",(0,i.jsx)(n.code,{children:"CSRF"})," protection library:\nexpress.js ",(0,i.jsx)(n.code,{children:"csurf"})," library."]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-python",children:"# Reject cross-origin requests to protect from\n# CSRF, XSSI & other bugs\ndef allow_request(req):\n  # Allow requests from browsers which don't send Fetch Metadata\n  if not req['sec-fetch-site']:\n    return True\n\n  # Allow same-site and browser-initiated requests\n  if req['sec-fetch-site'] in ('same-origin', 'same-site', 'none'):\n    return True\n\n  # Allow simple top-level navigation from anywhere\n  if req['sec-fetch-mode'] == 'navigate' and req.method == 'GET':\n    return True\n\n  return False\n"})})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},30416(e,n,r){r.d(n,{R:()=>l,x:()=>c});var s=r(59471);let i={},t=s.createContext(i);function l(e){let n=s.useContext(t);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);