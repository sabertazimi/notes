"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["39321"],{77937(e,n,t){t.r(n),t.d(n,{metadata:()=>r,default:()=>u,frontMatter:()=>i,contentTitle:()=>o,toc:()=>c,assets:()=>l});var r=JSON.parse('{"id":"web/javascript/observer","title":"Observer","description":"Intersection","source":"@site/content/web/javascript/observer.md","sourceDirName":"web/javascript","slug":"/web/javascript/observer","permalink":"/notes/web/javascript/observer","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/javascript/observer.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/notes/tags/ecma-script"},{"inline":true,"label":"DOM","permalink":"/notes/tags/dom"},{"inline":true,"label":"Observer","permalink":"/notes/tags/observer"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":35,"frontMatter":{"sidebar_position":35,"tags":["Web","JavaScript","ECMAScript","DOM","Observer"]},"sidebar":"tutorialSidebar","previous":{"title":"Event","permalink":"/notes/web/javascript/event"},"next":{"title":"Fetch","permalink":"/notes/web/javascript/fetch"}}'),s=t(62615),a=t(30416);let i={sidebar_position:35,tags:["Web","JavaScript","ECMAScript","DOM","Observer"]},o="Observer",l={},c=[{value:"Intersection",id:"intersection",level:2},{value:"Mutation",id:"mutation",level:2},{value:"References",id:"references",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"observer",children:"Observer"})}),"\n",(0,s.jsx)(n.h2,{id:"intersection",children:"Intersection"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// <img class=\"lzy_img\" src=\"lazy_img.jpg\" data-src=\"real_img.jpg\" />\ndocument.addEventListener('DOMContentLoaded', () => {\n  const imageObserver = new IntersectionObserver((entries, imgObserver) => {\n    entries.forEach((entry) => {\n      if (entry.isIntersecting) {\n        const lazyImage = entry.target\n        console.log('Lazy loading ', lazyImage)\n        lazyImage.src = lazyImage.dataset.src\n\n        // only load image once\n        lazyImage.classList.remove('lzy')\n        imgObserver.unobserve(lazyImage)\n      }\n    })\n  })\n\n  const lazyImages = document.querySelectorAll('img.lzy_img')\n  lazyImages.forEach(lazyImage => imageObserver.observe(lazyImage))\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"mutation",children:"Mutation"}),"\n",(0,s.jsxs)(n.p,{children:["\u5982\u679C\u6587\u6863\u4E2D\u8FDE\u7EED\u63D2\u5165 1000 \u4E2A ",(0,s.jsx)(n.code,{children:"<li>"})," \u5143\u7D20, \u5C31\u4F1A\u8FDE\u7EED\u89E6\u53D1 1000 \u4E2A\u63D2\u5165\u4E8B\u4EF6,\n\u6267\u884C\u6BCF\u4E2A\u4E8B\u4EF6\u7684\u56DE\u8C03\u51FD\u6570, \u8FD9\u5F88\u53EF\u80FD\u9020\u6210\u6D4F\u89C8\u5668\u7684\u5361\u987F;\nMutation Observer \u53EA\u4F1A\u5728 1000 \u4E2A\u6BB5\u843D\u90FD\u63D2\u5165\u7ED3\u675F\u540E\u624D\u4F1A\u89E6\u53D1, \u4E14\u53EA\u89E6\u53D1\u4E00\u6B21."]}),"\n",(0,s.jsx)(n.p,{children:"Mutation Observer \u6709\u4EE5\u4E0B\u7279\u70B9:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u5B83\u7B49\u5F85\u6240\u6709\u811A\u672C\u4EFB\u52A1\u5B8C\u6210\u540E, \u624D\u4F1A\u8FD0\u884C, \u5373\u91C7\u7528\u5F02\u6B65\u65B9\u5F0F."}),"\n",(0,s.jsx)(n.li,{children:"\u5B83\u628A DOM \u53D8\u52A8\u8BB0\u5F55\u5C01\u88C5\u6210\u4E00\u4E2A\u6570\u7EC4\u8FDB\u884C\u5904\u7406, \u800C\u4E0D\u662F\u4E00\u6761\u6761\u5730\u4E2A\u522B\u5904\u7406 DOM \u53D8\u52A8."}),"\n",(0,s.jsx)(n.li,{children:"\u8BB0\u5F55\u961F\u5217\u548C\u56DE\u8C03\u5904\u7406\u7684\u9ED8\u8BA4\u884C\u4E3A\u662F\u8017\u5C3D\u8FD9\u4E2A\u961F\u5217, \u5904\u7406\u6BCF\u4E2A MutationRecord, \u7136\u540E\u8BA9\u5B83\u4EEC\u8D85\u51FA\u4F5C\u7528\u57DF\u5E76\u88AB\u5783\u573E\u56DE\u6536."}),"\n",(0,s.jsx)(n.li,{children:"MutationObserver \u5B9E\u4F8B\u62E5\u6709\u88AB\u89C2\u5BDF\u76EE\u6807\u8282\u70B9\u7684\u5F31\u5F15\u7528, \u4E0D\u4F1A\u59A8\u788D\u5783\u573E\u56DE\u6536\u7A0B\u5E8F\u56DE\u6536\u76EE\u6807\u8282\u70B9."}),"\n",(0,s.jsx)(n.li,{children:"\u5B83\u5373\u53EF\u4EE5\u89C2\u5BDF\u53D1\u751F\u5728 DOM \u8282\u70B9\u7684\u6240\u6709\u53D8\u52A8, \u4E5F\u53EF\u4EE5\u89C2\u5BDF\u67D0\u4E00\u7C7B\u53D8\u52A8."}),"\n",(0,s.jsxs)(n.li,{children:["\u88AB\u89C2\u5BDF\u5B50\u6811\u4E2D\u7684\u8282\u70B9 (",(0,s.jsx)(n.code,{children:"{ subtree: true }"}),") \u88AB\u79FB\u51FA\u5B50\u6811\u4E4B\u540E\u4ECD\u7136\u80FD\u591F\u89E6\u53D1\u53D8\u5316\u4E8B\u4EF6."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const mutationObserver = new MutationObserver((mutations) => {\n  mutations.forEach((mutation) => {\n    console.log(mutation)\n  })\n})\n\n// \u5F00\u59CB\u4FA6\u542C\u9875\u9762\u7684\u6839 HTML \u5143\u7D20\u4E2D\u7684\u66F4\u6539.\nmutationObserver.observe(document.documentElement, {\n  attributes: true,\n  characterData: true,\n  childList: true,\n  subtree: true,\n  attributeOldValue: true,\n  characterDataOldValue: true,\n})\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const target = document.querySelector('#container')\nfunction callback(mutations, observer) {\n  mutations.forEach((mutation) => {\n    switch (mutation.type) {\n      case 'attributes':\n        // the name of the changed attribute is in\n        // mutation.attributeName\n        // and its old value is in mutation.oldValue\n        // the current value can be retrieved with\n        // target.getAttribute(mutation.attributeName)\n        break\n      case 'childList':\n        // any added nodes are in mutation.addedNodes\n        // any removed nodes are in mutation.removedNodes\n        break\n      default:\n        throw new Error('Unsupported mutation!')\n    }\n  })\n}\n\nconst observer = new MutationObserver(callback)\nobserver.observe(target, {\n  attributes: true,\n  attributeFilter: ['foo'], // only observe attribute 'foo'\n  attributeOldValue: true,\n  childList: true,\n})\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const observer = new MutationObserver(mutationRecords =>\n  console.log(mutationRecords)\n)\n\n// \u521B\u5EFA\u4E24\u4E2A\u521D\u59CB\u5B50\u8282\u70B9\ndocument.body.appendChild(document.createElement('div'))\ndocument.body.appendChild(document.createElement('span'))\n\nobserver.observe(document.body, { childList: true })\n\n// \u4EA4\u6362\u5B50\u8282\u70B9\u987A\u5E8F\ndocument.body.insertBefore(document.body.lastChild, document.body.firstChild)\n// \u53D1\u751F\u4E86\u4E24\u6B21\u53D8\u5316: \u7B2C\u4E00\u6B21\u662F\u8282\u70B9\u88AB\u79FB\u9664, \u7B2C\u4E8C\u6B21\u662F\u8282\u70B9\u88AB\u6DFB\u52A0\n// [\n//   {\n//     addedNodes: NodeList[],\n//     attributeName: null,\n//     attributeNamespace: null,\n//     oldValue: null,\n//     nextSibling: null,\n//     previousSibling: div,\n//     removedNodes: NodeList[span],\n//     target: body,\n//     type: childList,\n//   },\n//   {\n//     addedNodes: NodeList[span],\n//     attributeName: null,\n//     attributeNamespace: null,\n//     oldValue: null,\n//     nextSibling: div,\n//     previousSibling: null,\n//     removedNodes: NodeList[],\n//     target: body,\n//     type: \"childList\",\n//   }\n// ]\n"})}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/IntersectionObserver",children:"Intersection Observer"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/MutationObserver",children:"Mutation Observer"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/ResizeObserver",children:"Resize Observer"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/PerformanceObserver",children:"Performance Observer"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/ReportingObserver",children:"Reporting Observer"})}),"\n"]})]})}function u(e={}){let{wrapper:n}={...(0,a.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},30416(e,n,t){t.d(n,{R:()=>i,x:()=>o});var r=t(59471);let s={},a=r.createContext(s);function i(e){let n=r.useContext(a);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),r.createElement(a.Provider,{value:n},e.children)}}}]);