"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["41231"],{3454(e,n,i){i.r(n),i.d(n,{metadata:()=>r,default:()=>o,frontMatter:()=>s,contentTitle:()=>a,toc:()=>d,assets:()=>c});var r=JSON.parse('{"id":"programming/design/architecture","title":"Architecture","description":"Clean Architecture","source":"@site/content/programming/design/architecture.md","sourceDirName":"programming/design","slug":"/programming/design/architecture","permalink":"/notes/programming/design/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/programming/design/architecture.md","tags":[{"inline":true,"label":"Programming","permalink":"/notes/tags/programming"},{"inline":true,"label":"DevOps","permalink":"/notes/tags/dev-ops"},{"inline":true,"label":"Design Pattern","permalink":"/notes/tags/design-pattern"},{"inline":true,"label":"Architecture","permalink":"/notes/tags/architecture"}],"version":"current","lastUpdatedBy":"sabertazimi","lastUpdatedAt":1770355426000,"frontMatter":{"tags":["Programming","DevOps","Design Pattern","Architecture"]},"sidebar":"tutorialSidebar","previous":{"title":"Design","permalink":"/notes/programming/design/"},"next":{"title":"Paradigms","permalink":"/notes/programming/design/paradigms"}}'),l=i(62615),t=i(30416);let s={tags:["Programming","DevOps","Design Pattern","Architecture"]},a="Architecture",c={},d=[{value:"Domain Driven Design",id:"domain-driven-design",level:2},{value:"Interface Layer",id:"interface-layer",level:3},{value:"Application Layer",id:"application-layer",level:3},{value:"Domain Layer",id:"domain-layer",level:3},{value:"Infrastructure Layer",id:"infrastructure-layer",level:3},{value:"Scalability",id:"scalability",level:2},{value:"High Concurrency",id:"high-concurrency",level:2},{value:"Code Layer",id:"code-layer",level:3},{value:"DataBase Layer",id:"database-layer",level:3},{value:"Architecture Layer",id:"architecture-layer",level:3},{value:"High Availability",id:"high-availability",level:2},{value:"Resource Isolation",id:"resource-isolation",level:3},{value:"Load Balance",id:"load-balance",level:3},{value:"Idempotence",id:"idempotence",level:3},{value:"CAP",id:"cap",level:3},{value:"\u670D\u52A1\u7194\u65AD",id:"\u670D\u52A1\u7194\u65AD",level:3},{value:"\u670D\u52A1\u9650\u6D41",id:"\u670D\u52A1\u9650\u6D41",level:3},{value:"\u7B97\u6CD5",id:"\u7B97\u6CD5",level:4},{value:"\u7B56\u7565",id:"\u7B56\u7565",level:4},{value:"\u4F4D\u7F6E",id:"\u4F4D\u7F6E",level:4},{value:"\u670D\u52A1\u964D\u7EA7",id:"\u670D\u52A1\u964D\u7EA7",level:3},{value:"References",id:"references",level:2}];function h(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",ul:"ul",...(0,t.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(n.header,{children:(0,l.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.img,{alt:"Clean Architecture",src:i(1264).A+"",title:"Clean Architecture",width:"1274",height:"919"})}),"\n",(0,l.jsx)(n.h2,{id:"domain-driven-design",children:"Domain Driven Design"}),"\n",(0,l.jsx)(n.h3,{id:"interface-layer",children:"Interface Layer"}),"\n",(0,l.jsx)(n.p,{children:"\u4E3B\u8981\u8D1F\u8D23\u4E0E\u5916\u90E8\u7CFB\u7EDF\u8FDB\u884C\u4EA4\u4E92\u4E0E\u901A\u4FE1:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u505A\u53C2\u6570\u7684\u57FA\u672C\u5904\u7406, \u6BD4\u5982\u5165\u53C2\u6821\u9A8C, \u56DE\u53C2 DTO \u8F6C\u6362 (\u62C6\u5305, \u7EC4\u5305)"}),"\n",(0,l.jsx)(n.li,{children:"Dubbo Services"}),"\n",(0,l.jsx)(n.li,{children:"RESTful API"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"application-layer",children:"Application Layer"}),"\n",(0,l.jsx)(n.p,{children:"Application Service \u5C42\u53EA\u662F\u5F88\u8584\u7684\u4E00\u5C42,\n\u5B83\u5185\u90E8\u5E76\u4E0D\u5B9E\u73B0\u4EFB\u4F55\u903B\u8F91,\n\u53EA\u662F\u8D1F\u8D23\u534F\u8C03\u548C\u8F6C\u53D1 (\u6D41\u7A0B\u7F16\u6392),\n\u59D4\u6D3E\u4E1A\u52A1\u52A8\u4F5C\u7ED9\u66F4\u4E0B\u5C42\u7684\u9886\u57DF\u5C42."}),"\n",(0,l.jsx)(n.h3,{id:"domain-layer",children:"Domain Layer"}),"\n",(0,l.jsx)(n.p,{children:"Domain \u5C42\u662F\u9886\u57DF\u6A21\u578B\u7CFB\u7EDF\u7684\u6838\u5FC3,\n\u8D1F\u8D23\u7EF4\u62A4\u9762\u5411\u5BF9\u8C61\u7684\u9886\u57DF\u6A21\u578B,\n\u51E0\u4E4E\u5168\u90E8\u7684\u4E1A\u52A1\u903B\u8F91\u90FD\u4F1A\u5728\u8FD9\u4E00\u5C42\u5B9E\u73B0.\n\u5185\u90E8\u4E3B\u8981\u5305\u542B Entity, ValueObject, Domain Event, Repository."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Controller"})," will receive the user\u2019s requests and reply with a structured response."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Service"})," will process the user\u2019s request,\nincluding validations and third-party reporting,\nand will receive data using the repository layer as a source of truth."]}),"\n",(0,l.jsxs)(n.li,{children:[(0,l.jsx)(n.code,{children:"Repository"})," will function as the application\u2019s source of truth,\nwill include the DB and external services queries."]}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"infrastructure-layer",children:"Infrastructure Layer"}),"\n",(0,l.jsx)(n.p,{children:"\u4E3B\u8981\u4E3A Interface, Application \u548C Domain \u4E09\u5C42\u63D0\u4F9B\u652F\u6491:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u5C01\u88C5\u57FA\u7840\u8D44\u6E90\u670D\u52A1, \u901A\u8FC7\u4F9D\u8D56\u6CE8\u5165\u65B9\u5F0F\u89E3\u8026."}),"\n",(0,l.jsx)(n.li,{children:"Third-party tools, Message Queue, File, Cache, Database, Search etc."}),"\n",(0,l.jsx)(n.li,{children:"\u5B9E\u73B0\u4ED3\u50A8\u63A5\u53E3 DB, \u901A\u5E38\u771F\u6B63\u8BFB\u5199 DB."}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"scalability",children:"Scalability"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Prefer composites over mixins."}),"\n",(0,l.jsx)(n.li,{children:"Always clone objects between components."}),"\n",(0,l.jsx)(n.li,{children:"Use namespaced state store modules."}),"\n",(0,l.jsx)(n.li,{children:"Write robust tests."}),"\n",(0,l.jsx)(n.li,{children:"Interact with REST API via services/SDK."}),"\n",(0,l.jsxs)(n.li,{children:["Wrap third-party libraries other using them directly:","\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Abstract: changing dependencies without changing interface."}),"\n",(0,l.jsx)(n.li,{children:"Extendability: More obvious route to extending functionality."}),"\n"]}),"\n"]}),"\n",(0,l.jsxs)(n.li,{children:["Stability:\n\u7EC4\u4EF6\u7ED3\u6784\u4F9D\u8D56\u56FE\u4E2D\u5404\u7EC4\u4EF6\u7684\u7A33\u5B9A\u6027\u6307\u6807 I \u5FC5\u987B\u8981\u6309\u5176\u4F9D\u8D56\u5173\u7CFB\u65B9\u5411\u9012\u51CF,\n\u8BA9\u6BCF\u4E2A\u7EC4\u4EF6\u7684 I \u6307\u6807\u90FD\u5FC5\u987B\u5927\u4E8E\u5176\u6240\u4F9D\u8D56\u7EC4\u4EF6\u7684 I \u6307\u6807,\n",(0,l.jsx)(n.code,{children:"I = FanOut / (FanOut + FanIn)"}),",\n",(0,l.jsx)(n.code,{children:"I = 0"})," \u8868\u793A\u4E0D\u4F9D\u8D56\u4EFB\u4F55\u6A21\u5757 (\u6700\u7A33\u5B9A),\n",(0,l.jsx)(n.code,{children:"I = 1"})," \u8868\u793A\u4E0D\u88AB\u4EFB\u4F55\u6A21\u5757\u4F9D\u8D56 (\u6700\u4E0D\u7A33\u5B9A)."]}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"high-concurrency",children:"High Concurrency"}),"\n",(0,l.jsx)(n.h3,{id:"code-layer",children:"Code Layer"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Mutex Performance"}),"\n",(0,l.jsx)(n.li,{children:"Database Caches"}),"\n",(0,l.jsx)(n.li,{children:"Update Merge"}),"\n",(0,l.jsx)(n.li,{children:"BloomFilter"}),"\n",(0,l.jsx)(n.li,{children:"Asynchronous"}),"\n",(0,l.jsx)(n.li,{children:"Multi-Thread"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"database-layer",children:"DataBase Layer"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Table structure design."}),"\n",(0,l.jsx)(n.li,{children:"Index design."}),"\n",(0,l.jsx)(n.li,{children:"Query optimization: \u907F\u514D\u590D\u6742\u7684\u591A\u8868\u8FDE\u63A5."}),"\n",(0,l.jsx)(n.li,{children:"Read and write separation: \u4E3B\u4ECE\u590D\u5236, Write-Ahead Logging (WAL)."}),"\n",(0,l.jsx)(n.li,{children:"Data sharding and data partition: split table."}),"\n",(0,l.jsx)(n.li,{children:"Hot data cache."}),"\n"]}),"\n",(0,l.jsx)(n.p,{children:(0,l.jsx)(n.a,{href:"https://openai.com/index/scaling-postgresql",children:(0,l.jsx)(n.img,{alt:"Cascading Replication",src:i(40548).A+"",width:"596",height:"345"})})}),"\n",(0,l.jsx)(n.h3,{id:"architecture-layer",children:"Architecture Layer"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Microservices"}),"\n",(0,l.jsx)(n.li,{children:"Scale Friendly"}),"\n",(0,l.jsx)(n.li,{children:"FailFast"}),"\n",(0,l.jsx)(n.li,{children:"Data PreFetch"}),"\n",(0,l.jsx)(n.li,{children:"Multi-Level Caches"}),"\n"]}),"\n",(0,l.jsx)(n.h2,{id:"high-availability",children:"High Availability"}),"\n",(0,l.jsx)(n.h3,{id:"resource-isolation",children:"Resource Isolation"}),"\n",(0,l.jsx)(n.h3,{id:"load-balance",children:"Load Balance"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Hardware Load Balance"}),"\n",(0,l.jsx)(n.li,{children:"Software Load Balance"}),"\n",(0,l.jsx)(n.li,{children:"Load Balance Algorithms:\nRandom, RoundRobin, WeightRoundRobin, ConsistentHash"}),"\n",(0,l.jsx)(n.li,{children:"Error Machines Auto Detection"}),"\n",(0,l.jsx)(n.li,{children:"Error Services Auto Retirement"}),"\n",(0,l.jsx)(n.li,{children:"Services Retry Automation"}),"\n",(0,l.jsx)(n.li,{children:"Recovery Services Auto Detection"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"idempotence",children:"Idempotence"}),"\n",(0,l.jsx)(n.p,{children:"\u5728\u7F16\u7A0B\u4E2D\u4E00\u4E2A\u5E42\u7B49\u64CD\u4F5C\u7684\u7279\u70B9\u662F\u5176\u4EFB\u610F\u591A\u6B21\u6267\u884C\u6240\u4EA7\u751F\u7684\u5F71\u54CD\u5747\u4E0E\u4E00\u6B21\u6267\u884C\u7684\u5F71\u54CD\u76F8\u540C."}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Mutex"}),"\n",(0,l.jsx)(n.li,{children:"Key Index"}),"\n",(0,l.jsx)(n.li,{children:"Token"}),"\n",(0,l.jsx)(n.li,{children:"Data Version"}),"\n",(0,l.jsx)(n.li,{children:"State Machine"}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"cap",children:"CAP"}),"\n",(0,l.jsx)(n.p,{children:"A distributed system to simultaneously provide\nmore than two out of the following three guarantees:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"Consistency:\nEvery read receives the most recent write or an error."}),"\n",(0,l.jsx)(n.li,{children:"Availability:\nEvery request receives a (non-error) response,\nwithout the guarantee that it contains the most recent write."}),"\n",(0,l.jsx)(n.li,{children:"Partition tolerance:\nThe system continues to operate\ndespite an arbitrary number of messages\nbeing dropped (or delayed) by the network between nodes."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u670D\u52A1\u7194\u65AD",children:"\u670D\u52A1\u7194\u65AD"}),"\n",(0,l.jsx)(n.p,{children:"\u5F53\u4E0B\u6E38\u670D\u52A1\u4E0D\u53EF\u7528\u6216\u54CD\u5E94\u8FC7\u6162\u65F6, \u4E0A\u6E38\u670D\u52A1\u505C\u6B62\u8C03\u7528\u8BE5\u670D\u52A1,\n\u76F4\u63A5\u5FEB\u901F\u5931\u8D25\u5E76\u8FD4\u56DE\u9ED8\u8BA4\u54CD\u5E94\u6216\u6267\u884C\u964D\u7EA7\u903B\u8F91, \u4ECE\u800C\u4FDD\u62A4\u7CFB\u7EDF\u6574\u4F53\u53EF\u7528\u6027."}),"\n",(0,l.jsx)(n.h3,{id:"\u670D\u52A1\u9650\u6D41",children:"\u670D\u52A1\u9650\u6D41"}),"\n",(0,l.jsx)(n.h4,{id:"\u7B97\u6CD5",children:"\u7B97\u6CD5"}),"\n",(0,l.jsx)(n.p,{children:"\u4E00\u5B9A\u7A0B\u5EA6\u4E0A\u53EF\u4EE5\u53C2\u8003\u8BA1\u7B97\u673A\u7F51\u7EDC\u62E5\u585E\u63A7\u5236\u7B97\u6CD5:"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u8BA1\u6570\u5668\u56FA\u5B9A\u7A97\u53E3\u9650\u6D41:\n\u5355\u4F4D\u65F6\u95F4\u5185\u8FBE\u5230\u9608\u503C\u540E\u5F00\u59CB\u9650\u6D41, \u5355\u4F4D\u65F6\u95F4\u540E\u91CD\u65B0\u8BA1\u6570.\n\u7A97\u53E3\u4E34\u754C\u5904\u6D41\u91CF\u8FC7\u5927, \u5BFC\u81F4\u670D\u52A1\u4E0D\u53EF\u7528."}),"\n",(0,l.jsx)(n.li,{children:"\u6ED1\u52A8\u7A97\u53E3\u9650\u6D41:\n\u5728\u56FA\u5B9A\u7A97\u53E3\u9650\u6D41\u57FA\u7840\u4E0A, \u5C06\u7A97\u53E3\u5411\u53F3\u6ED1\u52A8."}),"\n",(0,l.jsx)(n.li,{children:"\u6F0F\u6597\u9650\u6D41:\n\u672A\u6EE1\u524D\u53EF\u8FDB\u5165, \u6EE1\u5219\u62D2\u7EDD.\n\u53EF\u4EE5\u5E73\u6ED1\u6D41\u91CF, \u65E0\u6CD5\u89E3\u51B3\u7A81\u53D1\u6D41\u91CF."}),"\n",(0,l.jsx)(n.li,{children:"\u4EE4\u724C\u6876\u9650\u6D41:\n\u5728\u6F0F\u6597\u9650\u6D41\u57FA\u7840\u4E0A, \u4EE5\u6052\u5B9A\u901F\u7387\u4EA7\u751F\u4EE4\u724C.\n\u62E5\u6709\u4EE4\u724C\u53EF\u8FDB\u5165, \u65E0\u5219\u62D2\u7EDD.\n\u53EF\u4EE5\u5E73\u6ED1\u6D41\u91CF, \u53EF\u4EE5\u5BB9\u5FCD\u7A81\u53D1\u6D41\u91CF."}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u7B56\u7565",children:"\u7B56\u7565"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u670D\u52A1\u62D2\u7EDD"}),"\n",(0,l.jsx)(n.li,{children:"\u5EF6\u65F6\u5904\u7406"}),"\n",(0,l.jsx)(n.li,{children:"\u8BF7\u6C42\u5206\u7EA7"}),"\n",(0,l.jsx)(n.li,{children:"\u76D1\u63A7\u9884\u8B66"}),"\n",(0,l.jsx)(n.li,{children:"\u52A8\u6001\u9650\u6D41"}),"\n",(0,l.jsx)(n.li,{children:"\u52A8\u6001\u6269\u5BB9"}),"\n"]}),"\n",(0,l.jsx)(n.h4,{id:"\u4F4D\u7F6E",children:"\u4F4D\u7F6E"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsx)(n.li,{children:"\u63A5\u5165\u5C42\u9650\u6D41: \u901A\u8FC7 Nginx/API Router \u5BF9 DNS/IP \u9650\u6D41."}),"\n",(0,l.jsx)(n.li,{children:"\u5E94\u7528\u9650\u6D41: \u6BCF\u4E2A\u670D\u52A1\u62E5\u6709\u81EA\u5DF1\u7684\u96C6\u7FA4\u9650\u6D41\u670D\u52A1."}),"\n",(0,l.jsx)(n.li,{children:"\u57FA\u7840\u670D\u52A1\u9650\u6D41: \u5BF9\u6D88\u606F\u961F\u5217/\u6570\u636E\u5E93\u9650\u6D41."}),"\n"]}),"\n",(0,l.jsx)(n.h3,{id:"\u670D\u52A1\u964D\u7EA7",children:"\u670D\u52A1\u964D\u7EA7"}),"\n",(0,l.jsx)(n.p,{children:"\u670D\u52A1\u5668\u538B\u529B\u5267\u589E\u65F6, \u6839\u636E\u4E1A\u52A1\u4F18\u5148\u7EA7\u5BF9\u975E\u6838\u5FC3\u670D\u52A1\u6216\u9875\u9762\u91C7\u7528\u7B56\u7565\u6027\u5904\u7406,\n\u5982\u76F4\u63A5\u8FD4\u56DE\u515C\u5E95\u6570\u636E (fallback) \u6216\u62D2\u7EDD\u8BF7\u6C42, \u4ECE\u800C\u91CA\u653E\u8D44\u6E90\u4FDD\u8BC1\u6838\u5FC3\u529F\u80FD\u7A33\u5B9A."}),"\n",(0,l.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,l.jsxs)(n.ul,{children:["\n",(0,l.jsxs)(n.li,{children:["Frontend domain driven design ",(0,l.jsx)(n.a,{href:"https://dev.to/bespoyasov/clean-architecture-on-frontend-4311",children:"guide"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Scalable React project structure ",(0,l.jsx)(n.a,{href:"https://github.com/developerway/example-react-project",children:"guide"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Nest.js clean architecture ",(0,l.jsx)(n.a,{href:"https://medium.com/@jonathan.pretre91/clean-architecture-with-nestjs-e089cef65045",children:"template"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Domain driven design layout in ",(0,l.jsx)(n.a,{href:"https://github.com/lupguo/ddd-layout",children:"Golang"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Scaling PostgreSQL to ",(0,l.jsx)(n.a,{href:"https://openai.com/index/scaling-postgresql",children:"millions of QPS"}),"."]}),"\n",(0,l.jsxs)(n.li,{children:["Scaling a system ",(0,l.jsx)(n.a,{href:"https://blog.algomaster.io/p/scaling-a-system-from-0-to-10-million-users",children:"from 0 to 10 million users"}),"."]}),"\n"]})]})}function o(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,l.jsx)(n,{...e,children:(0,l.jsx)(h,{...e})}):h(e)}},40548(e,n,i){i.d(n,{A:()=>r});let r=i.p+"assets/images/cascading-replication-0c3dfcdc09e2d24c52255af4487a79b1.svg"},1264(e,n,i){i.d(n,{A:()=>r});let r=i.p+"assets/images/clean-architecture-0cc6a65651528cc435f6c10394463515.png"},30416(e,n,i){i.d(n,{R:()=>s,x:()=>a});var r=i(59471);let l={},t=r.createContext(l);function s(e){let n=r.useContext(t);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:s(e.components),r.createElement(t.Provider,{value:n},e.children)}}}]);