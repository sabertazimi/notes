"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["4248"],{61834(e,n,i){i.r(n),i.d(n,{metadata:()=>s,default:()=>h,frontMatter:()=>r,contentTitle:()=>d,toc:()=>l,assets:()=>c});var s=JSON.parse('{"id":"web/vue/lifecycle","title":"Lifecycle","description":"Lifecycle","source":"@site/content/web/vue/lifecycle.md","sourceDirName":"web/vue","slug":"/web/vue/lifecycle","permalink":"/notes/web/vue/lifecycle","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/vue/lifecycle.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Vue","permalink":"/notes/tags/vue"},{"inline":true,"label":"Internals","permalink":"/notes/tags/internals"},{"inline":true,"label":"Lifecycle","permalink":"/notes/tags/lifecycle"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":23,"frontMatter":{"tags":["Web","Vue","Internals","Lifecycle"],"sidebar_position":23},"sidebar":"tutorialSidebar","previous":{"title":"Options","permalink":"/notes/web/vue/options"},"next":{"title":"Virtual DOM","permalink":"/notes/web/vue/virtual-dom"}}'),t=i(62615),o=i(30416);let r={tags:["Web","Vue","Internals","Lifecycle"],sidebar_position:23},d="Lifecycle",c={},l=[{value:"Workflow",id:"workflow",level:2},{value:"Initialization",id:"initialization",level:2},{value:"Instance",id:"instance",level:2},{value:"Mounting",id:"mounting",level:2},{value:"Rendering",id:"rendering",level:2},{value:"Updating",id:"updating",level:2},{value:"Options",id:"options",level:2},{value:"Composition",id:"composition",level:2}];function a(e){let n={code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"lifecycle",children:"Lifecycle"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Lifecycle",src:i(77112).A+"",title:"Lifecycle",width:"1200",height:"3039"})}),"\n",(0,t.jsx)(n.h2,{id:"workflow",children:"Workflow"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"new Vue()"})," -> \u521D\u59CB\u5316 -> \u7F16\u8BD1 -> \u6E32\u67D3 -> \u6302\u8F7D -> \u66F4\u65B0:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"new Vue()"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Vue.prototype._init"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Vue.prototype.$mount"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"vm.$options.render = compileToFunctions(vm.$options.template)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"vue-loader"})," for static transform:\n",(0,t.jsx)(n.code,{children:".vue"})," -> ",(0,t.jsx)(n.code,{children:".js"})," in build time."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"compileToFunctions"})," for runtime transform:\nbundle ",(0,t.jsx)(n.code,{children:"compiler"})," and ",(0,t.jsx)(n.code,{children:"runtime"})," into ",(0,t.jsx)(n.code,{children:"vue.js"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"mountComponent(vm, el)"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Vue.prototype._render"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"VDOM.createElement(vm)"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Normalize children."}),"\n",(0,t.jsx)(n.li,{children:"Create VNode and install hooks."}),"\n",(0,t.jsx)(n.li,{children:"Create children recursively."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Vue.prototype._update"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"Vue.prototype.__patch__"})," (",(0,t.jsx)(n.code,{children:"platforms/web/runtime/patch.js"}),"):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"backend.nodeOps"})," (",(0,t.jsx)(n.code,{children:"platforms/web/runtime/node-ops"}),"):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"createElement"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"createElementNS"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"createTextNode"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"createComment"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"insertBefore"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"appendChild"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"removeChild"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"parentNode"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nextSibling"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tagName"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"setTextContent"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"setStyleScope"}),"."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"backend.hooksModules"})," (",(0,t.jsx)(n.code,{children:"core/vdom/modules"})," + ",(0,t.jsx)(n.code,{children:"platforms/web/runtime/modules"}),"):","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"create"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"activate"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"update"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"remove"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"destroy"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"initialization",children:"Initialization"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const app = new Vue({ el: '#app', ...restOptionsAPI })\nvm._init(...restOptionsAPI)\nif (vm.$options.el)\n  vm.$mount(vm.$options.el)\nvm.$options.render = compileToFunctions(vm.$options.template)\nmountComponent(vm, el)\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"core/instance/init.js"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"\u5408\u5E76\u914D\u7F6E."}),"\n",(0,t.jsx)(n.li,{children:"\u521D\u59CB\u5316\u751F\u547D\u5468\u671F."}),"\n",(0,t.jsx)(n.li,{children:"\u521D\u59CB\u5316\u4E8B\u4EF6\u4E2D\u5FC3."}),"\n",(0,t.jsx)(n.li,{children:"\u521D\u59CB\u5316\u6E32\u67D3."}),"\n",(0,t.jsx)(n.li,{children:"\u521D\u59CB\u5316 data/props/computed/watcher."}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// initMixin(Vue)\nVue.prototype._init = function (options?: object) {\n  const vm: Component = this\n\n  // uid\n  vm._uid = uid++\n\n  // a flag to avoid this being observed\n  vm._isVue = true\n\n  // merge options\n  if (options && options._isComponent) {\n    initInternalComponent(vm, options)\n  } else {\n    vm.$options = mergeOptions(\n      resolveConstructorOptions(vm.constructor),\n      options || {},\n      vm\n    )\n  }\n\n  vm._renderProxy = vm\n\n  // expose real self\n  vm._self = vm\n\n  initLifecycle(vm)\n  initEvents(vm)\n  initRender(vm)\n  callHook(vm, 'beforeCreate')\n  initInjections(vm) // resolve injections before data/props\n  initState(vm)\n  initProvide(vm) // resolve provide after data/props\n  callHook(vm, 'created')\n\n  if (vm.$options.el)\n    vm.$mount(vm.$options.el)\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"instance",children:"Instance"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Vue.prototype._init: core/instance/init.js\nvm._uid = uid++ // \u6BCF\u4E2AVue\u5B9E\u4F8B\u90FD\u62E5\u6709\u4E00\u4E2A\u552F\u4E00\u7684 id\nvm._isVue = true // \u8FD9\u4E2A\u8868\u793A\u7528\u4E8E\u907F\u514DVue\u5B9E\u4F8B\u5BF9\u8C61\u88AB\u89C2\u6D4B(observed)\nvm.$options = options // \u5F53\u524DVue\u5B9E\u4F8B\u7684\u521D\u59CB\u5316\u9009\u9879, \u6CE8\u610F: \u8FD9\u662F\u7ECF\u8FC7 mergeOptions() \u540E\u7684\nvm._renderProxy = vm // \u6E32\u67D3\u51FD\u6570\u4F5C\u7528\u57DF\u4EE3\u7406\nvm._self = vm // \u5B9E\u4F8B\u672C\u8EAB\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// initLifecycle(vm): core/instance/lifecycle.js\nvm.$parent = vmParent\nvm.$root = vmParent ? vmParent.$root : vm\n\nvm.$children = []\nvm.$refs = {}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// initEvents(vm): core/instance/events.js\nvm._events = Object.create(null)\nvm._hasHookEvent = false\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// initRender(vm): core/instance/render.js\nvm._vnode = null // root of child tree\nvm._staticTrees = null // v-once cached trees\n\nvm.$vnode = vnode\nvm.$slots = slots\nvm.$scopedSlots = scopedSlots\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// initState(vm): core/instance/state.js\nvm._watchers = []\nvm._data = data\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// mountComponent(): core/instance/lifecycle.js\nvm.$el = el\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// initComputed(): core/instance/state.js\nvm._computedWatchers = Object.create(null)\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// initProps(): core/instance/state.js\nvm._props = {}\n"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// initProvide(): core/instance/inject.js\nvm._provided = provided\n"})}),"\n",(0,t.jsx)(n.h2,{id:"mounting",children:"Mounting"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"core/instance/lifecycle.js"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"export function mountComponent(\n  vm: Component,\n  el: ?Element,\n  hydrating?: boolean\n): Component {\n  vm.$el = el\n\n  if (!vm.$options.render)\n    vm.$options.render = createEmptyVNode\n\n  callHook(vm, 'beforeMount')\n\n  const updateComponent = () => {\n    vm._update(vm._render(), hydrating)\n  }\n\n  new Watcher(\n    vm,\n    updateComponent,\n    noop,\n    {\n      before() {\n        if (vm._isMounted)\n          callHook(vm, 'beforeUpdate')\n      },\n    },\n    true /* isRenderWatcher */\n  )\n\n  hydrating = false\n\n  // manually mounted instance, call mounted on self\n  if (vm.$vnode == null) {\n    // Only `new Vue()` trigger this:\n    vm._isMounted = true\n    callHook(vm, 'mounted')\n  }\n\n  return vm\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"rendering",children:"Rendering"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"core/instance/render.js"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"Vue.prototype._render = function (): VNode {\n  const vm: Component = this\n  const { render, _parentVnode } = vm.$options\n\n  if (_parentVnode)\n    vm.$scopedSlots = _parentVnode.data.scopedSlots || emptyObject\n\n  // set parent vnode. this allows render functions to have access\n  // to data on placeholder node.\n  vm.$vnode = _parentVnode\n\n  // render self\n  const vnode = render.call(vm._renderProxy, vm.$createElement)\n\n  // return empty vnode in case the render function errored out\n  if (!(vnode instanceof VNode))\n    vnode = createEmptyVNode()\n\n  // set parent\n  vnode.parent = _parentVnode\n  return vnode\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"core/vdom/create-element.js"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Normalize children: transform children to ",(0,t.jsx)(n.code,{children:"Array<VNode>"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["Create VNode:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"new VNode(tag, data, children, vm)"})," for native host elements (e.g. ",(0,t.jsx)(n.code,{children:"<div>"}),")."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"createComponent(tag, data, children, vm)"})," for custom components:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"resolveConstructorOptions"}),": merge and resolve options API."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"installComponentHooks"}),":","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Install internal (",(0,t.jsx)(n.code,{children:"core/vdom/create-component.js/componentVNodeHooks"}),") hooks."]}),"\n",(0,t.jsx)(n.li,{children:"Merge user-defined VNode hooks."}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["new VNode(",(0,t.jsx)(n.code,{children:"vue-component-${Ctor.options.name}"}),", data, undefined, vm)."]}),"\n",(0,t.jsxs)(n.li,{children:["Component VNode children is ",(0,t.jsx)(n.code,{children:"undefined"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"vm._vnode.parent === vm.$vnode"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["\u7EC4\u4EF6 patch \u8FC7\u7A0B\u4E2D DOM \u7684\u63D2\u5165\u987A\u5E8F\u4E3A",(0,t.jsx)(n.strong,{children:"\u5148\u5B50\u540E\u7236"}),":\n",(0,t.jsx)(n.code,{children:"createComponent(vnode)"})," \u4E2D\u4F1A\u8C03\u7528\u5185\u90E8\u94A9\u5B50\u51FD\u6570 ",(0,t.jsx)(n.code,{children:"init(vnode)"}),",\n",(0,t.jsx)(n.code,{children:"init(vnode)"})," \u51FD\u6570\u4F1A\u521B\u5EFA\u5B50\u7EC4\u4EF6 ",(0,t.jsx)(n.code,{children:"VNode"}),", \u5E76\u8C03\u7528 ",(0,t.jsx)(n.code,{children:"child.$mount(vnode.elm)"}),",\n\u9012\u5F52\u5F0F\u5730\u521B\u5EFA\u5B50\u7EC4\u4EF6."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"export function createElement(\n  context: Component,\n  tag: any,\n  data: any,\n  children: any,\n  normalizationType: any,\n  alwaysNormalize: boolean\n): VNode | Array<VNode> {\n  if (Array.isArray(data) || isPrimitive(data)) {\n    normalizationType = children\n    children = data\n    data = undefined\n  }\n\n  if (isDef(data) && isDef(data.__ob__))\n    return createEmptyVNode()\n\n  // object syntax in v-bind\n  if (isDef(data) && isDef(data.is))\n    tag = data.is\n\n  if (!tag) {\n    // in case of component :is set to falsy value\n    return createEmptyVNode()\n  }\n\n  // support single function children as default scoped slot\n  if (Array.isArray(children) && typeof children[0] === 'function') {\n    data = data || {}\n    data.scopedSlots = { default: children[0] }\n    children.length = 0\n  }\n\n  if (normalizationType === ALWAYS_NORMALIZE)\n    children = normalizeChildren(children)\n  else if (normalizationType === SIMPLE_NORMALIZE)\n    children = simpleNormalizeChildren(children)\n\n  let vnode\n  let ns\n\n  if (typeof tag === 'string') {\n    let Ctor\n    ns = (context.$vnode && context.$vnode.ns) || config.getTagNamespace(tag)\n\n    if (config.isReservedTag(tag)) {\n      // platform built-in elements\n      vnode = new VNode(\n        config.parsePlatformTagName(tag),\n        data,\n        children,\n        undefined,\n        undefined,\n        context\n      )\n    } else if (!data || !data.pre) {\n      Ctor = resolveAsset(context.$options, 'components', tag)\n\n      if (isDef(Ctor)) {\n        // component\n        vnode = createComponent(Ctor, data, context, children, tag)\n      } else {\n        // unknown or unlisted namespaced elements\n        // check at runtime because it may get assigned a namespace when its\n        // parent normalizes children\n        vnode = new VNode(tag, data, children, undefined, undefined, context)\n      }\n    } else {\n      // unknown or unlisted namespaced elements\n      // check at runtime because it may get assigned a namespace when its\n      // parent normalizes children\n      vnode = new VNode(tag, data, children, undefined, undefined, context)\n    }\n  } else {\n    // direct component options / constructor\n    vnode = createComponent(tag, data, context, children)\n  }\n\n  if (Array.isArray(vnode)) {\n    return vnode\n  } else if (isDef(vnode)) {\n    if (isDef(ns))\n      applyNS(vnode, ns)\n    if (isDef(data))\n      registerDeepBindings(data)\n    return vnode\n  } else {\n    return createEmptyVNode()\n  }\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"updating",children:"Updating"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"core/instance/lifecycle.js"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"Vue.prototype._update = function (vnode: VNode, hydrating?: boolean) {\n  const vm: Component = this\n  const prevEl = vm.$el\n  const prevVnode = vm._vnode\n  const restoreActiveInstance = setActiveInstance(vm)\n  vm._vnode = vnode\n\n  // Vue.prototype.__patch__ is injected in entry points\n  // based on the rendering backend used.\n  if (!prevVnode) {\n    // initial render\n    vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */)\n  } else {\n    // updates\n    vm.$el = vm.__patch__(prevVnode, vnode)\n  }\n\n  restoreActiveInstance()\n\n  // update __vue__ reference\n  if (prevEl)\n    prevEl.__vue__ = null\n\n  if (vm.$el)\n    vm.$el.__vue__ = vm\n\n  // if parent is an HOC, update its $el as well\n  if (vm.$vnode && vm.$parent && vm.$vnode === vm.$parent._vnode)\n    vm.$parent.$el = vm.$el\n\n  // updated hook is called by scheduler\n  // to ensure that children are updated in a parent's updated hook.\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"options",children:"Options"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"beforeCreate"}),"/",(0,t.jsx)(n.code,{children:"created"})," in ",(0,t.jsx)(n.code,{children:"core/instance/init.js"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"beforeCreate"})," cannot access ",(0,t.jsx)(n.code,{children:"props"}),"/",(0,t.jsx)(n.code,{children:"data"}),"/",(0,t.jsx)(n.code,{children:"methods"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"created"})," can access ",(0,t.jsx)(n.code,{children:"props"}),"/",(0,t.jsx)(n.code,{children:"data"}),"/",(0,t.jsx)(n.code,{children:"methods"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"beforeCreate"}),"/",(0,t.jsx)(n.code,{children:"created"})," cannot access DOM."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"beforeMount"}),"/",(0,t.jsx)(n.code,{children:"mounted"})," in ",(0,t.jsx)(n.code,{children:"core/instance/lifecycle.js"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u5BF9\u4E8E\u540C\u6B65\u6E32\u67D3\u7684\u5B50\u7EC4\u4EF6, ",(0,t.jsx)(n.code,{children:"mounted"})," \u6267\u884C\u987A\u5E8F\u4E3A",(0,t.jsx)(n.strong,{children:"\u5148\u5B50\u540E\u7236"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"mounted"})," is called for render-created child components in its inserted hook."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.code,{children:"beforeDestroy"}),"/",(0,t.jsx)(n.code,{children:"destroyed"})," in ",(0,t.jsx)(n.code,{children:"core/instance/lifecycle.js"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\u8C03\u7528 ",(0,t.jsx)(n.code,{children:"beforeDestroy"})," \u94A9\u5B50\u51FD\u6570."]}),"\n",(0,t.jsxs)(n.li,{children:["\u4ECE ",(0,t.jsx)(n.code,{children:"parent"})," \u7684 ",(0,t.jsx)(n.code,{children:"$children"})," \u4E2D\u5220\u6389\u81EA\u8EAB."]}),"\n",(0,t.jsxs)(n.li,{children:["\u5220\u9664 ",(0,t.jsx)(n.code,{children:"watcher"}),"."]}),"\n",(0,t.jsx)(n.li,{children:"\u5F53\u524D\u6E32\u67D3\u7684 VNode \u6267\u884C\u9500\u6BC1\u94A9\u5B50\u51FD\u6570."}),"\n",(0,t.jsxs)(n.li,{children:["\u8C03\u7528 ",(0,t.jsx)(n.code,{children:"destroyed"})," \u94A9\u5B50\u51FD\u6570."]}),"\n",(0,t.jsxs)(n.li,{children:["\u5728 ",(0,t.jsx)(n.code,{children:"$destroy"})," \u7684\u6267\u884C\u8FC7\u7A0B\u4E2D,\n\u4F1A\u6267\u884C ",(0,t.jsx)(n.code,{children:"vm.__patch__(vm._vnode, null)"})," \u89E6\u53D1\u5B50\u7EC4\u4EF6\u7684\u9500\u6BC1\u94A9\u5B50\u51FD\u6570 (\u9012\u5F52),\n",(0,t.jsx)(n.code,{children:"destroyed"})," \u94A9\u5B50\u51FD\u6570\u6267\u884C\u987A\u5E8F\u4E3A",(0,t.jsx)(n.strong,{children:"\u5148\u5B50\u540E\u7236"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"composition",children:"Composition"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const currentInstance = null\n\nfunction mountComponent(vnode, container, anchor) {\n  const componentOptions = vnode.type\n  const { setup, data, props, attrs, slots } = componentOptions\n  const instance = {\n    state: reactive(data),\n    props: shallowReadonly(props),\n    isMounted: false,\n    subTree: null,\n    slots,\n    mounted: [],\n  }\n\n  const setupContext = { attrs, slots }\n  setCurrentInstance(instance)\n\n  const setupResult = setup(allowReadonly(instance.props), setupContext)\n  setCurrentInstance(null)\n\n  effect(\n    () => {\n      const subTree = render.call(renderContext, renderContext)\n\n      if (!instance.mounted)\n        instance.mounted?.forEach(hook => hook.call(renderContext))\n    },\n    {\n      scheduler: queueJob,\n    }\n  )\n}\n\nfunction onMounted(fn) {\n  if (currentInstance)\n    currentInstance.mounted.push(fn)\n  else console.error('`onMounted()` can only be called in `setup()`.')\n}\n"})})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(a,{...e})}):a(e)}},77112(e,n,i){i.d(n,{A:()=>s});let s=i.p+"assets/images/lifecycle-4a919f7471e246973e7380cf0871a739.png"},30416(e,n,i){i.d(n,{R:()=>r,x:()=>d});var s=i(59471);let t={},o=s.createContext(t);function r(e){let n=s.useContext(o);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);