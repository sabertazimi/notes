"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["72065"],{49287(e,n,r){r.r(n),r.d(n,{metadata:()=>t,default:()=>x,frontMatter:()=>c,contentTitle:()=>l,toc:()=>d,assets:()=>i});var t=JSON.parse('{"id":"web/javascript/proxy","title":"Proxy and Reflect","description":"Modify default object behavior with Proxy and Reflect:","source":"@site/content/web/javascript/proxy.md","sourceDirName":"web/javascript","slug":"/web/javascript/proxy","permalink":"/notes/web/javascript/proxy","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/javascript/proxy.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/notes/tags/ecma-script"},{"inline":true,"label":"Proxy","permalink":"/notes/tags/proxy"},{"inline":true,"label":"Reflect","permalink":"/notes/tags/reflect"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":24,"frontMatter":{"sidebar_position":24,"tags":["Web","JavaScript","ECMAScript","Proxy","Reflect"]},"sidebar":"tutorialSidebar","previous":{"title":"Module","permalink":"/notes/web/javascript/module"},"next":{"title":"Error and Exception","permalink":"/notes/web/javascript/error"}}'),o=r(62615),s=r(30416);let c={sidebar_position:24,tags:["Web","JavaScript","ECMAScript","Proxy","Reflect"]},l="Proxy and Reflect",i={},d=[{value:"Proxy",id:"proxy",level:2},{value:"Reflect",id:"reflect",level:2},{value:"Protection",id:"protection",level:2},{value:"Default Zero Value",id:"default-zero-value",level:3},{value:"Hiding Properties",id:"hiding-properties",level:3},{value:"Read Only Object",id:"read-only-object",level:3},{value:"Negative Array Indices",id:"negative-array-indices",level:3},{value:"Array Manipulation",id:"array-manipulation",level:3},{value:"Exception",id:"exception",level:3},{value:"Validation",id:"validation",level:2},{value:"Range",id:"range",level:3},{value:"Property",id:"property",level:3},{value:"Function Parameter",id:"function-parameter",level:3},{value:"Constructor Parameter",id:"constructor-parameter",level:3},{value:"Patterns",id:"patterns",level:2}];function a(e){let n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(n.header,{children:(0,o.jsx)(n.h1,{id:"proxy-and-reflect",children:"Proxy and Reflect"})}),"\n",(0,o.jsxs)(n.p,{children:["Modify default object behavior with ",(0,o.jsx)(n.code,{children:"Proxy"})," and ",(0,o.jsx)(n.code,{children:"Reflect"}),":"]}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"new Proxy(target, handler)"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Proxy.revocable(target, handler)"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const proxy = new Proxy(target, {\n  set(target, name, value, receiver) {\n    const success = Reflect.set(target, name, value, receiver)\n    if (success)\n      log(`property ${name} on ${target} set to ${value}`)\n\n    return success\n  },\n})\n"})}),"\n",(0,o.jsx)(n.h2,{id:"proxy",children:"Proxy"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Change original object will change proxy object."}),"\n",(0,o.jsxs)(n.li,{children:["change proxy object will change original object via ",(0,o.jsx)(n.code,{children:"set"})," related API."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Proxy.prototype"})," \u4E3A ",(0,o.jsx)(n.code,{children:"undefined"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"target !== proxy"}),"."]}),"\n"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const target = {\n  id: 'target',\n}\nconst handler = {}\nconst proxy = new Proxy(target, handler)\n\n// Proxy.prototype \u662F undefined\nconsole.log(target instanceof Proxy) // TypeError\nconsole.log(proxy instanceof Proxy) // TypeError\n// \u4E25\u683C\u76F8\u7B49\u53EF\u4EE5\u7528\u6765\u533A\u5206\u4EE3\u7406\u548C\u76EE\u6807\nconsole.log(target === proxy) // false\n"})}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"this"})," binding should process carefully:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const proxy = new Proxy(new Date(), {})\nproxy.getDate() // `getDate` rely on internal slots\n// TypeError: `this` is not a Date object.\n\nconst handler = {\n  get(target, propKey, receiver) {\n    if (propKey === 'getDate')\n      return target.getDate.bind(target)\n\n    return Reflect.get(target, propKey, receiver)\n  },\n}\nconst proxy = new Proxy(new Date('2020-12-24'), handler)\nproxy.getDate() // 24\n"})}),"\n",(0,o.jsx)(n.admonition,{title:"Proxy vs DefineProperty",type:"tip",children:(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Simple: ",(0,o.jsx)(n.code,{children:"Proxy"})," \u4F7F\u7528\u4E0A\u6BD4 ",(0,o.jsx)(n.code,{children:"Object.defineProperty"})," \u65B9\u4FBF.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Object.defineProperty"})," \u53EA\u80FD\u76D1\u542C\u5BF9\u8C61, \u5BFC\u81F4 ",(0,o.jsx)(n.code,{children:"Vue 2"})," ",(0,o.jsx)(n.code,{children:"data"})," \u5C5E\u6027\u5FC5\u987B\u901A\u8FC7\u4E00\u4E2A\u8FD4\u56DE\u5BF9\u8C61\u7684\u51FD\u6570\u65B9\u5F0F\u521D\u59CB\u5316,"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Vue 3"})," \u66F4\u52A0\u591A\u5143\u5316, \u53EF\u4EE5\u76D1\u542C\u4EFB\u610F\u6570\u636E."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Performant: ",(0,o.jsx)(n.code,{children:"Proxy"})," \u4EE3\u7406\u6574\u4E2A\u5BF9\u8C61, ",(0,o.jsx)(n.code,{children:"Object.defineProperty"})," \u53EA\u4EE3\u7406\u5BF9\u8C61\u4E0A\u7684\u67D0\u4E2A\u5C5E\u6027.","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Object.defineProperty"})," \u7531\u4E8E\u6BCF\u6B21\u53EA\u80FD\u76D1\u542C\u5BF9\u8C61\u4E00\u4E2A\u952E\u7684 ",(0,o.jsx)(n.code,{children:"get"}),"/",(0,o.jsx)(n.code,{children:"set"}),", \u5BFC\u81F4\u9700\u8981\u5FAA\u73AF\u76D1\u542C\u6D6A\u8D39\u6027\u80FD."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Proxy"})," \u53EF\u4EE5\u4E00\u6B21\u6027\u76D1\u542C\u5230\u6240\u6709\u5C5E\u6027."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Lazy: ",(0,o.jsx)(n.code,{children:"Proxy"})," \u6027\u80FD\u4F18\u4E8E ",(0,o.jsx)(n.code,{children:"Object.defineProperty"}),".","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\u5982\u679C\u5BF9\u8C61\u5185\u90E8\u8981\u5168\u90E8\u9012\u5F52\u4EE3\u7406, \u5219 ",(0,o.jsx)(n.code,{children:"Proxy"})," \u53EF\u4EE5\u53EA\u5728\u8C03\u7528\u65F6\u9012\u5F52."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Object.defineProperty"})," \u9700\u8981\u5728\u4E00\u5F00\u59CB\u5C31\u5168\u90E8\u9012\u5F52."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Feature:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["\u5BF9\u8C61\u4E0A\u5B9A\u4E49\u65B0\u5C5E\u6027\u65F6, \u53EA\u6709 ",(0,o.jsx)(n.code,{children:"Proxy"})," \u53EF\u4EE5\u76D1\u542C\u5230:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Vue2: \u63D0\u4F9B ",(0,o.jsx)(n.code,{children:"Vue.set"}),"/",(0,o.jsx)(n.code,{children:"Vue.delete"})," \u7B49\u8F85\u52A9\u65B9\u6CD5."]}),"\n",(0,o.jsxs)(n.li,{children:["Vue3: ",(0,o.jsx)(n.code,{children:"Proxy"})," \u76D1\u542C\u65B0\u5C5E\u6027."]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["\u6570\u7EC4\u65B0\u589E\u5220\u9664\u4FEE\u6539\u65F6, \u53EA\u6709 ",(0,o.jsx)(n.code,{children:"Proxy"})," \u53EF\u4EE5\u76D1\u542C\u5230:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Object.defineProperty"})," \u65E0\u6CD5\u76D1\u542C\u6570\u7EC4, ",(0,o.jsx)(n.code,{children:"Proxy"})," \u5219\u53EF\u4EE5\u76F4\u63A5\u76D1\u542C\u6570\u7EC4\u53D8\u5316."]}),"\n",(0,o.jsx)(n.li,{children:"Vue2: \u91CD\u5199\u6570\u7EC4\u65B9\u6CD5\u76D1\u542C\u6570\u7EC4\u53D8\u5316."}),"\n",(0,o.jsxs)(n.li,{children:["Vue3: ",(0,o.jsx)(n.code,{children:"Proxy"})," \u76D1\u542C\u6570\u7EC4\u53D8\u5316."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Proxy"})," \u4E0D\u517C\u5BB9 IE, ",(0,o.jsx)(n.code,{children:"Object.defineProperty"})," \u4E0D\u517C\u5BB9 IE8 \u53CA\u4EE5\u4E0B."]}),"\n"]})}),"\n",(0,o.jsx)(n.h2,{id:"reflect",children:"Reflect"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.get(target, propKey)"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.set(target, propKey, value)"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.has(target, propKey)"}),":\n",(0,o.jsx)(n.code,{children:"in"})," operator."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.defineProperty(target, propKey, attributes)"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.getOwnPropertyDescriptor(target, propKey)"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.deleteProperty(target, propKey)"}),":\n",(0,o.jsx)(n.code,{children:"delete"})," operator."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.ownKeys(target)"}),":\n",(0,o.jsx)(n.code,{children:"Object.keys()"})," + ",(0,o.jsx)(n.code,{children:"Object.getOwnPropertyNames()"})," + ",(0,o.jsx)(n.code,{children:"Object.getOwnPropertySymbols()"}),",\nall keys."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.getPrototypeOf(target)"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.setPrototypeOf(target, prototype)"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.isExtensible(target)"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.preventExtensions(target)"}),"."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.apply(target, thisArgument, argumentsList)"}),":\nfunction call."]}),"\n",(0,o.jsxs)(n.li,{children:[(0,o.jsx)(n.code,{children:"Reflect.construct(target, argumentsList)"}),":\n",(0,o.jsx)(n.code,{children:"new target(...argumentsList)"})," operator."]}),"\n"]}),"\n",(0,o.jsxs)(n.table,{children:[(0,o.jsx)(n.thead,{children:(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.th,{children:"Proxy Behavior"}),(0,o.jsx)(n.th,{children:"Overrides Behavior"})]})}),(0,o.jsxs)(n.tbody,{children:[(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.get()"})}),(0,o.jsx)(n.td,{children:"Reading a property value"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.set()"})}),(0,o.jsx)(n.td,{children:"Writing to a property"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.has()"})}),(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:"in"})," operator"]})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.deleteProperty()"})}),(0,o.jsxs)(n.td,{children:[(0,o.jsx)(n.code,{children:"delete"})," operator"]})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.getPrototypeOf()"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Object.getPrototypeOf()"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.setPrototypeOf()"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Object.setPrototypeOf()"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.isExtensible()"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Object.isExtensible()"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.preventExtensions()"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Object.preventExtensions()"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.getOwnPropertyDescriptor()"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Object.getOwnPropertyDescriptor()"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.defineProperty()"})}),(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Object.defineProperty()"})})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.ownKeys()"})}),(0,o.jsxs)(n.td,{children:["All ",(0,o.jsx)(n.code,{children:"Object"})," keys methods"]})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.apply()"})}),(0,o.jsx)(n.td,{children:"Calling a function"})]}),(0,o.jsxs)(n.tr,{children:[(0,o.jsx)(n.td,{children:(0,o.jsx)(n.code,{children:"Reflect.construct()"})}),(0,o.jsxs)(n.td,{children:["Calling a function with ",(0,o.jsx)(n.code,{children:"new"})]})]})]})]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const target = {\n  foo: 'bar',\n}\nconst proxy = new Proxy(target, Reflect)\nconsole.log(proxy.foo) // bar\nconsole.log(target.foo) // bar\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:'Reflect.ownKeys({ z: 3, y: 2, x: 1 }) // [ "z", "y", "x" ]\nReflect.ownKeys([]) // ["length"]\n\nconst sym = Symbol.for(\'comet\')\nconst sym2 = Symbol.for(\'meteor\')\nconst obj = {\n  [sym]: 0,\n  \'str\': 0,\n  \'773\': 0,\n  \'0\': 0,\n  [sym2]: 0,\n  \'-1\': 0,\n  \'8\': 0,\n  \'second str\': 0,\n}\n\nReflect.ownKeys(obj)\n// [ "0", "8", "773", "str", "-1", "second str", Symbol(comet), Symbol(meteor) ]\n// Indexes in numeric order,\n// strings in insertion order,\n// symbols in insertion order.\n'})}),"\n",(0,o.jsxs)(n.p,{children:["CommonJS (",(0,o.jsx)(n.code,{children:"CJS"}),") to ES Module (",(0,o.jsx)(n.code,{children:"ESM"}),") exports:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const esm$1 = { exports: {} }\n\n;(function (module, exports) {\n  module.exports = () => {}\n  exports.a = 3\n  exports.b = 4\n})(esm$1, esm$1.exports)\n\nconst esm = esm$1.exports\n\nexport { esm as default }\n"})}),"\n",(0,o.jsx)(n.h2,{id:"protection",children:"Protection"}),"\n",(0,o.jsx)(n.h3,{id:"default-zero-value",children:"Default Zero Value"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function withZeroValue(target, zeroValue = 0) {\n  return new Proxy(target, {\n    get: (obj, prop) => (prop in obj ? obj[prop] : zeroValue),\n  })\n}\n\nlet pos = { x: 4, y: 19 }\nconsole.log(pos.z) // => undefined\npos = withZeroValue(pos)\nconsole.log(pos.z) // => 0\n"})}),"\n",(0,o.jsx)(n.h3,{id:"hiding-properties",children:"Hiding Properties"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function hide(target, prefix = '_') {\n  return new Proxy(target, {\n    has: (obj, prop) => !prop.startsWith(prefix) && prop in obj,\n    ownKeys: obj =>\n      Reflect.ownKeys(obj).filter(\n        prop => typeof prop !== 'string' || !prop.startsWith(prefix)\n      ),\n    get: (obj, prop, rec) => (prop in rec ? obj[prop] : undefined),\n  })\n}\n\nconst userData = hide({\n  firstName: 'Tom',\n  mediumHandle: '@bar',\n  _favoriteRapper: 'Drake',\n})\n\nconst falsy = '_favoriteRapper' in userData // has: false\nconst keys = Object.keys(userData) // ownKeys: ['firstName', 'mediumHandle']\nconsole.log(userData._favoriteRapper) // get: undefined\n"})}),"\n",(0,o.jsx)(n.h3,{id:"read-only-object",children:"Read Only Object"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function NOPE() {\n  throw new Error('Can\\'t modify read-only object')\n}\n\nconst NOPE_HANDLER = {\n  set: NOPE,\n  defineProperty: NOPE,\n  deleteProperty: NOPE,\n  preventExtensions: NOPE,\n  setPrototypeOf: NOPE,\n  get: (obj, prop) => {\n    if (prop in obj)\n      return Reflect.get(obj, prop)\n\n    throw new ReferenceError(`Unknown prop \"${prop}\"`)\n  },\n}\n\nconst readOnly = target => new Proxy(target, NODE_HANDLER)\n"})}),"\n",(0,o.jsx)(n.h3,{id:"negative-array-indices",children:"Negative Array Indices"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function negativeArray(els) {\n  return new Proxy(target, {\n    get: (target, propKey, receiver) =>\n      Reflect.get(\n        target,\n        +propKey < 0 ? String(target.length + +propKey) : propKey,\n        receiver\n      ),\n  })\n}\n"})}),"\n",(0,o.jsx)(n.h3,{id:"array-manipulation",children:"Array Manipulation"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function toUint32(value) {\n  return Math.floor(Math.abs(Number(value))) % 2 ** 32\n}\n\nfunction isArrayIndex(key) {\n  const numericKey = toUint32(key)\n  return String(numericKey) === key && numericKey < 2 ** 32 - 1\n}\n\nclass MyArray {\n  constructor(length = 0) {\n    this.length = length\n\n    return new Proxy(this, {\n      set(trapTarget, key, value) {\n        const currentLength = Reflect.get(trapTarget, 'length')\n\n        // the special case\n        if (isArrayIndex(key)) {\n          const numericKey = Number(key)\n\n          if (numericKey >= currentLength)\n            Reflect.set(trapTarget, 'length', numericKey + 1)\n        } else if (key === 'length') {\n          if (value < currentLength) {\n            for (let index = currentLength - 1; index >= value; index--)\n              Reflect.deleteProperty(trapTarget, index)\n          }\n        }\n\n        // always do this regardless of key type\n        return Reflect.set(trapTarget, key, value)\n      },\n    })\n  }\n}\n\nconst colors = new MyArray(3)\nconsole.log(colors instanceof MyArray) // true\nconsole.log(colors.length) // 3\n\ncolors[0] = 'red'\ncolors[1] = 'green'\ncolors[2] = 'blue'\ncolors[3] = 'black'\nconsole.log(colors.length) // 4\n\ncolors.length = 2\nconsole.log(colors.length) // 2\nconsole.log(colors[3]) // undefined\nconsole.log(colors[2]) // undefined\nconsole.log(colors[1]) // \"green\"\nconsole.log(colors[0]) // \"red\"\n"})}),"\n",(0,o.jsx)(n.h3,{id:"exception",children:"Exception"}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function createExceptionProxy(target) {\n  return new Proxy(target, {\n    get: (target, prop) => {\n      if (!(prop in target))\n        return\n\n      if (typeof target[prop] === 'function')\n        return createExceptionZone(target, prop)\n\n      return target[prop]\n    },\n  })\n}\n\nfunction createExceptionZone(target, prop) {\n  return (...args) => {\n    let result\n    ExceptionsZone.run(() => {\n      result = target[prop](...args)\n    })\n    return result\n  }\n}\n\nclass ExceptionsZone {\n  static exceptionHandler = new ExceptionHandler()\n\n  static run(callback) {\n    try {\n      callback()\n    } catch (e) {\n      this.exceptionHandler.handle(e)\n    }\n  }\n}\n\nclass ExceptionHandler {\n  handle(exception) {\n    console.log('\u8BB0\u5F55\u9519\u8BEF: ', exception.message, exception.stack)\n  }\n}\n"})}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const obj = {\n  name: 'obj',\n  say() {\n    console.log(`Hi, I'm ${this.name}`)\n  },\n  coding() {\n    // xxx.\n    throw new Error('bug')\n  },\n  coding2() {\n    // xxx.\n    throw new Error('bug2')\n  },\n}\n\nconst proxy = createProxy(obj)\n\nproxy.say()\nproxy.coding()\n"})}),"\n",(0,o.jsx)(n.h2,{id:"validation",children:"Validation"}),"\n",(0,o.jsx)(n.h3,{id:"range",children:"Range"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"in"})," operator capture:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function range(min, max) {\n  return new Proxy(Object.create(null), {\n    has: (_, prop) => +prop >= min && +prop <= max,\n  })\n}\n\nconst X = 10.5\nconst nums = [1, 5, X, 50, 100]\n\nif (X in range(1, 100)) {\n  // => true\n}\n\nnums.filter(n => n in range(1, 10))\n// => [1, 5]\n"})}),"\n",(0,o.jsx)(n.h3,{id:"property",children:"Property"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"set"})," operator capture:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"const target = {\n  onlyNumbersGoHere: 0,\n}\n\nconst proxy = new Proxy(target, {\n  set(target, property, value) {\n    if (typeof value !== 'number')\n      return false\n    else\n      return Reflect.set(target, property, value)\n  },\n})\n\nproxy.onlyNumbersGoHere = 1\nconsole.log(proxy.onlyNumbersGoHere) // 1\nproxy.onlyNumbersGoHere = '2'\nconsole.log(proxy.onlyNumbersGoHere) // 1\n"})}),"\n",(0,o.jsx)(n.h3,{id:"function-parameter",children:"Function Parameter"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"apply"})," operator capture:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"function median(...nums) {\n  return nums.sort()[Math.floor(nums.length / 2)]\n}\n\nconst proxy = new Proxy(median, {\n  apply(target, thisArg, argumentsList) {\n    for (const arg of argumentsList) {\n      if (typeof arg !== 'number')\n        throw new TypeError('Non-number argument provided')\n    }\n\n    return Reflect.apply(target, thisArg, argumentsList)\n  },\n})\n\nconsole.log(proxy(4, 7, 1)) // 4\nconsole.log(proxy(4, '7', 1))\n// TypeError: Non-number argument provided\n\nclass Person {\n  constructor(name) {\n    this.name = name\n  }\n}\n\nconst PersonProxy = new Proxy(Person, {\n  apply(TrapTarget, thisArg, argumentList) {\n    return new TrapTarget(...argumentList)\n  },\n})\n\nconst me = PersonProxy('Nicholas')\nconsole.log(me.name) // \"Nicholas\"\nconsole.log(me instanceof Person) // true\nconsole.log(me instanceof PersonProxy) // true\n"})}),"\n",(0,o.jsx)(n.h3,{id:"constructor-parameter",children:"Constructor Parameter"}),"\n",(0,o.jsxs)(n.p,{children:[(0,o.jsx)(n.code,{children:"new"})," operator capture:"]}),"\n",(0,o.jsx)(n.pre,{children:(0,o.jsx)(n.code,{className:"language-ts",children:"class User {\n  constructor(id) {\n    this.id_ = id\n  }\n}\n\nconst ProxyUser = new Proxy(User, {\n  construct(target, argumentsList, newTarget) {\n    if (argumentsList[0] === undefined)\n      throw new Error('User cannot be instantiated without id')\n    else\n      return Reflect.construct(target, argumentsList, newTarget)\n  },\n})\n\nconst obj = new ProxyUser(1)\nconst throwError = new ProxyUser()\n// Error: User cannot be instantiated without id\n"})}),"\n",(0,o.jsx)(n.h2,{id:"patterns",children:"Patterns"}),"\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsxs)(n.li,{children:["Remote mock and placeholder:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Data mock."}),"\n",(0,o.jsx)(n.li,{children:"Image placeholder."}),"\n"]}),"\n"]}),"\n",(0,o.jsxs)(n.li,{children:["Cache:","\n",(0,o.jsxs)(n.ul,{children:["\n",(0,o.jsx)(n.li,{children:"Database objects access caching."}),"\n",(0,o.jsx)(n.li,{children:"Memoized functions."}),"\n"]}),"\n"]}),"\n",(0,o.jsx)(n.li,{children:"Profiling."}),"\n",(0,o.jsx)(n.li,{children:"Observer and watcher: Vue 3 reactivity, ImmerJS draft state."}),"\n"]})]})}function x(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,o.jsx)(n,{...e,children:(0,o.jsx)(a,{...e})}):a(e)}},30416(e,n,r){r.d(n,{R:()=>c,x:()=>l});var t=r(59471);let o={},s=t.createContext(o);function c(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:c(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);