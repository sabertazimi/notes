"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["29271"],{30080(e,n,r){r.r(n),r.d(n,{metadata:()=>c,default:()=>h,frontMatter:()=>l,contentTitle:()=>t,toc:()=>a,assets:()=>o});var c=JSON.parse('{"id":"web/react/architecture","title":"Architecture","description":"Virtual DOM","source":"@site/content/web/react/architecture.md","sourceDirName":"web/react","slug":"/web/react/architecture","permalink":"/notes/web/react/architecture","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/architecture.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Internals","permalink":"/notes/tags/internals"},{"inline":true,"label":"Architecture","permalink":"/notes/tags/architecture"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":30,"frontMatter":{"sidebar_position":30,"tags":["Web","React","Internals","Architecture"]},"sidebar":"tutorialSidebar","previous":{"title":"Create React App","permalink":"/notes/web/react/cra"},"next":{"title":"Scheduler","permalink":"/notes/web/react/scheduler"}}'),i=r(62615),s=r(30416);let l={sidebar_position:30,tags:["Web","React","Internals","Architecture"]},t="Architecture",o={},a=[{value:"Virtual DOM",id:"virtual-dom",level:2},{value:"Packages",id:"packages",level:2},{value:"Workflow",id:"workflow",level:2},{value:"Create RootContainer",id:"create-rootcontainer",level:3},{value:"Legacy Root",id:"legacy-root",level:4},{value:"Concurrent Root",id:"concurrent-root",level:4},{value:"Update RootContainer",id:"update-rootcontainer",level:3},{value:"SetState",id:"setstate",level:3},{value:"ClassComponent",id:"classcomponent",level:3},{value:"FunctionComponent",id:"functioncomponent",level:3}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"architecture",children:"Architecture"})}),"\n",(0,i.jsx)(n.h2,{id:"virtual-dom",children:"Virtual DOM"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Reduce rendering times with reconciliation algorithm,\nimproving rendering efficiency:\nDeclarative UI performance = Diff performance + DOM performance,\n",(0,i.jsx)(n.code,{children:"Virtual DOM"})," \u4E3B\u8981\u662F\u4E3A\u4E86\u6700\u5C0F\u5316 Diff \u6027\u80FD\u6D88\u8017."]}),"\n",(0,i.jsx)(n.li,{children:"Cross platform code."}),"\n",(0,i.jsx)(n.li,{children:"Functional programming without details on DOM manipulation."}),"\n",(0,i.jsx)(n.li,{children:"Virtual DOM \u5F88\u591A\u65F6\u5019\u90FD\u4E0D\u662F\u6700\u4F18\u7684\u64CD\u4F5C,\n\u4F46\u5B83\u5177\u6709\u666E\u9002\u6027, \u5728\u6548\u7387\u4E0E\u53EF\u7EF4\u62A4\u6027\u4E4B\u95F4\u8FBE\u5230\u5E73\u8861."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/snabbdom/snabbdom",children:"SnabbDOM"}),":\nvirtual DOM library focus on modularity and performance."]}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"packages",children:"Packages"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Scheduler"})," \u8C03\u5EA6\u5668: \u8C03\u5EA6\u4EFB\u52A1\u7684\u4F18\u5148\u7EA7, \u9AD8\u4F18\u4EFB\u52A1\u4F18\u5148\u8FDB\u5165 ",(0,i.jsx)(n.code,{children:"Reconciler"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Reconciler"})," \u534F\u8C03\u5668:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u88C5\u8F7D ",(0,i.jsx)(n.code,{children:"Renderer"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["\u63A5\u6536 ",(0,i.jsx)(n.code,{children:"ReactDOM"})," \u548C ",(0,i.jsx)(n.code,{children:"React"})," \u6A21\u5757 (\u7528\u6237\u4EE3\u7801) \u53D1\u8D77\u7684\u66F4\u65B0\u8BF7\u6C42:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactFiberReconciler.updateContainer"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactFiberClassComponent.setState"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactFiberHooks.dispatchAction"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.li,{children:"\u627E\u51FA\u53D8\u5316\u7EC4\u4EF6, \u6784\u5EFA Fiber Tree."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Renderer"})," \u6E32\u67D3\u5668:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u5F15\u5BFC ",(0,i.jsx)(n.code,{children:"React"})," \u5E94\u7528\u542F\u52A8 (e.g. ",(0,i.jsx)(n.code,{children:"ReactDOM.createRoot(rootNode).render(<App />)"}),")."]}),"\n",(0,i.jsxs)(n.li,{children:["\u5B9E\u73B0 ",(0,i.jsx)(n.code,{children:"HostConfig"})," \u534F\u8BAE, \u5C06\u53D8\u5316\u7684\u7EC4\u4EF6\u6E32\u67D3\u5230\u9875\u9762\u4E0A."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:["\u5176\u4E2D ",(0,i.jsx)(n.code,{children:"Reconciler"})," \u6784\u5EFA Fiber Tree \u7684\u8FC7\u7A0B\u88AB\u5305\u88C5\u6210\u4E00\u4E2A\u56DE\u8C03\u51FD\u6570, \u4F20\u5165 ",(0,i.jsx)(n.code,{children:"Scheduler"})," \u6A21\u5757\u7B49\u5F85\u8C03\u5EA6.\n",(0,i.jsx)(n.code,{children:"Scheduler"})," \u5C06\u56DE\u8C03\u51FD\u6570\u8FDB\u4E00\u6B65\u5305\u88C5\u6210\u4EFB\u52A1\u5BF9\u8C61, \u653E\u5165\u591A\u4F18\u5148\u7EA7\u8C03\u5EA6\u7684\u4EFB\u52A1\u961F\u5217, \u5FAA\u73AF\u6D88\u8D39\u4EFB\u52A1\u961F\u5217, \u76F4\u81F3\u961F\u5217\u6E05\u7A7A.\nScheduler work loop (\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF) \u8D1F\u8D23\u8C03\u5EA6 ",(0,i.jsx)(n.code,{children:"Task"}),",\nReconciler work loop (",(0,i.jsx)(n.code,{children:"Fiber"})," \u6784\u9020\u5FAA\u73AF) \u8D1F\u8D23\u5B9E\u73B0 ",(0,i.jsx)(n.code,{children:"Task"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"React"})," runtime main logic:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Updates: ",(0,i.jsx)(n.code,{children:"Add"}),"/",(0,i.jsx)(n.code,{children:"Delete"}),"/",(0,i.jsx)(n.code,{children:"Mutation"})," updates from ",(0,i.jsx)(n.code,{children:"User Code"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:["Registration:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Reconciler"})," receive updates request from ",(0,i.jsx)(n.code,{children:"User Code"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Scheduler"})," register new ",(0,i.jsx)(n.code,{children:"Task"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["Execution:","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Scheduler"})," consume ",(0,i.jsx)(n.code,{children:"Task"})," in ",(0,i.jsx)(n.code,{children:"TaskQueue"})," in work loop."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Reconciler"})," execute ",(0,i.jsx)(n.code,{children:"Task"})," work.","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"Fiber"})," \u6784\u9020\u5FAA\u73AF: construct ",(0,i.jsx)(n.code,{children:"Fiber"})," tree."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"commitRoot"}),": render ",(0,i.jsx)(n.code,{children:"Fiber"})," tree with ",(0,i.jsx)(n.code,{children:"Renderer"}),"."]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u4EFB\u52A1\u8C03\u5EA6\u5FAA\u73AF\u4E0E ",(0,i.jsx)(n.code,{children:"Fiber"})," \u6784\u9020\u5FAA\u73AF\u76F8\u4E92\u914D\u5408\u53EF\u5B9E\u73B0",(0,i.jsx)(n.strong,{children:"\u53EF\u4E2D\u65AD\u6E32\u67D3"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\u6E32\u67D3\u4E2D\u65AD (",(0,i.jsx)(n.code,{children:"Reconciler.renderRootConcurrent().shouldYield()"}),"):","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u5B58\u5728\u66F4\u9AD8\u4F18\u5148\u7EA7\u4EFB\u52A1 (Priority Scheduling)."}),"\n",(0,i.jsx)(n.li,{children:"\u5F53\u524D\u5E27\u6CA1\u6709\u5269\u4F59\u65F6\u95F4 (Time Slicing)."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\u6E32\u67D3\u6062\u590D (",(0,i.jsx)(n.code,{children:"Scheduler.workLoop()"}),"):\n\u5C06 ",(0,i.jsx)(n.code,{children:"callback()"})," \u8FD4\u56DE\u7684\u4EFB\u52A1\u653E\u5165\u4EFB\u52A1\u961F\u5217, \u7EE7\u7EED\u8FDB\u884C\u8C03\u5EA6\u76F4\u81F3\u6E05\u7A7A\u4EFB\u52A1\u961F\u5217."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://7kms.github.io/react-illustration-series/main/macro-structure",children:(0,i.jsx)(n.img,{alt:"React Core Packages",src:r(63106).A+"",width:"1918",height:"1382"})})}),"\n",(0,i.jsx)(n.h2,{id:"workflow",children:"Workflow"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.a,{href:"https://jser.dev/2023-07-14-initial-mount/#how-react-does-initial-mount-first-time-render-",children:(0,i.jsx)(n.img,{alt:"React Core Workflow",src:r(87082).A+"",width:"3560",height:"1160"})})}),"\n",(0,i.jsx)(n.h3,{id:"create-rootcontainer",children:"Create RootContainer"}),"\n",(0,i.jsx)(n.h4,{id:"legacy-root",children:"Legacy Root"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMLegacy.js",children:"react-dom/src/client/ReactDOMLegacy"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"render"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"legacyRenderSubtreeIntoContainer."}),"\n",(0,i.jsx)(n.li,{children:"legacyCreateRootFromDOMContainer."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberReconciler.js",children:"react-reconciler/src/ReactFiberReconciler"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createContainer"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponentTree.js",children:"react-dom/src/client/ReactDOMComponentTree"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"markContainerAsRoot."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberRoot.js",children:"react-reconciler/src/ReactFiberRoot"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createFiberRoot"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiber.js",children:"react-reconciler/src/ReactFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"createHostRootFiber."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactUpdateQueue.js",children:"react-reconciler/src/ReactUpdateQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"initializeUpdateQueue"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/events/DOMPluginEventSystem.js",children:"react-dom/src/events/DOMPluginEventSystem"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"listenToAllSupportedEvents:\n\u4E8B\u4EF6\u7EDF\u4E00\u5728 rootContainer \u4E0A\u5904\u7406 dispatchDiscreteEvent."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"concurrent-root",children:"Concurrent Root"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMRoot.js",children:"react-dom/src/client/ReactDOMRoot"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createRoot"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberReconciler.js",children:"react-reconciler/src/ReactFiberReconciler"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createContainer"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponentTree.js",children:"react-dom/src/client/ReactDOMComponentTree"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"markContainerAsRoot."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberRoot.js",children:"react-reconciler/src/ReactFiberRoot"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"createFiberRoot"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiber.js",children:"react-reconciler/src/ReactFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"createHostRootFiber."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactUpdateQueue.js",children:"react-reconciler/src/ReactUpdateQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"initializeUpdateQueue"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/events/DOMPluginEventSystem.js",children:"react-dom/src/events/DOMPluginEventSystem"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"listenToAllSupportedEvents:\n\u4E8B\u4EF6\u7EDF\u4E00\u5728 rootContainer \u4E0A\u5904\u7406 dispatchDiscreteEvent."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactDOMRoot.render(<App />)"}),"."]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"update-rootcontainer",children:"Update RootContainer"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMLegacy.js",children:"react-dom/src/client/ReactDOMLegacy"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"render."}),"\n",(0,i.jsx)(n.li,{children:"legacyRenderSubtreeIntoContainer."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMRoot.js",children:"react-dom/src/client/ReactDOMRoot"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"render."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberReconciler.js",children:"react-reconciler/src/ReactFiberReconciler"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateContainer"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactUpdateQueue.js",children:"react-reconciler/src/ReactUpdateQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"createUpdate."}),"\n",(0,i.jsx)(n.li,{children:"enqueueUpdate."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"scheduleUpdateOnFiber"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"ensureRootIsScheduled"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberSyncTaskQueue.js",children:"react-reconciler/src/ReactFiberSyncTaskQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"flushSyncCallbacks."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"performSyncWorkOnRoot"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"renderRootSync."}),"\n",(0,i.jsx)(n.li,{children:"workLoopSync."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"performUnitOfWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"beginWork"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateHostRoot"}),"/",(0,i.jsx)(n.strong,{children:"updateXXXComponent"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.code,{children:"ReactDOMComponent.createElement"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"reconcileChildren."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactChildFiber.js",children:"react-reconciler/src/ReactChildFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"reconcileChildFibers."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"completeUnitOfWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberCompleteWork.js",children:"react-reconciler/src/ReactFiberCompleteWork"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"completeWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"commitRoot"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMHostConfig.js",children:"react-dom/src/client/ReactDOMHostConfig"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"appendChildToContainer."}),"\n",(0,i.jsx)(n.li,{children:"finalizeInitialChildren."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponent.js",children:"react-dom/src/client/ReactDOMComponent"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"setInitialProperties:\n\u8BBE\u7F6E\u521D\u59CB\u5316\u5C5E\u6027, \u5904\u7406\u7279\u6B8A\u5143\u7D20\u548C\u4E8B\u4EF6."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Legacy Mode\nimport type { ReactElement } from 'react'\nimport type { Container } from './types'\nimport Reconciler from './reconciler'\n\nconst Renderer = {\n  render: (\n    element: ReactElement,\n    container: Container | null,\n    callback?: Function\n  ): void => {\n    if (container) {\n      const root = Reconciler.createContainer(container, 0, false, null)\n      Reconciler.updateContainer(element, root, null)\n    }\n  },\n}\n\nexport default Renderer\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ts",children:"// Modern Mode\nimport type { ReactElement } from 'react'\nimport type { Container, OpaqueRoot } from './types'\nimport Reconciler from './reconciler'\n\nconst Renderer = {\n  createRoot: (\n    container: Container | null,\n    callback?: Function\n  ): OpaqueRoot => {\n    if (container) {\n      const root = Reconciler.createContainer(container, 0, false, null)\n\n      root.render = function (element: ReactElement) {\n        Reconciler.updateContainer(element, this, null)\n      }\n\n      return root\n    }\n  },\n}\n\nexport default Renderer\n"})}),"\n",(0,i.jsx)(n.h3,{id:"setstate",children:"SetState"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/events/ReactDOMEventListener.js",children:"react-dom/src/events/ReactDOMEventListener"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"dispatchDiscreteEvent."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react/src/ReactBaseClasses.js",children:"react/src/ReactBaseClasses"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"setState"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberClassComponent.js",children:"react-reconciler/src/ReactFiberClassComponent"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"enqueueSetState."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactUpdateQueue.js",children:"react-reconciler/src/ReactUpdateQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"createUpdate."}),"\n",(0,i.jsx)(n.li,{children:"enqueueUpdate."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"scheduleUpdateOnFiber"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"discreteUpdates."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberSyncTaskQueue.js",children:"react-reconciler/src/ReactFiberSyncTaskQueue"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"flushSyncCallbacks."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"performSyncWorkOnRoot"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"workLoopSync."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"performUnitOfWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"beginWork"}),"."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateXXXComponent"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"reconcileChildren."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactChildFiber.js",children:"react-reconciler/src/ReactChildFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"reconcileChildFibers."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"completeUnitOfWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberCompleteWork.js",children:"react-reconciler/src/ReactFiberCompleteWork"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"completeWork"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"commitRoot"}),"."]}),"\n",(0,i.jsx)(n.li,{children:"commitMutationEffects."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberCommitWork.js",children:"react-reconciler/src/ReactFiberCommitWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"commitWork."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMHostConfig.js",children:"react-dom/src/client/ReactDOMHostConfig"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"commitUpdate."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponentTree.js",children:"react-dom/src/client/ReactDOMComponentTree"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"updateFiberProps."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-dom/src/client/ReactDOMComponent.js",children:"react-dom/src/client/ReactDOMComponent"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"updateProperties:\nApply diff."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"classcomponent",children:"ClassComponent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"performSyncWorkOnRoot."}),"\n",(0,i.jsx)(n.li,{children:"workLoopSync."}),"\n",(0,i.jsx)(n.li,{children:"performUnitOfWork."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"beginWork"}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateClassComponent"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberClassComponent.js",children:"react-reconciler/src/ReactFiberClassComponent"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"updateClassInstance."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"finishClassComponent."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"instance.render"})," (User defined Component)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"reconcileChildren"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactChildFiber.js",children:"react-reconciler/src/ReactChildFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"reconcileChildFibers."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"functioncomponent",children:"FunctionComponent"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberWorkLoop.js",children:"react-reconciler/src/ReactFiberWorkLoop"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"performSyncWorkOnRoot."}),"\n",(0,i.jsx)(n.li,{children:"workLoopSync."}),"\n",(0,i.jsx)(n.li,{children:"performUnitOfWork."}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"beginWork."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"updateFunctionComponent"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberHooks.js",children:"react-reconciler/src/ReactFiberHooks"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"renderWithHooks."}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"FunctionComponent()"})," (User defined Function)."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Hooks"}),": useXXX -> mountXXX -> updateXXX."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberBeginWork.js",children:"react-reconciler/src/ReactFiberBeginWork"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"reconcileChildren"}),"."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.a,{href:"https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactChildFiber.js",children:"react-reconciler/src/ReactChildFiber"}),":","\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"reconcileChildFibers."}),"\n"]}),"\n"]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},63106(e,n,r){r.d(n,{A:()=>c});let c=r.p+"assets/images/react-core-packages-08e2adc3bb013c66966f9a71e93715c0.png"},87082(e,n,r){r.d(n,{A:()=>c});let c=r.p+"assets/images/react-core-workflow-ac78f336309ddd0c58c381bed5103e70.png"},30416(e,n,r){r.d(n,{R:()=>l,x:()=>t});var c=r(59471);let i={},s=c.createContext(i);function l(e){let n=c.useContext(s);return c.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:l(e.components),c.createElement(s.Provider,{value:n},e.children)}}}]);