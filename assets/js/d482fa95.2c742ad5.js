"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["14521"],{2559(e,n,r){r.r(n),r.d(n,{metadata:()=>i,default:()=>h,frontMatter:()=>c,contentTitle:()=>l,toc:()=>o,assets:()=>d});var i=JSON.parse('{"id":"web/security/web","title":"Web","description":"Security Headers","source":"@site/content/web/security/web.md","sourceDirName":"web/security","slug":"/web/security/web","permalink":"/notes/web/security/web","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/security/web.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"DevOps","permalink":"/notes/tags/dev-ops"},{"inline":true,"label":"Security","permalink":"/notes/tags/security"},{"inline":true,"label":"HTTP","permalink":"/notes/tags/http"},{"inline":true,"label":"Headers","permalink":"/notes/tags/headers"},{"inline":true,"label":"Policy","permalink":"/notes/tags/policy"},{"inline":true,"label":"CSP","permalink":"/notes/tags/csp"},{"inline":true,"label":"Crypto","permalink":"/notes/tags/crypto"},{"inline":true,"label":"Privacy","permalink":"/notes/tags/privacy"},{"inline":true,"label":"Fingerprint","permalink":"/notes/tags/fingerprint"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"tags":["Web","DevOps","Security","HTTP","Headers","Policy","CSP","Crypto","Privacy","Fingerprint"]},"sidebar":"tutorialSidebar","previous":{"title":"Security","permalink":"/notes/web/security/"},"next":{"title":"Sandbox","permalink":"/notes/web/security/sandbox"}}'),s=r(62615),t=r(30416);let c={sidebar_position:1,tags:["Web","DevOps","Security","HTTP","Headers","Policy","CSP","Crypto","Privacy","Fingerprint"]},l="Web",d={},o=[{value:"Security Headers",id:"security-headers",level:2},{value:"Same Origin Policy",id:"same-origin-policy",level:2},{value:"Content Security Policy",id:"content-security-policy",level:2},{value:"Trusted Types",id:"trusted-types",level:2},{value:"Crypto",id:"crypto",level:2},{value:"User Privacy",id:"user-privacy",level:2},{value:"Browser Privacy",id:"browser-privacy",level:3},{value:"User Fingerprint",id:"user-fingerprint",level:3}];function a(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"web",children:"Web"})}),"\n",(0,s.jsx)(n.h2,{id:"security-headers",children:"Security Headers"}),"\n",(0,s.jsxs)(n.p,{children:["Security headers ",(0,s.jsx)(n.a,{href:"https://web.dev/security-headers",children:"list"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Content-Type-Options",children:"X-Content-Type-Options"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/HTTP/Headers/X-Frame-Options",children:"X-Frame-Options"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"DENY"}),": \u7981\u6B62\u88AB\u52A0\u8F7D\u8FDB\u4EFB\u4F55 frame."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"SAMEORIGIN"}),": \u4EC5\u5141\u8BB8\u88AB\u52A0\u8F7D\u8FDB\u540C\u57DF\u5185\u7684 frame."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/HTTP/Headers/X-XSS-Protection",children:"X-XSS-Protection"}),":","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"0"})," :\u8868\u793A\u7981\u7528\u8FD9\u4E2A\u7B56\u7565."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"1"}),": \u9ED8\u8BA4, \u5BF9\u5371\u9669\u811A\u672C\u505A\u4E00\u4E9B\u6807\u5FD7\u6216\u4FEE\u6539, \u4EE5\u963B\u6B62\u5728\u6D4F\u89C8\u5668\u4E0A\u6E32\u67D3\u6267\u884C."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"1; mode=block"}),": \u5F3A\u5236\u4E0D\u6E32\u67D3."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Setting ",(0,s.jsx)(n.code,{children:"Content-Security-Policy"})," header."]}),"\n",(0,s.jsx)(n.li,{children:"Ensure all connections to be HTTPS."}),"\n",(0,s.jsxs)(n.li,{children:["Avoid Clicking-jacking using ",(0,s.jsx)(n.code,{children:"X-Frame-Options"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Disable ",(0,s.jsx)(n.code,{children:"X-Powered-By"})," header."]}),"\n",(0,s.jsxs)(n.li,{children:["Not put sensitive data in URL query and ",(0,s.jsx)(n.code,{children:"Referer"})," header."]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"same-origin-policy",children:"Same Origin Policy"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"origin"})," = ",(0,s.jsx)(n.code,{children:"protocol"})," + ",(0,s.jsx)(n.code,{children:"domain"})," + ",(0,s.jsx)(n.code,{children:"port"}),":"]}),"\n",(0,s.jsxs)(n.table,{children:[(0,s.jsx)(n.thead,{children:(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.th,{children:(0,s.jsx)(n.code,{children:"http://www.foo.com"})}),(0,s.jsx)(n.th,{children:"Same Origin"}),(0,s.jsx)(n.th,{})]})}),(0,s.jsxs)(n.tbody,{children:[(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"https://www.foo.com"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"protocol"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"http://app.foo.com"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"domain"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"http://foo.com"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"domain"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"http://www.foo.com:8080"})}),(0,s.jsx)(n.td,{children:"No"}),(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"port"})})]}),(0,s.jsxs)(n.tr,{children:[(0,s.jsx)(n.td,{children:(0,s.jsx)(n.code,{children:"http://www.foo.com/a/"})}),(0,s.jsx)(n.td,{children:"Yes"}),(0,s.jsx)(n.td,{})]})]})]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-json",children:'{\n  "Access-Control-Allow-Origin": "https://api.foo.com"\n}\n'})}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u7531\u5BA2\u6237\u7AEF HTML \u6807\u7B7E\u7B49\u53D1\u51FA\u7684\u8DE8\u57DF ",(0,s.jsx)(n.code,{children:"GET"})," \u8BF7\u6C42\u9ED8\u8BA4\u5408\u6CD5, \u6784\u6210\u5F00\u653E\u7684 Web \u4E16\u754C:\n\u901A\u8FC7 ",(0,s.jsx)(n.code,{children:"src"})," \u5C5E\u6027\u52A0\u8F7D\u7684\u8D44\u6E90, \u6D4F\u89C8\u5668\u9650\u5236\u4E86 JavaScript \u7684\u6743\u9650, \u4F7F\u5176\u4E0D\u80FD\u8BFB\u5199\u8FD4\u56DE\u7684\u5185\u5BB9."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"XMLHttpRequest"})," \u53D7\u540C\u6E90\u7B56\u7565\u9650\u5236: \u9ED8\u8BA4\u53EA\u80FD\u8BBF\u95EE\u540C\u6E90\u5BF9\u8C61\u7684\u5185\u5BB9."]}),"\n",(0,s.jsx)(n.li,{children:"Cookie \u53D7\u540C\u6E90\u7B56\u7565\u9650\u5236."}),"\n",(0,s.jsxs)(n.li,{children:["Web storage \u53D7\u540C\u6E90\u7B56\u7565\u9650\u5236:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Local storage."}),"\n",(0,s.jsx)(n.li,{children:"Session storage."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"content-security-policy",children:"Content Security Policy"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/foundeo/content-security-policy.com",children:(0,s.jsx)(n.code,{children:"CSP"})}),"\nhelp prevent from ",(0,s.jsx)(n.code,{children:"XSS"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-bash",children:"{\n  \"header\": {\n    \"Content-Security-Policy\":\n      allow 'self';\n      script-src 'nonce-random123' 'strict-dynamic' 'unsafe-eval' script.example.com;\n      media-src media.example.com;\n      img-src img.example.com;\n      object-src 'none';\n      base-uri 'none'\n  }\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["Basic CSP ",(0,s.jsx)(n.a,{href:"https://www.writesoftwarewell.com/content-security-policy",children:"usage"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"<meta\n  http-equiv=\"Content-Security-Policy\"\n  content=\"script-src 'self' https://safe-external-site.com; style-src 'self'\"\n/>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"upgrade-insecure-requests"}),"\n\u6307\u793A\u6D4F\u89C8\u5668\u5728\u53D1\u51FA\u7F51\u7EDC\u8BF7\u6C42\u4E4B\u524D\u5347\u7EA7\u4E0D\u5B89\u5168\u7684 ",(0,s.jsx)(n.code,{children:"URL"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests" />\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"block-all-mixed-content"}),"\n\u6307\u793A\u6D4F\u89C8\u5668\u6C38\u4E0D\u52A0\u8F7D\u6DF7\u5408\u5185\u5BB9,\n\u6240\u6709\u6DF7\u5408\u5185\u5BB9\u8D44\u6E90\u8BF7\u6C42\u90FD\u4F1A\u88AB\u963B\u6B62,\n\u5305\u62EC\u4E3B\u52A8\u548C\u88AB\u52A8\u6DF7\u5408\u5185\u5BB9:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<meta http-equiv="Content-Security-Policy" content="block-all-mixed-content" />\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"nonce"}),"-only ",(0,s.jsx)(n.code,{children:"CSP"})," block 3rd scripts and dynamic scripts generate by trusted users:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'<script nonce="random123">\n  alert(\'this is fine!\')\n<\/script>\n<script nonce="random123" src="https://cdnjs.com/lib.js"><\/script>\n\x3c!-- XSS injected by attacker - blocked by CSP --\x3e\n<script>\n  alert(\'xss\')\n<\/script>\n'})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"strict-dynamic"})," ",(0,s.jsx)(n.code,{children:"CSP"})," allow dynamic scripts generate by trusted users:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:"\x3c!-- Content-Security-Policy: script-src 'nonce-random123' 'strict-dynamic' --\x3e\n<script nonce=\"random123\">\n  const s = document.createElement('script')\n  s.src = '/path/to/script.js'\n  s.async = true\n  document.head.appendChild(s) // can execute correctly\n<\/script>\n"})}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.code,{children:"domain"}),"-specific ",(0,s.jsx)(n.code,{children:"CSP"})," block untrusted domain scripts:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-html",children:'\x3c!-- Given this CSP header --\x3e\n\x3c!-- Content-Security-Policy: script-src https://example.com/ --\x3e\n\x3c!-- The following third-party script will not be loaded or executed --\x3e\n<script src="https://not-example.com/js/library.js"><\/script>\n'})}),"\n",(0,s.jsx)(n.h2,{id:"trusted-types",children:"Trusted Types"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"TrustedURL."}),"\n",(0,s.jsx)(n.li,{children:"TrustedHTML."}),"\n",(0,s.jsx)(n.li,{children:"TrustedScript."}),"\n",(0,s.jsx)(n.li,{children:"TrustedScriptURL."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// fallback policy\nTrustedTypes.createPolicy(\n  'default',\n  {\n    createHTML(s) {\n      console.error('Please fix! Insecure string assignment detected:', s)\n      return s\n    },\n  },\n  true\n)\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Content-Security-Policy-Report-Only: trusted-types myPolicy; report-uri /cspReport\nconst SanitizingPolicy = TrustedTypes.createPolicy(\n  'myPolicy',\n  {\n    createHTML: (s: string) => myCustomSanitizer(s),\n  },\n  false\n)\n\nconst trustedHTML = SanitizingPolicy.createHTML(foo)\nelement.innerHTML = trustedHTML\n"})}),"\n",(0,s.jsx)(n.h2,{id:"crypto",children:"Crypto"}),"\n",(0,s.jsxs)(n.p,{children:["Web crypto ",(0,s.jsx)(n.a,{href:"https://developer.mozilla.org/docs/Web/API/SubtleCrypto",children:"API"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"\u516C\u94A5\u52A0\u5BC6\u79C1\u94A5\u89E3\u5BC6: \u53EA\u6709\u79C1\u94A5\u62E5\u6709\u8005\u53EF\u4EE5\u83B7\u53D6\u4FE1\u606F, e.g. HTTPS \u4F1A\u8BDD\u5BC6\u94A5\u4F20\u8F93."}),"\n",(0,s.jsx)(n.li,{children:"\u516C\u94A5\u89E3\u5BC6\u79C1\u94A5\u52A0\u5BC6: \u53EA\u6709\u79C1\u94A5\u62E5\u6709\u8005\u53EF\u4EE5\u53D1\u5E03\u7B7E\u540D, e.g. \u6570\u5B57\u7B7E\u540D."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"user-privacy",children:"User Privacy"}),"\n",(0,s.jsx)(n.h3,{id:"browser-privacy",children:"Browser Privacy"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Browser ",(0,s.jsx)(n.a,{href:"https://browserleaks.com",children:"leaks"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"https://github.com/neberej/exposedbydefault",children:"Exposed"})," by default."]}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"user-fingerprint",children:"User Fingerprint"}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.a,{href:"https://github.com/neberej/exposedbydefault",children:"User fingerprint"})," can generate by:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["Use Canvas or WebGL to generate user\n",(0,s.jsx)(n.a,{href:"https://yinzhicao.org/TrackingFree/crossbrowsertracking_NDSS17.pdf",children:"fingerprint"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["Location information:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Country."}),"\n",(0,s.jsx)(n.li,{children:"Region."}),"\n",(0,s.jsx)(n.li,{children:"City."}),"\n",(0,s.jsx)(n.li,{children:"Zip code."}),"\n",(0,s.jsx)(n.li,{children:"Latitude."}),"\n",(0,s.jsx)(n.li,{children:"Longitude."}),"\n",(0,s.jsx)(n.li,{children:"Timezone."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Connection information:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"IP address."}),"\n",(0,s.jsx)(n.li,{children:"Internet service provider."}),"\n",(0,s.jsx)(n.li,{children:"Organization."}),"\n",(0,s.jsx)(n.li,{children:"ASN."}),"\n",(0,s.jsx)(n.li,{children:"Tor browser detection."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Software information:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Browser."}),"\n",(0,s.jsx)(n.li,{children:"Browser plugins detection."}),"\n",(0,s.jsx)(n.li,{children:"Operation system."}),"\n",(0,s.jsx)(n.li,{children:"User agent."}),"\n",(0,s.jsx)(n.li,{children:"Preferred language."}),"\n",(0,s.jsx)(n.li,{children:"Cookie enabled detection."}),"\n",(0,s.jsx)(n.li,{children:"Java enabled detection."}),"\n",(0,s.jsx)(n.li,{children:"DNT header enabled detection."}),"\n",(0,s.jsx)(n.li,{children:"Automated browser detection."}),"\n",(0,s.jsx)(n.li,{children:"Content filters detection: Adblock detection."}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.li,{children:["Hardware information:","\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Screen resolution."}),"\n",(0,s.jsx)(n.li,{children:"Color resolution."}),"\n",(0,s.jsx)(n.li,{children:"Device type."}),"\n",(0,s.jsx)(n.li,{children:"Device memory."}),"\n",(0,s.jsx)(n.li,{children:"CPU cores."}),"\n",(0,s.jsx)(n.li,{children:"Max touch points."}),"\n",(0,s.jsx)(n.li,{children:"WebGL vendor."}),"\n",(0,s.jsx)(n.li,{children:"WebGL renderer."}),"\n",(0,s.jsx)(n.li,{children:"Battery level."}),"\n",(0,s.jsx)(n.li,{children:"Battery status."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function getCanvasFingerprint() {\n  const canvas = document.createElement('canvas')\n  const context = canvas.getContext('2d')\n  context.font = '18pt Arial'\n  context.textBaseline = 'top'\n  context.fillText('Hello, user.', 2, 2)\n  return canvas.toDataURL('image/jpeg')\n}\n\ngetCanvasFingerprint()\n"})})]})}function h(e={}){let{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}},30416(e,n,r){r.d(n,{R:()=>c,x:()=>l});var i=r(59471);let s={},t=i.createContext(s);function c(e){let n=i.useContext(t);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);