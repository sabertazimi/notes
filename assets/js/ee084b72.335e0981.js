"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["51361"],{25847(e,n,i){i.r(n),i.d(n,{metadata:()=>t,default:()=>g,frontMatter:()=>s,contentTitle:()=>o,toc:()=>c,assets:()=>a});var t=JSON.parse('{"id":"web/testing/debugging","title":"Debugging","description":"Monkey Patch","source":"@site/content/web/testing/debugging.md","sourceDirName":"web/testing","slug":"/web/testing/debugging","permalink":"/notes/web/testing/debugging","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/testing/debugging.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Testing","permalink":"/notes/tags/testing"},{"inline":true,"label":"Debugging","permalink":"/notes/tags/debugging"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":10,"frontMatter":{"sidebar_position":10,"tags":["Web","Testing","Debugging"]},"sidebar":"tutorialSidebar","previous":{"title":"Cypress","permalink":"/notes/web/testing/cypress"},"next":{"title":"DevTools","permalink":"/notes/web/testing/devtools"}}'),r=i(62615),l=i(30416);let s={sidebar_position:10,tags:["Web","Testing","Debugging"]},o="Debugging",a={},c=[{value:"Monkey Patch",id:"monkey-patch",level:2},{value:"Window State",id:"window-state",level:3},{value:"Event Propagation",id:"event-propagation",level:3},{value:"Window Scroll",id:"window-scroll",level:3},{value:"Logging",id:"logging",level:2},{value:"Type",id:"type",level:3},{value:"Information",id:"information",level:3},{value:"Setup",id:"setup",level:3},{value:"Clock",id:"clock",level:3},{value:"Tracing",id:"tracing",level:2},{value:"Trace Property",id:"trace-property",level:3},{value:"Node.js",id:"nodejs",level:2},{value:"Bug List",id:"bug-list",level:2},{value:"Basic Bug",id:"basic-bug",level:3},{value:"C Bug",id:"c-bug",level:3},{value:"Occasional Bug",id:"occasional-bug",level:3}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"debugging",children:"Debugging"})}),"\n",(0,r.jsx)(n.h2,{id:"monkey-patch",children:"Monkey Patch"}),"\n",(0,r.jsx)(n.h3,{id:"window-state",children:"Window State"}),"\n",(0,r.jsxs)(n.p,{children:["Inject trace function (log, monitor, report service)\nto window ",(0,r.jsx)(n.code,{children:"pushState"})," and ",(0,r.jsx)(n.code,{children:"replaceState"}),"."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function _wr(type) {\n  const orig = window.history[type]\n\n  return function (...args) {\n    const rv = orig.apply(this, args)\n    const e = new Event(type.toLowerCase())\n    e.arguments = args\n    window.dispatchEvent(e)\n    return rv\n  }\n}\n\nwindow.history.pushState = _wr('pushState')\nwindow.history.replaceState = _wr('replaceState')\n\nwindow.addEventListener('pushstate', (event) => {\n  console.trace('pushState')\n})\n\nwindow.addEventListener('replacestate', (event) => {\n  console.trace('replaceState')\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"event-propagation",children:"Event Propagation"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const originalStopPropagation = MouseEvent.prototype.stopPropagation\n\nMouseEvent.prototype.stopPropagation = function (...args) {\n  console.trace('stopPropagation')\n  originalStopPropagation.call(this, ...args)\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"window-scroll",children:"Window Scroll"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"let originalScrollTop = element.scrollTop\n\nObject.defineProperty(element, 'scrollTop', {\n  get() {\n    return originalScrollTop\n  },\n  set(newVal) {\n    console.trace('scrollTop')\n    originalScrollTop = newVal\n  },\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"logging",children:"Logging"}),"\n",(0,r.jsx)(n.h3,{id:"type",children:"Type"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Application client log."}),"\n",(0,r.jsx)(n.li,{children:"Web server log."}),"\n",(0,r.jsx)(n.li,{children:"Database server log."}),"\n",(0,r.jsx)(n.li,{children:"Access log."}),"\n",(0,r.jsx)(n.li,{children:"Debug log."}),"\n",(0,r.jsx)(n.li,{children:"Error log."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"information",children:"Information"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u65E5\u5FD7\u65F6\u95F4: \u5305\u542B\u65F6\u533A\u4FE1\u606F\u548C\u6BEB\u79D2."}),"\n",(0,r.jsx)(n.li,{children:"\u65E5\u5FD7\u7EA7\u522B."}),"\n",(0,r.jsx)(n.li,{children:"\u4F1A\u8BDD\u6807\u8BC6."}),"\n",(0,r.jsx)(n.li,{children:"\u529F\u80FD\u6807\u8BC6."}),"\n",(0,r.jsx)(n.li,{children:"\u7CBE\u70BC\u5185\u5BB9: \u573A\u666F\u4FE1\u606F, \u72B6\u6001\u4FE1\u606F (\u5F00\u59CB/\u4E2D\u65AD/\u7ED3\u675F), \u91CD\u8981\u53C2\u6570."}),"\n",(0,r.jsx)(n.li,{children:"\u5176\u4ED6\u4FE1\u606F: \u7248\u672C\u53F7, \u7EBF\u7A0B\u53F7."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"setup",children:"Setup"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"const { createLogger, format, transports } = require('winston')\n\nconst logLevels = {\n  fatal: 0,\n  error: 1,\n  warn: 2,\n  info: 3,\n  debug: 4,\n  trace: 5,\n}\n\nconst logger = createLogger({\n  levels: logLevels,\n  format: format.combine(format.timestamp(), format.json()),\n  transports: [new transports.Console()],\n})\n\nlogger.info('System Started')\nlogger.fatal('Fatal error occurred')\n"})}),"\n",(0,r.jsx)(n.h3,{id:"clock",children:"Clock"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"performance.now()"})," is more precise (100 us)."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"performance.now()"})," is strictly monotonic (unaffected by changes of machine time)."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"let lastVisibilityChange = 0\n\nwindow.addEventListener('visibilitychange', () => {\n  lastVisibilityChange = performance.now()\n})\n\n// don\u2019t log any metrics started before the last visibility change\n// don't log any metrics if the page is hidden\n// discard perf data from when the machine was not running app at full speed\nfunction metrics() {\n  if (metric.start < lastVisibilityChange || document.hidden)\n    return\n\n  process()\n}\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"requestAnimationFrame(() => {\n  requestAnimationFrame((timestamp) => {\n    metric.finish(timestamp)\n  })\n})\n"})}),"\n",(0,r.jsx)(n.h2,{id:"tracing",children:"Tracing"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"debugger"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"// debugger;\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"copy(obj) // to clipboard\n"})}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"window.onerror = function (errorMessage, scriptURI, lineNo, columnNo, error) {\n  console.log(`errorMessage: ${errorMessage}`) // \u5F02\u5E38\u4FE1\u606F\n  console.log(`scriptURI: ${scriptURI}`) // \u5F02\u5E38\u6587\u4EF6\u8DEF\u5F84\n  console.log(`lineNo: ${lineNo}`) // \u5F02\u5E38\u884C\u53F7\n  console.log(`columnNo: ${columnNo}`) // \u5F02\u5E38\u5217\u53F7\n  console.log(`error: ${error}`) // \u5F02\u5E38\u5806\u6808\u4FE1\u606F\n  // ...\n  // \u5F02\u5E38\u4E0A\u62A5\n}\n\nwindow.addEventListener('error', () => {\n  console.log(error)\n  // ...\n  // \u5F02\u5E38\u4E0A\u62A5\n})\n"})}),"\n",(0,r.jsx)(n.h3,{id:"trace-property",children:"Trace Property"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-ts",children:"function traceProperty(object, property) {\n  let value = object[property]\n  Object.defineProperty(object, property, {\n    get() {\n      console.trace(`${property} requested`)\n      return value\n    },\n    set(newValue) {\n      console.trace(`setting ${property} to `, newValue)\n      value = newValue\n    },\n  })\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"nodejs",children:"Node.js"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.code,{children:"node --inspect"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.a,{href:"https://github.com/GoogleChromeLabs/ndb",children:"ndb"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"node --inspect\nndb index.js\n"})}),"\n",(0,r.jsx)(n.h2,{id:"bug-list",children:"Bug List"}),"\n",(0,r.jsx)(n.h3,{id:"basic-bug",children:"Basic Bug"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5FC5\u987B\u8FDB\u884C\u8F93\u5165\u9A8C\u8BC1 - \u6C38\u8FDC\u4E0D\u8981\u76F8\u4FE1\u7528\u6237\u8F93\u5165."}),"\n",(0,r.jsx)(n.li,{children:"\u6C38\u4E0D\u4F7F\u7528\u672A\u7ECF\u9A8C\u8BC1\u7684\u6570\u503C\u7684\u957F\u5EA6\u6216\u5927\u5C0F."}),"\n",(0,r.jsx)(n.li,{children:"\u5FC5\u987B\u8FD4\u56DE\u6B63\u786E\u7684\u9519\u8BEF\u72B6\u6001."}),"\n",(0,r.jsx)(n.li,{children:"\u6CE8\u610F(\u9690\u5F0F)\u7C7B\u578B\u8F6C\u6362."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"c-bug",children:"C Bug"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u6808\u7F13\u51B2\u533A\u6EA2\u51FA."}),"\n",(0,r.jsx)(n.li,{children:"\u7A7A\u6307\u9488\u89E3\u5F15\u7528."}),"\n",(0,r.jsx)(n.li,{children:"(\u9690\u5F0F)\u7C7B\u578B\u8F6C\u6362."}),"\n",(0,r.jsx)(n.li,{children:"GOT \u8986\u5199 (Global Offset Table)."}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"occasional-bug",children:"Occasional Bug"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u591A\u8FDB\u7A0B\u5B8C\u5168\u5F02\u6B65\u7F16\u7A0B\u7684\u590D\u6742\u6027."}),"\n",(0,r.jsx)(n.li,{children:"\u9010\u6E10\u5730\u5185\u5B58\u6CC4\u6F0F."}),"\n"]})]})}function g(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},30416(e,n,i){i.d(n,{R:()=>s,x:()=>o});var t=i(59471);let r={},l=t.createContext(r);function s(e){let n=t.useContext(l);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);