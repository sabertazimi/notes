"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["5718"],{3501(e,r,n){n.r(r),n.d(r,{metadata:()=>t,default:()=>u,frontMatter:()=>a,contentTitle:()=>i,toc:()=>l,assets:()=>d});var t=JSON.parse('{"id":"web/react/redux/core","title":"Core","description":"Concepts","source":"@site/content/web/react/redux/core.md","sourceDirName":"web/react/redux","slug":"/web/react/redux/core","permalink":"/notes/web/react/redux/core","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/redux/core.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"Redux","permalink":"/notes/tags/redux"},{"inline":true,"label":"State Management","permalink":"/notes/tags/state-management"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":1,"frontMatter":{"sidebar_position":1,"tags":["Web","React","Redux","State Management"]},"sidebar":"tutorialSidebar","previous":{"title":"Redux","permalink":"/notes/web/react/redux/"},"next":{"title":"Toolkit","permalink":"/notes/web/react/redux/toolkit"}}'),s=n(62615),o=n(30416);let a={sidebar_position:1,tags:["Web","React","Redux","State Management"]},i="Core",d={},l=[{value:"Concepts",id:"concepts",level:2},{value:"Store",id:"store",level:2},{value:"Creation",id:"creation",level:3},{value:"Configuration",id:"configuration",level:3},{value:"State",id:"state",level:2},{value:"Persistence",id:"persistence",level:3},{value:"Normalization",id:"normalization",level:3},{value:"Entity Adapter",id:"entity-adapter",level:3}];function c(e){let r={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"core",children:"Core"})}),"\n",(0,s.jsx)(r.h2,{id:"concepts",children:"Concepts"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u5355\u4E00\u6570\u636E\u6E90: \u6574\u4E2A\u5E94\u7528\u7A0B\u5E8F\u7684\u72B6\u6001\u5B58\u50A8\u5728\u5355\u4E2A\u5BF9\u8C61\u6811\u4E2D (\u5BB9\u6613\u8DDF\u8E2A/\u8C03\u8BD5)"}),"\n",(0,s.jsx)(r.li,{children:"\u72B6\u6001\u53EA\u8BFB: \u901A\u8FC7 dispatch(action) \u95F4\u63A5\u66F4\u6539\u72B6\u6001, \u4E0D\u76F4\u63A5\u5199\u5165\u72B6\u6001"}),"\n",(0,s.jsx)(r.li,{children:"\u7EAF\u51FD\u6570\u66F4\u6539\u72B6\u6001: reducer(state, action) => newState"}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"store",children:"Store"}),"\n",(0,s.jsx)(r.p,{children:"Redux \u4E2D\u53EA\u6709\u4E00\u4E2A\u5168\u5C40\u552F\u4E00 store \u72B6\u6001\u6811, \u4E14\u7531 reducers \u521B\u5EFA store."}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"export default appStore = createStore(rootReducers, initState)\n"})}),"\n",(0,s.jsx)(r.h3,{id:"creation",children:"Creation"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"import { applyMiddleware, createStore } from 'redux'\r\nimport { composeWithDevTools } from 'redux-devtools-extension'\r\nimport thunkMiddleware from 'redux-thunk'\r\n\r\nimport monitorReducersEnhancer from './enhancers/monitorReducers'\r\nimport loggerMiddleware from './middleware/logger'\r\nimport rootReducer from './reducers'\r\n\r\nexport default function configureStore(preloadedState) {\r\n  const middlewares = [loggerMiddleware, thunkMiddleware]\r\n  const middlewareEnhancer = applyMiddleware(...middlewares)\r\n\r\n  const enhancers = [middlewareEnhancer, monitorReducersEnhancer]\r\n  const composedEnhancers = composeWithDevTools(...enhancers)\r\n\r\n  const store = createStore(rootReducer, preloadedState, composedEnhancers)\r\n\r\n  if (process.env.NODE_ENV !== 'production' && module.hot)\r\n    module.hot.accept('./reducers', () => store.replaceReducer(rootReducer))\r\n\r\n  return store\r\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"configuration",children:"Configuration"}),"\n",(0,s.jsxs)(r.p,{children:["By default, ",(0,s.jsx)(r.code,{children:"configureStore"})," from Redux Toolkit will:"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Call ",(0,s.jsx)(r.code,{children:"applyMiddleware"})," with a default list of middlewares","\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"https://github.com/reduxjs/redux-thunk",children:"Async thunk middleware"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"https://redux-toolkit.js.org/api/immutabilityMiddleware",children:"Immutability check middleware"}),":\r\nthrow error when detecting mutations in reducers during a dispatch."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.a,{href:"https://redux-toolkit.js.org/api/serializabilityMiddleware",children:"Serializability check middleware"}),":\r\nthrow error when deeply detecting non-serializable values in state tree\r\n(functions, promises, symbols, and other non-plain-data values)."]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(r.li,{children:["Call ",(0,s.jsx)(r.code,{children:"composeWithDevTools"})," to set up the Redux DevTools Extension."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"import { configureStore, getDefaultMiddleware } from '@reduxjs/toolkit'\r\nimport loggerMiddleware from './middleware/logger'\r\nimport rootReducer from './reducers'\r\n\r\nexport default function configureAppStore(preloadedState) {\r\n  const store = configureStore({\r\n    reducer: rootReducer,\r\n    middleware: [loggerMiddleware, ...getDefaultMiddleware()],\r\n    preloadedState,\r\n  })\r\n\r\n  if (process.env.NODE_ENV === 'development' && module.hot)\r\n    module.hot.accept('./reducers', () => store.replaceReducer(rootReducer))\r\n\r\n  return store\r\n}\n"})}),"\n",(0,s.jsx)(r.h2,{id:"state",children:"State"}),"\n",(0,s.jsx)(r.p,{children:"\u5728 Redux \u4E2D State \u5E76\u4E0D\u663E\u5F0F\u5B9A\u4E49:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"\u521D\u6001\u4E0E\u53D8\u5316\u6001\u7686\u7531 Reducers \u5B9A\u4E49\u5E76\u63A7\u5236"}),"\n",(0,s.jsx)(r.li,{children:"Actions \u4E2D\u4FDD\u5B58\u7740 action.type \u5916, \u8FD8\u4FDD\u5B58\u7740\u4F9B Reducers \u8FDB\u884C\u6709\u6548\u72B6\u6001\u53D8\u5316\u7684\u5176\u4ED6\u4FE1\u606F(\u53EF\u81EA\u5B9A\u4E49)"}),"\n",(0,s.jsx)(r.li,{children:"\u8C03\u7528 Dispatch \u65B9\u6CD5\u81EA\u52A8\u5411 Store \u4F20\u9012\u4E00\u4E2A Action(\u56E0\u4E3A\u53EA\u6709\u4E00\u4E2A\u5168\u5C40 Store, \u6545\u65E0\u9700\u989D\u5916\u6307\u5B9A Store \u53C2\u6570),\r\nStore \u904D\u5386\u8C03\u7528\u5176\u4E2D\u7684 Reducers, \u6839\u636E switch \u8BED\u53E5\u8FDB\u884C\u5339\u914D action \u5904\u7406"}),"\n",(0,s.jsx)(r.li,{children:"reducer \u53EA\u4FDD\u5B58\u6700\u57FA\u672C\u7684 state, \u53EF\u8BA1\u7B97\u51FA\u7684 state \u653E\u5728 mapStateToProps(selector) \u4E2D\u76F4\u63A5\u8BA1\u7B97\u540E\u7ED1\u5B9A\u81F3 props"}),"\n",(0,s.jsx)(r.li,{children:"\u5C06\u6570\u636E\u4FDD\u5B58\u5728 Redux \u5B58\u50A8\u4E2D, \u5E76\u5728\u7EC4\u4EF6\u5185\u90E8\u4FDD\u6301 UI \u76F8\u5173\u72B6\u6001"}),"\n"]}),"\n",(0,s.jsx)(r.h3,{id:"persistence",children:"Persistence"}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"// localStorage.getItem('state')/localStorage.setItem('state', serializedState)\r\nconst persistedState = loadLocalStorageState()\r\nconst appStore = createStore(rootReducers, persistedState)\r\n\r\nappStore.subscribe(\r\n  throttle(() => {\r\n    saveLocalStorageState({\r\n      todos: store.getState().todos,\r\n    })\r\n  }, 1000)\r\n)\n"})}),"\n",(0,s.jsx)(r.h3,{id:"normalization",children:"Normalization"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.a,{href:"https://redux.js.org/usage/structuring-reducers/normalizing-state-shape",children:"Redux normalizing state shape"}),":"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Only have one copy of each particular piece of data in state (no duplication)."}),"\n",(0,s.jsx)(r.li,{children:"Normalized data is kept in lookup table (key-value store),\r\nwhere item IDs are keys, items themselves are values."}),"\n",(0,s.jsx)(r.li,{children:"There may also be an array of all of the IDs for a particular item type."}),"\n"]}),"\n",(0,s.jsx)(r.p,{children:"Normalizing data:"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Each type of data gets its own ",(0,s.jsx)(r.code,{children:"table"})," in state."]}),"\n",(0,s.jsxs)(r.li,{children:["Each ",(0,s.jsx)(r.code,{children:"data table"})," should store individual items in an ",(0,s.jsx)(r.code,{children:"{ key, value }"})," object:\r\n",(0,s.jsx)(r.code,{children:'"p1" : { id : "p1", author : "user1", comments : ["comment1", "comment2"] }'}),"."]}),"\n",(0,s.jsx)(r.li,{children:"Any references to individual items should be item ID."}),"\n",(0,s.jsx)(r.li,{children:"Arrays of IDs should be used to indicate ordering."}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"const state = {\r\n  users: {\r\n    ids: ['user1', 'user2', 'user3'],\r\n    entities: {\r\n      user1: { id: 'user1', firstName, lastName },\r\n      user2: { id: 'user2', firstName, lastName },\r\n      user3: { id: 'user3', firstName, lastName },\r\n    },\r\n  },\r\n}\r\n\r\nconst userId = 'user2'\r\nconst userObject = state.users.entities[userId]\n"})}),"\n",(0,s.jsxs)(r.p,{children:["Normalize nesting data with ",(0,s.jsx)(r.a,{href:"https://github.com/paularmstrong/normalizr",children:"Normalizr"}),":"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"const data = {\r\n  entities: {\r\n    authors: { byId: {}, allIds: [] },\r\n    books: { byId: {}, allIds: [] },\r\n    authorBook: {\r\n      byId: {\r\n        1: {\r\n          id: 1,\r\n          authorId: 5,\r\n          bookId: 22,\r\n        },\r\n        2: {\r\n          id: 2,\r\n          authorId: 5,\r\n          bookId: 15,\r\n        },\r\n        3: {\r\n          id: 3,\r\n          authorId: 42,\r\n          bookId: 12,\r\n        },\r\n      },\r\n      allIds: [1, 2, 3],\r\n    },\r\n  },\r\n}\n"})}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"const blogPosts = [\r\n  {\r\n    id: 'post1',\r\n    author: { username: 'user1', name: 'User 1' },\r\n    body: '......',\r\n    comments: [\r\n      {\r\n        id: 'comment1',\r\n        author: { username: 'user2', name: 'User 2' },\r\n        comment: '.....',\r\n      },\r\n      {\r\n        id: 'comment2',\r\n        author: { username: 'user3', name: 'User 3' },\r\n        comment: '.....',\r\n      },\r\n    ],\r\n  },\r\n  {\r\n    id: 'post2',\r\n    author: { username: 'user2', name: 'User 2' },\r\n    body: '......',\r\n    comments: [\r\n      {\r\n        id: 'comment3',\r\n        author: { username: 'user3', name: 'User 3' },\r\n        comment: '.....',\r\n      },\r\n      {\r\n        id: 'comment4',\r\n        author: { username: 'user1', name: 'User 1' },\r\n        comment: '.....',\r\n      },\r\n      {\r\n        id: 'comment5',\r\n        author: { username: 'user3', name: 'User 3' },\r\n        comment: '.....',\r\n      },\r\n    ],\r\n  },\r\n  // and repeat many times\r\n]\r\n\r\nconst normalizedBlogPosts = {\r\n  posts: {\r\n    byId: {\r\n      post1: {\r\n        id: 'post1',\r\n        author: 'user1',\r\n        body: '......',\r\n        comments: ['comment1', 'comment2'],\r\n      },\r\n      post2: {\r\n        id: 'post2',\r\n        author: 'user2',\r\n        body: '......',\r\n        comments: ['comment3', 'comment4', 'comment5'],\r\n      },\r\n    },\r\n    allIds: ['post1', 'post2'],\r\n  },\r\n  comments: {\r\n    byId: {\r\n      comment1: {\r\n        id: 'comment1',\r\n        author: 'user2',\r\n        comment: '.....',\r\n      },\r\n      comment2: {\r\n        id: 'comment2',\r\n        author: 'user3',\r\n        comment: '.....',\r\n      },\r\n      comment3: {\r\n        id: 'comment3',\r\n        author: 'user3',\r\n        comment: '.....',\r\n      },\r\n      comment4: {\r\n        id: 'comment4',\r\n        author: 'user1',\r\n        comment: '.....',\r\n      },\r\n      comment5: {\r\n        id: 'comment5',\r\n        author: 'user3',\r\n        comment: '.....',\r\n      },\r\n    },\r\n    allIds: ['comment1', 'comment2', 'comment3', 'comment4', 'comment5'],\r\n  },\r\n  users: {\r\n    byId: {\r\n      user1: {\r\n        username: 'user1',\r\n        name: 'User 1',\r\n      },\r\n      user2: {\r\n        username: 'user2',\r\n        name: 'User 2',\r\n      },\r\n      user3: {\r\n        username: 'user3',\r\n        name: 'User 3',\r\n      },\r\n    },\r\n    allIds: ['user1', 'user2', 'user3'],\r\n  },\r\n}\n"})}),"\n",(0,s.jsx)(r.h3,{id:"entity-adapter",children:"Entity Adapter"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.a,{href:"https://redux-toolkit.js.org/api/createEntityAdapter",children:"createEntityAdapter"}),":"]}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Build normalized state."}),"\n",(0,s.jsx)(r.li,{children:"Return normalized state CURD operation reducers."}),"\n",(0,s.jsxs)(r.li,{children:["Get data selectors by ",(0,s.jsx)(r.code,{children:"getSelectors"}),"."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{className:"language-ts",children:"import {\r\n  createAsyncThunk,\r\n  createEntityAdapter,\r\n  createSlice,\r\n} from '@reduxjs/toolkit'\r\nimport { client } from './api'\r\n\r\nconst postsAdapter = createEntityAdapter({\r\n  sortComparer: (a, b) => b.date.localeCompare(a.date),\r\n})\r\n\r\n// State = { ids: [], entities: {}, status: 'idle', error: null };\r\nconst initialState = postsAdapter.getInitialState({\r\n  status: 'idle',\r\n  error: null,\r\n})\r\n\r\nexport const fetchPosts = createAsyncThunk('posts/fetchPosts', async () => {\r\n  const response = await client.get('/fakeApi/posts')\r\n  return response.data\r\n})\r\n\r\nconst postsSlice = createSlice({\r\n  name: 'posts',\r\n  initialState,\r\n  reducers: {\r\n    reactionAdded(state, action) {\r\n      const { postId, reaction } = action.payload\r\n      const existingPost = state.entities[postId]\r\n      if (existingPost)\r\n        existingPost.reactions[reaction]++\r\n    },\r\n    postUpdated(state, action) {\r\n      const { id, title, content } = action.payload\r\n      const existingPost = state.entities[id]\r\n      if (existingPost) {\r\n        existingPost.title = title\r\n        existingPost.content = content\r\n      }\r\n    },\r\n  },\r\n  extraReducers(builder) {\r\n    builder\r\n      .addCase(fetchPosts.fulfilled, (state, action) => {\r\n        state.status = 'succeeded'\r\n        // Use the `upsertMany` reducer as a mutating update utility\r\n        postsAdapter.upsertMany(state, action.payload)\r\n      })\r\n      // Use the `addOne` reducer for the fulfilled case\r\n      .addCase(addNewPost.fulfilled, postsAdapter.addOne)\r\n  },\r\n})\r\n\r\nexport const { postAdded, postUpdated, reactionAdded } = postsSlice.actions\r\n\r\n// Export the customized selectors for this adapter using `getSelectors`\r\nexport const {\r\n  selectAll: selectAllPosts,\r\n  selectById: selectPostById,\r\n  selectIds: selectPostIds,\r\n  // Pass in a selector that returns the posts slice of state\r\n} = postsAdapter.getSelectors(state => state.posts)\r\n\r\nexport const selectPostsByUser = createSelector(\r\n  [selectAllPosts, (state, userId) => userId],\r\n  (posts, userId) => posts.filter(post => post.user === userId)\r\n)\r\n\r\nexport default postsSlice.reducer\n"})})]})}function u(e={}){let{wrapper:r}={...(0,o.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(c,{...e})}):c(e)}},30416(e,r,n){n.d(r,{R:()=>a,x:()=>i});var t=n(59471);let s={},o=t.createContext(s);function a(e){let r=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function i(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(o.Provider,{value:r},e.children)}}}]);