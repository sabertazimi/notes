"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["17538"],{25919(e,n,r){r.r(n),r.d(n,{metadata:()=>t,default:()=>p,frontMatter:()=>a,contentTitle:()=>l,toc:()=>d,assets:()=>c});var t=JSON.parse('{"id":"cs/compilers/generation","title":"Code Generation","description":"\u4E3A\u6570\u636E\u5206\u914D\u8BA1\u7B97\u8D44\u6E90:","source":"@site/content/cs/compilers/generation.md","sourceDirName":"cs/compilers","slug":"/cs/compilers/generation","permalink":"/notes/cs/compilers/generation","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/cs/compilers/generation.md","tags":[{"inline":true,"label":"CS","permalink":"/notes/tags/cs"},{"inline":true,"label":"Compiler","permalink":"/notes/tags/compiler"},{"inline":true,"label":"CodeGen","permalink":"/notes/tags/code-gen"},{"inline":true,"label":"Stack","permalink":"/notes/tags/stack"},{"inline":true,"label":"Register","permalink":"/notes/tags/register"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":20,"frontMatter":{"sidebar_position":20,"tags":["CS","Compiler","CodeGen","Stack","Register"]},"sidebar":"tutorialSidebar","previous":{"title":"Optimization","permalink":"/notes/cs/compilers/optimization"},"next":{"title":"Garbage Collection","permalink":"/notes/cs/compilers/gc"}}'),i=r(62615),s=r(30416);let a={sidebar_position:20,tags:["CS","Compiler","CodeGen","Stack","Register"]},l="Code Generation",c={},d=[{value:"\u9012\u5F52\u4E0B\u964D",id:"\u9012\u5F52\u4E0B\u964D",level:2},{value:"\u6808\u8BA1\u7B97\u673A",id:"\u6808\u8BA1\u7B97\u673A",level:3},{value:"\u5BC4\u5B58\u5668\u8BA1\u7B97\u673A",id:"\u5BC4\u5B58\u5668\u8BA1\u7B97\u673A",level:3}];function o(e){let n={blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"code-generation",children:"Code Generation"})}),"\n",(0,i.jsx)(n.p,{children:"\u4E3A\u6570\u636E\u5206\u914D\u8BA1\u7B97\u8D44\u6E90:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u6570\u636E: \u5168\u5C40\u53D8\u91CF, \u5C40\u90E8\u53D8\u91CF, \u52A8\u6001\u5206\u914D\u53D8\u91CF"}),"\n",(0,i.jsx)(n.li,{children:"\u8D44\u6E90: \u5BC4\u5B58\u5668(register), \u6570\u636E\u533A(.data, .bss), \u4EE3\u7801\u533A(.code), \u6808\u533A(runtime stack), \u5806\u533A(user heap)"}),"\n"]}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"\u5F53\u524D\u5C40\u90E8\u53D8\u91CF\u5E94\u8BE5\u653E\u5728\u5BC4\u5B58\u5668\u8FD8\u662F\u5185\u5B58\u533A?"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"\u4E3A\u4EE3\u7801\u9009\u62E9\u8BA1\u7B97\u6307\u4EE4(\u7B49\u4EF7\u6027):"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u4EE3\u7801: \u8868\u8FBE\u5F0F/\u8BED\u53E5/\u51FD\u6570\u4EE3\u7801"}),"\n",(0,i.jsx)(n.li,{children:"\u6307\u4EE4: \u7B97\u672F/\u6BD4\u8F83/\u8DF3\u8F6C/\u8C03\u7528/\u8FD4\u56DE\u6307\u4EE4"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"P: D S\n ;\n\nD: T id ';' D\n |\n ;\n\nT: int\n | bool\n ;\n\nS: id = E\n | printi (E)\n | printb (E)\n ;\n\nE: n\n | id\n | true\n | false\n | E + E\n | E && E\n ;\n"})}),"\n",(0,i.jsx)(n.h2,{id:"\u9012\u5F52\u4E0B\u964D",children:"\u9012\u5F52\u4E0B\u964D"}),"\n",(0,i.jsx)(n.h3,{id:"\u6808\u8BA1\u7B97\u673A",children:"\u6808\u8BA1\u7B97\u673A"}),"\n",(0,i.jsx)(n.p,{children:"Mem + Stack + ALU"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"JVM(Java Virtual Machine)"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"s: push NUM\n | load x\n | store x\n | add\n | sub\n | times\n | div\n ;\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'gen_prog(dec_t d, stm_t s) {\n  gen_dec(d);\n  gen_stm(s);\n}\n\ngen_dec(T id; D) {\n  // stack_code(".int id")\n  gen_type(T);\n  emit(" id");\n\n  gen_dec(D);\n}\n\ngen_type(type_t t) {\n  switch(t-kind) {\n    case INT:// fall through\n    case BOOL:\n      emit(".int");\n      break;\n  }\n}\n\ngen_stm(stm_t s) {\n  switch (s->kind) {\n    STM_ASSIGN:\n      gen_exp(s->exp);\n      emit("store s->id");\n      break;\n    STM_PRINTI:\n      gen_exp(s->exp);\n      emit("printi");\n      break;\n    STM_PRINTB:\n      gen_exp(s->exp);\n      emit("printb");\n      break;\n  }\n}\n\ngen_exp(exp_t e) {\n  switch (e->kind) {\n    case EXP_INT:\n      emit("push e->value");// n\n      break;\n    case EXP_ID:\n      emit("load e->value");// id\n      break;\n    case EXP_BOOL:\n      emit("push e->value");// 1/0\n      break;\n    case EXP_ADD:\n      gen_exp(e->left);\n      gen_exp(e->right);\n      emit("add");\n      break;\n    case EXP_AND:\n      gen_exp(e->left);\n      gen_exp(e->right);\n      emit("and");\n      break;\n  }\n}\n'})}),"\n",(0,i.jsx)(n.h3,{id:"\u5BC4\u5B58\u5668\u8BA1\u7B97\u673A",children:"\u5BC4\u5B58\u5668\u8BA1\u7B97\u673A"}),"\n",(0,i.jsx)(n.p,{children:"Mem + Reg + ALU"}),"\n",(0,i.jsxs)(n.blockquote,{children:["\n",(0,i.jsx)(n.p,{children:"MIPS ISA"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:"// src -> dist\ns: mov_n n, r\n | mov r1, r2\n | load [x], r\n | store r, [x]\n | add r1, r2, r3\n | sub r1, r2, r3\n | times r1, r2, r3\n | div r1, r2, r3\n"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-cpp",children:'void gen_prog(dec_t d, stm_t s) {\n  gen_dec(d);\n  gen_stm(s);\n}\n\nvoid gen_dec(T id; D) {\n  // reg_code(".int id")\n  // \u4E3A\u53D8\u91CF\u5206\u914D\u5BC4\u5B58\u5668\n  gen_type(T);\n  emit(" id");\n\n  gen_dec(D);\n}\n\nvoid gen_type(type_t t) {\n  switch(t-kind) {\n    case INT:// fall through\n    case BOOL:\n      emit(".int");\n      break;\n  }\n}\n\nvoid gen_stm(stm_t s) {\n  switch (s->kind) {\n    STM_ASSIGN:\n      r = gen_exp(s->exp);\n      emit("mov r, e->id");\n      break;\n    STM_PRINTI:\n      r = gen_exp(s->exp);\n      emit("printi r");\n      break;\n    STM_PRINTB:\n      r = gen_exp(s->exp);\n      emit("printb r");\n      break;\n  }\n}\n\nreg_t gen_exp(exp_t e) {\n  switch (e->kind) {\n    case EXP_INT:\n      r = random_reg();\n      emit("mov_n e->value, r");// n\n      return r;\n    case EXP_ID:\n      r = random_reg();\n      emit("mov e->value, r");// id\n      return r;\n    case EXP_BOOL:\n      r = random_reg();\n      emit("mov_n e->value, r");// 1/0\n      return r;\n    case EXP_ADD:\n      r1 = gen_exp(e->left);\n      r2 = gen_exp(e->right);\n      r = random_reg();\n      emit("add r1, r2, r");\n      return r;\n    case EXP_AND:\n      r1 = gen_exp(e->left);\n      r2 = gen_exp(e->right);\n      r = random_reg();\n      emit("and r1, r2, r");\n      return r;\n  }\n}\n'})})]})}function p(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},30416(e,n,r){r.d(n,{R:()=>a,x:()=>l});var t=r(59471);let i={},s=t.createContext(i);function a(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);