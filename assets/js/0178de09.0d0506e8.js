"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["2500"],{49722(e,t,n){n.r(t),n.d(t,{metadata:()=>s,default:()=>h,frontMatter:()=>r,contentTitle:()=>a,toc:()=>l,assets:()=>c});var s=JSON.parse('{"id":"web/react/state","title":"State","description":"SetState","source":"@site/content/web/react/state.md","sourceDirName":"web/react","slug":"/web/react/state","permalink":"/notes/web/react/state","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/react/state.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"React","permalink":"/notes/tags/react"},{"inline":true,"label":"State","permalink":"/notes/tags/state"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":2,"frontMatter":{"sidebar_position":2,"tags":["Web","React","State"]},"sidebar":"tutorialSidebar","previous":{"title":"Components","permalink":"/notes/web/react/components"},"next":{"title":"Synthetic Events","permalink":"/notes/web/react/event"}}'),o=n(62615),i=n(30416);let r={sidebar_position:2,tags:["Web","React","State"]},a="State",c={},l=[{value:"SetState",id:"setstate",level:2},{value:"componentDidMount",id:"componentdidmount",level:2}];function d(e){let t={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)(t.header,{children:(0,o.jsx)(t.h1,{id:"state",children:"State"})}),"\n",(0,o.jsx)(t.h2,{id:"setstate",children:"SetState"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"setState"})," synchronous way:\nwhen it comes ",(0,o.jsx)(t.code,{children:"blocking mode"}),"\n(",(0,o.jsx)(t.code,{children:"ReactDOM.createBlockingRoot(rootNode).render(<App />)"}),"),\n",(0,o.jsx)(t.code,{children:"setState"})," works in synchronous mode:\n",(0,o.jsx)(t.code,{children:"scheduleUpdateOnFiber"})," -> ",(0,o.jsx)(t.code,{children:"ensureRootIsScheduled"})," -> ",(0,o.jsx)(t.strong,{children:(0,o.jsx)(t.code,{children:"flushSyncCallbackQueue"})}),"."]}),"\n",(0,o.jsxs)(t.li,{children:[(0,o.jsx)(t.code,{children:"setState"})," asynchronous way:\nat most of the other time, ",(0,o.jsx)(t.code,{children:"setState"})," works in asynchronous mode,\nincluding ",(0,o.jsx)(t.code,{children:"legacy mode"}),"(",(0,o.jsx)(t.code,{children:"ReactDOM.render(<App />, rootNode)"}),")\nand ",(0,o.jsx)(t.code,{children:"concurrent mode"}),"(",(0,o.jsx)(t.code,{children:"ReactDOM.createRoot(rootNode).render(<App />)"}),")."]}),"\n",(0,o.jsxs)(t.li,{children:["\u5728\u5F02\u6B65\u6A21\u5F0F\u4E0B, \u4E3A\u4E86\u9632\u6B62\u5B50\u7EC4\u4EF6\u5728\u5904\u7406\u4E8B\u4EF6\u65F6\u591A\u6B21\u6E32\u67D3,\n\u5C06\u591A\u4E2A ",(0,o.jsx)(t.code,{children:"setState"})," (\u5305\u62EC\u7236\u7EC4\u4EF6) \u79FB\u5230\u6D4F\u89C8\u5668\u4E8B\u4EF6\u4E4B\u540E\u6267\u884C\n(",(0,o.jsx)(t.code,{children:"Batched Updates"}),": \u6B64\u65F6 React \u5185\u90E8\u53D8\u91CF ",(0,o.jsx)(t.code,{children:"isBatchingUpdates"})," \u53D8\u6210 ",(0,o.jsx)(t.code,{children:"true"}),"),\n\u53EF\u4EE5\u63D0\u5347 React \u6027\u80FD.\n\u672A\u6765\u4F1A\u5728\u66F4\u591A\u7684\u53EF\u4EE5 ",(0,o.jsx)(t.code,{children:"Batched Updates"})," \u7684\u573A\u666F\u4E0B\u5C06 ",(0,o.jsx)(t.code,{children:"setState"})," \u8BBE\u4E3A\u5F02\u6B65\u6267\u884C,\n\u6240\u4EE5\u7F16\u5199\u4EE3\u7801\u65F6\u6700\u597D\u5C06 ",(0,o.jsx)(t.code,{children:"setState"})," \u603B\u662F\u5F53\u505A\u5F02\u6B65\u6267\u884C\u51FD\u6570."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"class Example extends React.Component {\n  constructor() {\n    super()\n    this.state = {\n      val: 0,\n    }\n  }\n\n  componentDidMount() {\n    this.setState({ val: this.state.val + 1 })\n    console.log(this.state.val) // \u7B2C 1 \u6B21 log\n\n    this.setState({ val: this.state.val + 1 })\n    console.log(this.state.val) // \u7B2C 2 \u6B21 log\n\n    const timeout = setTimeout(() => {\n      this.setState({ val: this.state.val + 1 })\n      console.log(this.state.val) // \u7B2C 3 \u6B21 log\n\n      this.setState({ val: this.state.val + 1 })\n      console.log(this.state.val) // \u7B2C 4 \u6B21 log\n    }, 0)\n  }\n\n  componentWillUnmount() {\n    clearTimeout(timeout)\n  }\n\n  render() {\n    return <div>Example</div>\n  }\n}\n\n// => 0 0 2 3\n"})}),"\n",(0,o.jsxs)(t.admonition,{title:"State Structure Principles",type:"tip",children:[(0,o.jsxs)(t.p,{children:[(0,o.jsx)(t.a,{href:"https://react.dev/learn/choosing-the-state-structure",children:"Principles for structuring state"}),":"]}),(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsx)(t.li,{children:"Group related state."}),"\n",(0,o.jsx)(t.li,{children:"Avoid contradictions in state."}),"\n",(0,o.jsx)(t.li,{children:"Avoid duplication in state."}),"\n",(0,o.jsx)(t.li,{children:"Avoid redundant state."}),"\n",(0,o.jsx)(t.li,{children:"Avoid deeply nested state."}),"\n"]})]}),"\n",(0,o.jsx)(t.h2,{id:"componentdidmount",children:"componentDidMount"}),"\n",(0,o.jsxs)(t.ul,{children:["\n",(0,o.jsxs)(t.li,{children:["Don't ",(0,o.jsx)(t.code,{children:"setState"})," directly in this method."]}),"\n",(0,o.jsxs)(t.li,{children:["Can use ",(0,o.jsx)(t.code,{children:"setInterval"}),"/",(0,o.jsx)(t.code,{children:"setTimeout"}),"/AJAX request/",(0,o.jsx)(t.code,{children:"fetch"})," in this method,\nand call ",(0,o.jsx)(t.code,{children:"setState"})," as ",(0,o.jsx)(t.code,{children:"callback"})," inside these functions."]}),"\n"]}),"\n",(0,o.jsx)(t.pre,{children:(0,o.jsx)(t.code,{className:"language-tsx",children:"class MyComponent extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      error: null,\n      isLoaded: false,\n      items: [],\n    }\n  }\n\n  componentDidMount() {\n    fetch('https://api.example.com/items')\n      .then(res => res.json())\n      .then(\n        (result) => {\n          this.setState({\n            isLoaded: true,\n            items: result.items,\n          })\n        },\n        // Note: it's important to handle errors here\n        // instead of a catch() block so that we don't swallow\n        // exceptions from actual bugs in components.\n        (error) => {\n          this.setState({\n            isLoaded: true,\n            error,\n          })\n        },\n      )\n  }\n\n  render() {\n    const { error, isLoaded, items } = this.state\n    if (error) {\n      return (\n        <div>\n          Error:\n          {error.message}\n        </div>\n      )\n    } else if (!isLoaded) {\n      return <div>Loading...</div>\n    } else {\n      return (\n        <ul>\n          {items.map(item => (\n            <li key={item.name}>\n              {item.name}\n              {' '}\n              {item.price}\n            </li>\n          ))}\n        </ul>\n      )\n    }\n  }\n}\n"})})]})}function h(e={}){let{wrapper:t}={...(0,i.R)(),...e.components};return t?(0,o.jsx)(t,{...e,children:(0,o.jsx)(d,{...e})}):d(e)}},30416(e,t,n){n.d(t,{R:()=>r,x:()=>a});var s=n(59471);let o={},i=s.createContext(o);function r(e){let t=s.useContext(i);return s.useMemo(function(){return"function"==typeof e?e(t):{...t,...e}},[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:r(e.components),s.createElement(i.Provider,{value:t},e.children)}}}]);