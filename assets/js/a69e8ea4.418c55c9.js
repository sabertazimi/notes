"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["75979"],{66217(e,n,t){t.r(n),t.d(n,{metadata:()=>r,default:()=>h,frontMatter:()=>o,contentTitle:()=>i,toc:()=>a,assets:()=>c});var r=JSON.parse('{"id":"web/node/network","title":"Network","description":"Fetch","source":"@site/content/web/node/network.md","sourceDirName":"web/node","slug":"/web/node/network","permalink":"/notes/web/node/network","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/node/network.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Node.js","permalink":"/notes/tags/node-js"},{"inline":true,"label":"Network","permalink":"/notes/tags/network"},{"inline":true,"label":"Fetch","permalink":"/notes/tags/fetch"},{"inline":true,"label":"HTTP","permalink":"/notes/tags/http"},{"inline":true,"label":"Socket","permalink":"/notes/tags/socket"},{"inline":true,"label":"DNS","permalink":"/notes/tags/dns"},{"inline":true,"label":"URL","permalink":"/notes/tags/url"},{"inline":true,"label":"Best Practice","permalink":"/notes/tags/best-practice"}],"version":"current","lastUpdatedBy":"sabertazimi","lastUpdatedAt":1771383234000,"sidebarPosition":9,"frontMatter":{"sidebar_position":9,"tags":["Web","Node.js","Network","Fetch","HTTP","Socket","DNS","URL","Best Practice"]},"sidebar":"tutorialSidebar","previous":{"title":"Filesystem","permalink":"/notes/web/node/filesystem"},"next":{"title":"Crypto","permalink":"/notes/web/node/crypto"}}'),s=t(62615),l=t(30416);let o={sidebar_position:9,tags:["Web","Node.js","Network","Fetch","HTTP","Socket","DNS","URL","Best Practice"]},i="Network",c={},a=[{value:"Fetch",id:"fetch",level:2},{value:"Http",id:"http",level:2},{value:"Request",id:"request",level:3},{value:"Response",id:"response",level:3},{value:"Get",id:"get",level:3},{value:"Server",id:"server",level:3},{value:"Socket",id:"socket",level:2},{value:"DNS",id:"dns",level:2},{value:"URL",id:"url",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"References",id:"references",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",ul:"ul",...(0,l.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"network",children:"Network"})}),"\n",(0,s.jsx)(n.h2,{id:"fetch",children:"Fetch"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"async function fetchData(url) {\n  try {\n    const response = await fetch(url, {\n      signal: AbortSignal.timeout(5000) // Built-in timeout support\n    })\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`)\n    }\n\n    return await response.json()\n  } catch (error) {\n    if (error.name === 'TimeoutError') {\n      throw new Error('Request timed out')\n    }\n    throw error\n  }\n}\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Cancel long-running operations cleanly\nconst controller = new AbortController()\n\n// Set up automatic cancellation\nsetTimeout(() => controller.abort(), 10000)\n\ntry {\n  const data = await fetch('https://slow-api.com/data', {\n    signal: controller.signal\n  })\n  console.log('Data received:', data)\n} catch (error) {\n  if (error.name === 'AbortError') {\n    console.log('Request was cancelled - this is expected behavior')\n  } else {\n    console.error('Unexpected error:', error)\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"http",children:"Http"}),"\n",(0,s.jsx)(n.h3,{id:"request",children:"Request"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const request = {\n  method: 'POST',\n}\n"})}),"\n",(0,s.jsx)(n.h3,{id:"response",children:"Response"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-cpp",children:"typedef Stream response\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u76D1\u542C\u4E8B\u4EF6:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"response.on('data', (data) => {\n  process(data)\n})\nresponse.on('error', (err) => {\n  console.error(err)\n})\nresponse.on('end', () => {\n  stream.end()\n})\n"})}),"\n",(0,s.jsx)(n.p,{children:"\u53D1\u51FA\u4E8B\u4EF6:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"response.end() //  \u4F20\u8F93\u7ED3\u675F\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"response.setEncoding('utf8') // \u81EA\u52A8\u5C06 data \u4E8B\u4EF6\u4E2D Buffer \u5BF9\u8C61\u8F6C\u6362\u6210 String\n\n//  content-type: text/plain\n//                application/json\nresponse.writeHead(200, { 'Content-Type': '' })\n"})}),"\n",(0,s.jsx)(n.h3,{id:"get",children:"Get"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"http.get(url, (response) => {})\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"http.get(url, (response) => {\n  let pipeData = ''\n\n  response.setEncoding('utf8')\n  response.on('data', (data) => {\n    pipeData += data\n  })\n  response.on('end', () => {\n    console.log(pipeData.length)\n    console.log(pipeData)\n  })\n})\n"})}),"\n",(0,s.jsx)(n.h3,{id:"server",children:"Server"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const server = http.createServer((request, response) => {\n  // \u5904\u7406\u8BF7\u6C42\u7684\u903B\u8F91...\n})\nserver.listen(8000)\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const net = require('node:net')\n\nconst chatServer = net.createServer()\n// \u7528\u4E8E\u68C0\u6D4B\u50F5\u5C38\u5BA2\u6237\u7AEF,\u7528\u4E8E\u53CA\u65F6\u6E05\u9664\u50F5\u5C38\u5BA2\u6237\u7AEF\nconst clientList = []\n\nchatServer.on('connection', (client) => {\n  client.name = `${client.remoteAddress}:${client.remotePort}`\n  client.write(`Hi ${client.name}!\\n`)\n  clientList.push(client)\n\n  client.on('data', (data) => {\n    broadcast(data, client)\n  })\n  client.on('end', () => {\n    clientList.splice(clientList.indexOf(client), 1)\n  })\n  client.on('error', (e) => {\n    console.log(e)\n  })\n})\n\nfunction broadcast(message, client) {\n  const cleanup = []\n\n  for (let i = 0; i < clientList.length; i += 1) {\n    // \u5411\u5176\u4ED6\u4EBA(\u6392\u9664\u81EA\u8EAB)\u53D1\u9001\u6D88\u606F\n    if (client !== clientList[i]) {\n      if (clientList[i].writable) {\n        clientList[i].write(`${client.name} says ${message}`)\n      } else {\n        cleanup.push(clientList[i])\n        clientList[i].destroy()\n      }\n    }\n  }\n\n  // \u6E05\u9664\u50F5\u5C38\u5BA2\u6237\u7AEF\n  for (let i = 0; i < cleanup.length; i += 1)\n    clientList.splice(clientList.indexOf(cleanup[i]), 1)\n}\n\nchatServer.listen(9000)\n"})}),"\n",(0,s.jsx)(n.h2,{id:"socket",children:"Socket"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"socket.write(data)\nsocket.end(data)\nsocket.end()\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const fs = require('node:fs')\nconst http = require('node:http')\nconst io = require('socket.io')\n\nconst sockFile = fs.readFileSync('socket.html')\n\nserver = http.createServer()\nserver.on('request', (req, res) => {\n  res.writeHead(200, { 'content-type': 'text/html' })\n  res.end(sockFile)\n})\nserver.listen(8080)\n\nconst socket = io.listen(server)\n\n// \u547D\u540D\u7A7A\u95F4\nsocket.of('/upAndRunning').on('connection', (client) => {\n  console.log('Client connected to Up and Running namespace.')\n  client.send('Welcome to \\'Up and Running\\'')\n})\nsocket.of('/weather').on('connection', (client) => {\n  console.log('Client connected to Weather namespace.')\n  client.send('Welcome to \\'Weather Updates\\'')\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"dns",children:"DNS"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"dns.resolve"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"dns.reverse"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"dns.lookup"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const dns = require('node:dns')\n\ndns.lookup('google.com', 4, (e, a) => {\n  console.log(a)\n})\n\ndns.resolve('tazimi.tk', 'A', (e, r) => {\n  if (e)\n    console.log(e)\n\n  console.log(JSON.stringify(r, null, 2))\n})\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const dns = require('node:dns')\n\ndns.resolve('tazimi.dev', 'A', (err, res) => {\n  if (err)\n    console.log(err)\n  else\n    console.log(`A: ${JSON.stringify(res, null, 2)}`)\n})\n\ndns.resolve('github.com', 'MX', (err, res) => {\n  if (err)\n    console.log(err)\n  else\n    console.log(`MX: ${JSON.stringify(res, null, 2)}`)\n})\n"})}),"\n",(0,s.jsx)(n.h2,{id:"url",children:"URL"}),"\n",(0,s.jsx)(n.p,{children:"\u89E3\u6790\u5904 URL \u5404\u4E2A\u7EC4\u6210\u90E8\u5206:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"href"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"protocol"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"host"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"auth"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"hostname"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"port"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"pathname"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"search"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"query"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.code,{children:"hash"})}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// true \u8868\u793A\u8C03\u7528 queryString \u6A21\u5757\u67E5\u8BE2\u5B57\u7B26\u4E32\nurl.parse(request.url, true)\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"function buildUrl(baseUrl, params) {\n  const url = new URL(baseUrl)\n\n  for (const [key, value] of Object.entries(params)) {\n    if (value !== undefined && value !== null) {\n      url.searchParams.append(key, value)\n    }\n  }\n\n  return url.toString()\n}\n\nconst url = buildUrl('https://api.example.com/search', {\n  query: 'node.js',\n  page: 1,\n  limit: 20,\n  sort: 'date',\n})\n\nconst response = await fetch(url)\nconsole.log(url)\n// https://api.example.com/search?query=node.js&page=1&limit=20&sort=date\n"})}),"\n",(0,s.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["Always handle errors (",(0,s.jsx)(n.code,{children:"try/catch"})," and status codes)."]}),"\n",(0,s.jsxs)(n.li,{children:["Set timeouts (",(0,s.jsx)(n.code,{children:"AbortController"}),")."]}),"\n",(0,s.jsx)(n.li,{children:"Validate responses before accessing properties."}),"\n",(0,s.jsx)(n.li,{children:"Use environment variables for URLs and tokens."}),"\n",(0,s.jsx)(n.li,{children:"Consider rate limiting (backoff strategies for retries)."}),"\n",(0,s.jsx)(n.li,{children:"Log requests in development."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"// Example: Wrapper with best practices\nasync function apiRequest(endpoint, options = {}) {\n  // [Practice #4] Load sensitive values from environment variables\n  const baseUrl = process.env.API_BASE_URL\n  const token = process.env.API_TOKEN\n\n  // [Practice #1] Wrap in try/catch to handle errors\n  try {\n    const response = await fetch(`${baseUrl}${endpoint}`, {\n      ...options,\n      signal: AbortSignal.timeout(10000), // [Practice #2] Set 10s timeout\n      headers: {\n        'Authorization': `Bearer ${token}`, // [Practice #4] Use env var for token\n        'Content-Type': 'application/json',\n        ...options.headers,\n      },\n    })\n\n    // [Practice #1] Check response status and handle errors\n    if (!response.ok) {\n      const errorBody = await response.text()\n      throw new Error(`API error ${response.status}: ${errorBody}`)\n    }\n\n    // [Practice #3] Parse response (caller should validate structure)\n    return await response.json()\n  } catch (error) {\n    // [Practice #2] Handle timeout specifically\n    if (error.name === 'TimeoutError') {\n      throw new Error(`Request to ${endpoint} timed out`)\n    }\n\n    throw error\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["HTTP request definitive ",(0,s.jsx)(n.a,{href:"https://nodejsdesignpatterns.com/blog/nodejs-http-request",children:"guide"}),"."]}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},30416(e,n,t){t.d(n,{R:()=>o,x:()=>i});var r=t(59471);let s={},l=r.createContext(s);function o(e){let n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:o(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);