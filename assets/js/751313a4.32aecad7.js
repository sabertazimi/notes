"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["6189"],{36101(e,n,t){t.r(n),t.d(n,{metadata:()=>a,default:()=>h,frontMatter:()=>i,contentTitle:()=>c,toc:()=>l,assets:()=>o});var a=JSON.parse('{"id":"web/javascript/collection","title":"Collection","description":"Map","source":"@site/content/web/javascript/collection.md","sourceDirName":"web/javascript","slug":"/web/javascript/collection","permalink":"/notes/web/javascript/collection","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/javascript/collection.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/notes/tags/ecma-script"},{"inline":true,"label":"Collection","permalink":"/notes/tags/collection"},{"inline":true,"label":"Map","permalink":"/notes/tags/map"},{"inline":true,"label":"Set","permalink":"/notes/tags/set"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":7,"frontMatter":{"sidebar_position":7,"tags":["Web","JavaScript","ECMAScript","Collection","Map","Set"]},"sidebar":"tutorialSidebar","previous":{"title":"Array","permalink":"/notes/web/javascript/array"},"next":{"title":"Temporal","permalink":"/notes/web/javascript/temporal"}}'),s=t(62615),r=t(30416);let i={sidebar_position:7,tags:["Web","JavaScript","ECMAScript","Collection","Map","Set"]},c="Collection",o={},l=[{value:"Map",id:"map",level:2},{value:"Set",id:"set",level:2},{value:"WeakMap and WeakSet",id:"weakmap-and-weakset",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,r.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"collection",children:"Collection"})}),"\n",(0,s.jsx)(n.h2,{id:"map",children:"Map"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"size"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"has()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"get()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"set()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"delete()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"clear()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"keys()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"values()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"entries()"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const map = new Map([\n  // You define a map via an array of 2-element arrays. The first\n  // element of each nested array is the key, and the 2nd is the value\n  ['name', 'Jean-Luc Picard'],\n  ['age', 59],\n  ['rank', 'Captain'],\n])\n\n// To get the value associated with a given `key` in a map, you\n// need to call `map.get(key)`. Using `map.key` will **not** work.\nmap.get('name') // 'Jean-Luc Picard'\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const map = new Map([])\nconst n1 = new Number(5)\nconst n2 = new Number(5)\n\nmap.set(n1, 'One')\nmap.set(n2, 'Two')\n\n// `n1` and `n2` are objects, so `n1 !== n2`. That means the map has\n// separate keys for `n1` and `n2`.\nmap.get(n1) // 'One'\nmap.get(n2) // 'Two'\nmap.get(5) // undefined\n\n// If you were to do this with an object, `n2` would overwrite `n1`\nconst obj = {}\nobj[n1] = 'One'\nobj[n2] = 'Two'\n\nconst two1 = obj[n1] // 'Two'\nconst two2 = obj[5] // 'Two'\n"})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const objectClone = new Map(Object.entries(object))\nconst arrayClone = new Map(Array.from(map.entries))\nconst map = new Map([\n  ['name', 'Jean-Luc Picard'],\n  ['age', 59],\n  ['rank', 'Captain'],\n])\n\n// The `for/of` loop can loop through iterators\nfor (const key of map.keys())\n  console.log(key) // 'name', 'age', 'rank'\n\nfor (const value of map.values())\n  console.log(value) // 'Jean-Luc Picard', 59, 'Captain'\n\nfor (const [key, value] of map.entries()) {\n  console.log(key) // 'name', 'age', 'rank'\n  console.log(value) // 'Jean-Luc Picard', 59, 'Captain'\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"set",children:"Set"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"size"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"has()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"add()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"delete()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"clear()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"keys()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"values()"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.code,{children:"entries()"}),"."]}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"class XSet extends Set {\n  union(...sets) {\n    return XSet.union(this, ...sets)\n  }\n\n  intersection(...sets) {\n    return XSet.intersection(this, ...sets)\n  }\n\n  difference(set) {\n    return XSet.difference(this, set)\n  }\n\n  symmetricDifference(set) {\n    return XSet.symmetricDifference(this, set)\n  }\n\n  cartesianProduct(set) {\n    return XSet.cartesianProduct(this, set)\n  }\n\n  powerSet() {\n    return XSet.powerSet(this)\n  }\n\n  // \u8FD4\u56DE\u4E24\u4E2A\u6216\u66F4\u591A\u96C6\u5408\u7684\u5E76\u96C6\n  // new Set([...setA, ...setB]);\n  static union(a, ...bSets) {\n    const unionSet = new XSet(a)\n\n    for (const b of bSets) {\n      for (const bValue of b)\n        unionSet.add(bValue)\n    }\n\n    return unionSet\n  }\n\n  // \u8FD4\u56DE\u4E24\u4E2A\u6216\u66F4\u591A\u96C6\u5408\u7684\u4EA4\u96C6\n  // new Set([...setA].filter(x => setB.has(x)))\n  static intersection(a, ...bSets) {\n    const intersectionSet = new XSet(a)\n\n    for (const aValue of intersectionSet) {\n      for (const b of bSets) {\n        if (!b.has(aValue))\n          intersectionSet.delete(aValue)\n      }\n    }\n\n    return intersectionSet\n  }\n\n  // \u8FD4\u56DE\u4E24\u4E2A\u96C6\u5408\u7684\u5DEE\u96C6\n  // new Set([...setA].filter(x => !setB.has(x)))\n  static difference(a, b) {\n    const differenceSet = new XSet(a)\n\n    for (const bValue of b) {\n      if (a.has(bValue))\n        differenceSet.delete(bValue)\n    }\n\n    return differenceSet\n  }\n\n  // \u8FD4\u56DE\u4E24\u4E2A\u96C6\u5408\u7684\u5BF9\u79F0\u5DEE\u96C6\n  static symmetricDifference(a, b) {\n    // \u6309\u7167\u5B9A\u4E49, \u5BF9\u79F0\u5DEE\u96C6\u53EF\u4EE5\u8868\u8FBE\u4E3A:\n    return a.union(b).difference(a.intersection(b))\n  }\n\n  // \u8FD4\u56DE\u4E24\u4E2A\u96C6\u5408 (\u6570\u7EC4\u5BF9\u5F62\u5F0F) \u7684\u7B1B\u5361\u513F\u79EF\n  // \u5FC5\u987B\u8FD4\u56DE\u6570\u7EC4\u96C6\u5408, \u56E0\u4E3A\u7B1B\u5361\u513F\u79EF\u53EF\u80FD\u5305\u542B\u76F8\u540C\u503C\u7684\u5BF9\n  static cartesianProduct(a, b) {\n    const cartesianProductSet = new XSet()\n\n    for (const aValue of a) {\n      for (const bValue of b)\n        cartesianProductSet.add([aValue, bValue])\n    }\n\n    return cartesianProductSet\n  }\n\n  // \u8FD4\u56DE\u4E00\u4E2A\u96C6\u5408\u7684\u5E42\u96C6\n  static powerSet(a) {\n    const powerSet = new XSet().add(new XSet())\n\n    for (const aValue of a) {\n      for (const set of new XSet(powerSet))\n        powerSet.add(new XSet(set).add(aValue))\n    }\n\n    return powerSet\n  }\n}\n"})}),"\n",(0,s.jsx)(n.h2,{id:"weakmap-and-weakset",children:"WeakMap and WeakSet"}),"\n",(0,s.jsxs)(n.p,{children:["WeakMap \u7ED3\u6784\u4E0E Map \u7ED3\u6784\u57FA\u672C\u7C7B\u4F3C,\n\u552F\u4E00\u7684\u533A\u522B\u5C31\u662F WeakMap \u53EA\u63A5\u53D7",(0,s.jsx)(n.strong,{children:"\u975E null \u5BF9\u8C61"}),"\u4F5C\u4E3A\u952E\u540D:"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:["\u5F31\u952E: \u952E\u540D\u6784\u5EFA\u7684\u5F15\u7528",(0,s.jsx)(n.strong,{children:"\u65E0\u6CD5\u963B\u6B62\u5BF9\u8C61\u6267\u884C\u5783\u573E\u56DE\u6536"}),"."]}),"\n",(0,s.jsxs)(n.li,{children:["\u4E0D\u53EF\u8FED\u4EE3\u952E: \u952E/\u503C\u968F\u65F6\u53EF\u80FD\u88AB\u5783\u573E\u56DE\u6536, \u65E0\u9700\u63D0\u4F9B\u8FED\u4EE3\u80FD\u529B, \u65E0 ",(0,s.jsx)(n.code,{children:"clear()"})," \u65B9\u6CD5."]}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5B83\u7684\u952E\u6240\u5BF9\u5E94\u7684\u5BF9\u8C61\u53EF\u80FD\u4F1A\u5728\u5C06\u6765\u6D88\u5931.\n\u4E00\u4E2A\u5BF9\u5E94 DOM \u5143\u7D20\u7684 WeakMap \u7ED3\u6784,\n\u5F53\u67D0\u4E2A DOM \u5143\u7D20\u88AB\u6E05\u9664,\n\u5176\u6240\u5BF9\u5E94\u7684 WeakMap \u8BB0\u5F55\u5C31\u4F1A\u81EA\u52A8\u88AB\u79FB\u9664."}),"\n",(0,s.jsxs)(n.p,{children:["\u6709\u65F6\u5019\u6211\u4EEC\u4F1A\u628A\u5BF9\u8C61\u4F5C\u4E3A\u4E00\u4E2A\u5BF9\u8C61\u7684\u952E\u7528\u6765\u5B58\u653E\u5C5E\u6027\u503C,\n\u666E\u901A\u96C6\u5408\u7C7B\u578B\u6BD4\u5982\u7B80\u5355\u5BF9\u8C61 (Object/Map/Set) \u4F1A\u963B\u6B62\u5783\u573E\u56DE\u6536\u5668\u5BF9\u8FD9\u4E9B\u4F5C\u4E3A\u5C5E\u6027\u952E\u5B58\u5728\u7684\u5BF9\u8C61\u7684\u56DE\u6536,\n\u6709\u9020\u6210\u5185\u5B58\u6CC4\u6F0F\u7684\u5371\u9669,\nWeakMap/WeakSet \u5219\u66F4\u52A0",(0,s.jsx)(n.strong,{children:"\u5185\u5B58\u5B89\u5168"}),":"]}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Caching computed results."}),"\n",(0,s.jsx)(n.li,{children:"Managing listeners."}),"\n",(0,s.jsx)(n.li,{children:"Keeping private data."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"\u5F31\u5F15\u7528\u53EF\u4EE5\u7F13\u5B58\u8BA1\u7B97\u7ED3\u679C (\u65E0\u9700\u4FEE\u6539\u7F51\u7EDC\u5C42):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const CACHE = new WeakMap()\n\nasync function describe(transaction) {\n  const cached = CACHE.get(transaction)\n\n  if (cached) {\n    return cached\n  }\n\n  // Not cached, do all the work...\n\n  CACHE.set(transaction, description)\n  return description\n}\n"})}),"\n",(0,s.jsxs)(n.p,{children:["\u5F31\u5F15\u7528\u53EF\u4EE5",(0,s.jsx)(n.a,{href:"https://jlongster.com/subverting-control-weak-refs",children:"\u5B9E\u73B0\u63A7\u5236\u53CD\u8F6C"}),":"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"const CONVERTERS = new WeakMap()\n\nfunction getConverter(transaction) {\n  const converter\n    = CONVERTERS.get(transaction) || new CurrencyConversion(transaction, { options })\n  CONVERTERS.set(transaction, converter)\n  return converter\n}\n\nfunction describe(transaction) {\n  if (!getConverter(transaction).isReady()) {\n    // do something..\n  }\n\n  // Here converter only exists for the lifetime to the describe function call.\n  // When we store it in a weak map, it exists for the entire lifetime of the transaction class.\n  // That allows us to write code the assumes the same lifetime\n  // e.g. caching things, using instance equality.\n  const amount = getConverter(transaction).convert()\n}\n"})})]})}function h(e={}){let{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},30416(e,n,t){t.d(n,{R:()=>i,x:()=>c});var a=t(59471);let s={},r=a.createContext(s);function i(e){let n=a.useContext(r);return a.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:i(e.components),a.createElement(r.Provider,{value:n},e.children)}}}]);