"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["98182"],{77025(e,n,i){i.r(n),i.d(n,{metadata:()=>t,default:()=>h,frontMatter:()=>l,contentTitle:()=>d,toc:()=>c,assets:()=>o});var t=JSON.parse('{"id":"web/network/ip","title":"IP","description":"Protocol","source":"@site/content/web/network/ip.md","sourceDirName":"web/network","slug":"/web/network/ip","permalink":"/notes/web/network/ip","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/network/ip.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"Network","permalink":"/notes/tags/network"},{"inline":true,"label":"IP","permalink":"/notes/tags/ip"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":13,"frontMatter":{"sidebar_position":13,"tags":["Web","Network","IP"]},"sidebar":"tutorialSidebar","previous":{"title":"TLS","permalink":"/notes/web/network/tls"},"next":{"title":"Ethernet","permalink":"/notes/web/network/ethernet"}}'),r=i(62615),s=i(30416);let l={sidebar_position:13,tags:["Web","Network","IP"]},d="IP",o={},c=[{value:"Protocol",id:"protocol",level:2},{value:"Service Model",id:"service-model",level:2},{value:"Router",id:"router",level:2},{value:"IPv4",id:"ipv4",level:2},{value:"Packet Format",id:"packet-format",level:2},{value:"ICMP",id:"icmp",level:2}];function a(e){let n={admonition:"admonition",code:"code",h1:"h1",h2:"h2",header:"header",img:"img",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"ip",children:"IP"})}),"\n",(0,r.jsx)(n.h2,{id:"protocol",children:"Protocol"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"IP Header",src:i(61865).A+"",title:"IP Header",width:"625",height:"765"})}),"\n",(0,r.jsx)(n.h2,{id:"service-model",children:"Service Model"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Prevent packets looping forever(TTL/time to live field in header):\nif TTL gets decreased to zero, then drop this datagram."}),"\n",(0,r.jsx)(n.li,{children:"Limit fragment packets size(Packet ID, Flags, Fragment Offset)."}),"\n",(0,r.jsx)(n.li,{children:"Reduce changes of wrong destination(Checksum, Destination Address)."}),"\n",(0,r.jsxs)(n.li,{children:["\u64CD\u4F5C\u7CFB\u7EDF\u534F\u8BAE\u6808\u7684 IP \u6A21\u5757\u4F1A\u68C0\u67E5 IP \u62A5\u6587\u5934\u90E8:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u5224\u65AD\u672C\u673A\u662F\u5426\u4E3A\u63A5\u6536\u65B9."}),"\n",(0,r.jsx)(n.li,{children:"\u5224\u65AD\u7F51\u7EDC\u5305\u662F\u5426\u7ECF\u8FC7\u5206\u7247."}),"\n",(0,r.jsx)(n.li,{children:"\u5C06\u5305\u8F6C\u4EA4\u7ED9 TCP \u6A21\u5757\u6216 UDP \u6A21\u5757."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.admonition,{title:"IP Layer",type:"tip",children:(0,r.jsx)(n.p,{children:"IP \u672C\u8EAB\u4E0D\u8D1F\u8D23\u5305\u7684\u4F20\u8F93,\n\u800C\u662F\u59D4\u6258\u5404\u79CD\u901A\u4FE1\u6280\u672F\u5C06\u5305\u4F20\u8F93\u5230\u4E0B\u4E00\u4E2A\u8DEF\u7531\u5668 (\u7EAF\u7CB9\u8DEF\u7531\u5668).\n\u6781\u7B80\u7684 IP Layer \u8BBE\u8BA1,\n\u53EF\u4EE5\u6839\u636E\u9700\u8981\u7075\u6D3B\u8FD0\u7528\u5404\u79CD\u901A\u4FE1\u6280\u672F (\u4EE5\u592A\u7F51, \u65E0\u7EBF\u7F51 etc),\n\u4ECE\u800C\u6784\u5EFA\u51FA\u4E92\u8054\u7F51\u8FD9\u4E00\u89C4\u6A21\u5DE8\u5927\u7684\u7F51\u7EDC."})}),"\n",(0,r.jsx)(n.h2,{id:"router",children:"Router"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u8DEF\u7531\u5668\u7684\u5404\u4E2A\u7AEF\u53E3\u90FD\u5177\u6709 MAC \u5730\u5740\u548C IP \u5730\u5740."}),"\n",(0,r.jsx)(n.li,{children:"\u8DEF\u7531\u5668\u4F1A\u5FFD\u7565\u4E3B\u673A\u53F7, \u53EA\u5339\u914D\u7F51\u7EDC\u53F7.\n\u901A\u8FC7\u8DEF\u7531\u805A\u5408, \u51CF\u5C11\u8DEF\u7531\u8868\u8BB0\u5F55\u6570, \u5408\u5E76\u5B50\u7F51."}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"ipv4",children:"IPv4"}),"\n",(0,r.jsx)(n.p,{children:"Address structure:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["32 bits long: ",(0,r.jsx)(n.code,{children:"a.b.c.d"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Historical:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Class A: ",(0,r.jsx)(n.code,{children:"0-network(7 bits)-host(24 bits)"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Class B: ",(0,r.jsx)(n.code,{children:"10-network(14 bits)-host(16 bits)"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Class C: ",(0,r.jsx)(n.code,{children:"110-network(21 bits)-host(8 bits)"}),"."]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["Today:\n",(0,r.jsx)(n.code,{children:"171.64.0.0/16"})," means ",(0,r.jsx)(n.code,{children:"171.64.0.0"})," to ",(0,r.jsx)(n.code,{children:"171.64.255.255"}),",\n",(0,r.jsx)(n.code,{children:"A/24"})," describes ",(0,r.jsx)(n.code,{children:"256"})," addresses, ",(0,r.jsx)(n.code,{children:"A/20"})," describes ",(0,r.jsx)(n.code,{children:"4096"})," addresses."]}),"\n",(0,r.jsxs)(n.li,{children:["Longest prefix matching and netmask (",(0,r.jsx)(n.code,{children:"A/16"}),"):\ne.g. ",(0,r.jsx)(n.code,{children:"0.0.0.0/0"})," => matching all addresses."]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"packet-format",children:"Packet Format"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Network is big-endian."}),"\n",(0,r.jsxs)(n.li,{children:["In x86 processor, use ",(0,r.jsx)(n.code,{children:"htons()/ntohs()/htonl()/ntohl()"})," host:\nnetwork ",(0,r.jsx)(n.code,{children:"short"}),"/",(0,r.jsx)(n.code,{children:"long"})," helper function to transform format."]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-cpp",children:"#include <arpa/inet.h>\n\nuint16_t http_port = 80;\nuint16_t packet_port = ntohs(packet->port);\n\nif (packet_port == http_port) {\n    // OK\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"icmp",children:"ICMP"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Report error conditions back."}),"\n",(0,r.jsx)(n.li,{children:"Help diagnose problems."}),"\n",(0,r.jsx)(n.li,{children:"Site above IP:\nICMP \u62A5\u6587\u5305\u542B\u5728 IP \u6570\u636E\u62A5\u4E2D, \u5C5E\u4E8E IP \u7684\u4E00\u4E2A\u7528\u6237.\n\u4E00\u4E2A ICMP \u62A5\u6587\u5305\u62EC IP \u5934\u90E8 + ICMP \u5934\u90E8 + ICMP \u62A5\u6587.\nIP \u5934\u90E8\u7684 Protocol \u503C\u4E3A 1 \u8868\u793A\u8FD9\u662F\u4E00\u4E2A ICMP \u62A5\u6587."}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.img,{alt:"ICMP Header",src:i(53389).A+"",title:"ICMP Header",width:"756",height:"786"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"0 type 0 code: echo reply(by ping)"}),"\n",(0,r.jsx)(n.li,{children:"3 type 0 code: destination network unreachable"}),"\n",(0,r.jsx)(n.li,{children:"3 type 1 code: destination host unreachable"}),"\n",(0,r.jsx)(n.li,{children:"3 type 3 code: destination port unreachable"}),"\n",(0,r.jsx)(n.li,{children:"8 type 0 code: echo request(by ping)"}),"\n",(0,r.jsx)(n.li,{children:"11 type 0 code: TTL(time to live) Expired(by ping)"}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},53389(e,n,i){i.d(n,{A:()=>t});let t=i.p+"assets/images/icmp-header-405be01b3360384b4b9674700f54d76e.png"},61865(e,n,i){i.d(n,{A:()=>t});let t=i.p+"assets/images/ip-header-f3b1dddfa12eafc7b67fe8235db22b77.png"},30416(e,n,i){i.d(n,{R:()=>l,x:()=>d});var t=i(59471);let r={},s=t.createContext(r);function l(e){let n=t.useContext(s);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),t.createElement(s.Provider,{value:n},e.children)}}}]);