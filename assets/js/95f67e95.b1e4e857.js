"use strict";(self.webpackChunknotes=self.webpackChunknotes||[]).push([["69104"],{91996(e,n,s){s.r(n),s.d(n,{metadata:()=>t,default:()=>h,frontMatter:()=>r,contentTitle:()=>i,toc:()=>a,assets:()=>l});var t=JSON.parse('{"id":"web/javascript/websocket","title":"WebSocket","description":"\u901A\u4FE1\u529F\u80FD:","source":"@site/content/web/javascript/websocket.md","sourceDirName":"web/javascript","slug":"/web/javascript/websocket","permalink":"/notes/web/javascript/websocket","draft":false,"unlisted":false,"editUrl":"https://github.com/sabertazimi/notes/edit/main/content/web/javascript/websocket.md","tags":[{"inline":true,"label":"Web","permalink":"/notes/tags/web"},{"inline":true,"label":"JavaScript","permalink":"/notes/tags/java-script"},{"inline":true,"label":"ECMAScript","permalink":"/notes/tags/ecma-script"},{"inline":true,"label":"Network","permalink":"/notes/tags/network"},{"inline":true,"label":"WebSocket","permalink":"/notes/tags/web-socket"}],"version":"current","lastUpdatedBy":"Sabertaz","lastUpdatedAt":1769518084000,"sidebarPosition":51,"frontMatter":{"sidebar_position":51,"tags":["Web","JavaScript","ECMAScript","Network","WebSocket"]},"sidebar":"tutorialSidebar","previous":{"title":"Fetch","permalink":"/notes/web/javascript/fetch"},"next":{"title":"WebRTC","permalink":"/notes/web/javascript/webrtc"}}'),c=s(62615),o=s(30416);let r={sidebar_position:51,tags:["Web","JavaScript","ECMAScript","Network","WebSocket"]},i="WebSocket",l={},a=[{value:"Header",id:"header",level:2},{value:"Extension",id:"extension",level:2},{value:"HeartBeat",id:"heartbeat",level:2},{value:"Performance",id:"performance",level:2},{value:"References",id:"references",level:2}];function d(e){let n={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"websocket",children:"WebSocket"})}),"\n",(0,c.jsx)(n.p,{children:"\u901A\u4FE1\u529F\u80FD:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"data"}),":","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"string"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"ArrayBuffer"}),"."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"Blob"}),"."]}),"\n"]}),"\n"]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"readyState"}),":","\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"WebSocket.OPENING"}),": ",(0,c.jsx)(n.code,{children:"0"}),", \u8FDE\u63A5\u6B63\u5728\u5EFA\u7ACB."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"WebSocket.OPEN"}),": ",(0,c.jsx)(n.code,{children:"1"}),", \u8FDE\u63A5\u5DF2\u7ECF\u5EFA\u7ACB."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"WebSocket.CLOSING"}),": ",(0,c.jsx)(n.code,{children:"2"}),", \u8FDE\u63A5\u6B63\u5728\u5173\u95ED."]}),"\n",(0,c.jsxs)(n.li,{children:[(0,c.jsx)(n.code,{children:"WebSocket.CLOSE"}),": ",(0,c.jsx)(n.code,{children:"3"}),", \u8FDE\u63A5\u5DF2\u7ECF\u5173\u95ED."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-ts",children:"function WebSocketTest() {\n  if ('WebSocket' in window) {\n    alert('WebSocket is supported by your Browser!')\n    // Let us open a web socket\n    const ws = new WebSocket('ws://localhost:9998/echo')\n\n    ws.onopen = function () {\n      // WebSocket is connected, send data using send()\n      ws.send('Message to send')\n      alert('Message is sent...')\n    }\n\n    ws.onmessage = function (event) {\n      const receivedMessage = event.data\n      alert('Message is received...')\n    }\n\n    ws.onclose = function (event) {\n      // websocket is closed.\n      console.log(\n        `As clean? ${event.wasClean} Code=${event.code} Reason=${event.reason}`\n      )\n    }\n\n    ws.onerror = function () {\n      alert('Connection error.')\n    }\n  } else {\n    // The browser doesn't support WebSocket\n    alert('WebSocket NOT supported by your Browser!')\n  }\n}\n"})}),"\n",(0,c.jsx)(n.h2,{id:"header",children:"Header"}),"\n",(0,c.jsx)(n.p,{children:"Request Header:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"GET /chat HTTP/1.1\nHost: example.com\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Key: 16-byte, base64 encoded\nSec-WebSocket-Version: 13\nSec-Websocket-Protocol: protocol [,protocol]*\nSec-Websocket-Extension: extension [,extension]*\n"})}),"\n",(0,c.jsx)(n.p,{children:"Response Header:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'HTTP/1.1 101 "Switching Protocols" or other description\nUpgrade: websocket\nConnection: Upgrade\nSec-WebSocket-Accept: 20-byte, MD5 hash in base64\nSec-Websocket-Protocol: protocol [,protocol]*\nSec-Websocket-Extension: extension [,extension]*\n'})}),"\n",(0,c.jsx)(n.h2,{id:"extension",children:"Extension"}),"\n",(0,c.jsx)(n.p,{children:"WebSocket \u5B58\u5728\u4E0E HTTP/1.1 \u7C7B\u4F3C\u7684\u6027\u80FD\u74F6\u9888: \u961F\u5934\u963B\u585E, \u65E0\u6CD5\u591A\u8DEF\u590D\u7528."}),"\n",(0,c.jsx)(n.p,{children:"WebSocket \u89C4\u8303\u5141\u8BB8\u5BF9\u534F\u8BAE\u8FDB\u884C\u6269\u5C55,\n\u6570\u636E\u683C\u5F0F\u548C WebSocket \u534F\u8BAE\u7684\u8BED\u4E49\u53EF\u4EE5\u901A\u8FC7\u65B0\u7684\u64CD\u4F5C\u7801\u548C\u6570\u636E\u5B57\u6BB5\u6269\u5C55:"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsxs)(n.li,{children:["\u591A\u8DEF\u590D\u7528\u6269\u5C55 (WebSocket Multiplexing Extension):\n\u4F7F\u7528",(0,c.jsx)(n.code,{children:"\u4FE1\u9053 ID"}),"\u6269\u5C55\u6BCF\u4E2A WebSocket \u5E27, \u5B9E\u73B0\u591A\u4E2A\u865A\u62DF\u7684 WebSocket \u4FE1\u9053\u5171\u4EAB\u4E00\u4E2A TCP \u8FDE\u63A5."]}),"\n",(0,c.jsx)(n.li,{children:"\u538B\u7F29\u6269\u5C55 (WebSocket Compression Extension):\n\u7ED9 WebSocket \u534F\u8BAE\u589E\u52A0\u4E86\u538B\u7F29\u529F\u80FD."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"heartbeat",children:"HeartBeat"}),"\n",(0,c.jsx)(n.p,{children:"\u8FDE\u63A5\u7EC8\u6B62\u65F6, WebSocket \u4E0D\u4F1A\u81EA\u52A8\u6062\u590D,\n\u9700\u8981\u81EA\u5DF1\u5B9E\u73B0, \u901A\u5E38\u4E3A\u4E86\u4FDD\u6301\u8FDE\u63A5\u72B6\u6001, \u9700\u8981\u589E\u52A0\u5FC3\u8DF3\u673A\u5236."}),"\n",(0,c.jsxs)(n.p,{children:["\u6BCF\u9694\u4E00\u6BB5\u65F6\u95F4\u4F1A\u5411\u670D\u52A1\u5668\u53D1\u9001\u4E00\u4E2A\u6570\u636E\u5305, \u544A\u8BC9\u670D\u52A1\u5668\u81EA\u5DF1 Alive,\n\u670D\u52A1\u5668\u7AEF\u5982\u679C Alive, \u5C31\u4F1A\u56DE\u4F20\u4E00\u4E2A\u6570\u636E\u5305\u7ED9\u5BA2\u6237\u7AEF.\n\u4E3B\u8981\u5728\u4E00\u4E9B",(0,c.jsx)(n.strong,{children:"\u957F\u65F6\u95F4\u8FDE\u63A5"}),"\u7684\u5E94\u7528\u573A\u666F\u9700\u8981\u8003\u8651\u5FC3\u8DF3\u673A\u5236\u53CA\u91CD\u8FDE\u673A\u5236,\n\u4EE5\u4FDD\u8BC1\u957F\u65F6\u95F4\u7684\u8FDE\u63A5\u53CA\u6570\u636E\u4EA4\u4E92."]}),"\n",(0,c.jsx)(n.h2,{id:"performance",children:"Performance"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"\u4F7F\u7528\u5B89\u5168 WebSocket (\u57FA\u4E8E TLS \u7684 WSS) \u5B9E\u73B0\u53EF\u9760\u7684\u90E8\u7F72, \u7ED5\u8FC7\u4E2D\u95F4\u4EE3\u7406."}),"\n",(0,c.jsx)(n.li,{children:"\u5BC6\u5207\u5173\u6CE8\u817B\u5B50\u811A\u672C\u7684\u6027\u80FD."}),"\n",(0,c.jsx)(n.li,{children:"\u5229\u7528\u5B50\u534F\u8BAE\u534F\u5546\u786E\u5B9A\u5E94\u7528\u534F\u8BAE."}),"\n",(0,c.jsx)(n.li,{children:"\u4F18\u5316\u4E8C\u8FDB\u5236\u51C0\u8377\u4EE5\u6700\u5C0F\u5316\u4F20\u8F93\u6570\u636E."}),"\n",(0,c.jsx)(n.li,{children:"\u8003\u8651\u538B\u7F29 UTF-8 \u5185\u5BB9\u4EE5\u6700\u5C0F\u5316\u4F20\u8F93\u6570\u636E."}),"\n",(0,c.jsx)(n.li,{children:"\u8BBE\u7F6E\u6B63\u786E\u7684\u4E8C\u8FDB\u5236\u7C7B\u578B\u4EE5\u63A5\u6536\u4E8C\u8FDB\u5236\u51C0\u8377."}),"\n",(0,c.jsx)(n.li,{children:"\u76D1\u63A7\u5BA2\u6237\u7AEF\u7F13\u51B2\u6570\u636E\u7684\u91CF."}),"\n",(0,c.jsx)(n.li,{children:"\u5207\u5206\u5E94\u7528\u6D88\u606F\u4EE5\u907F\u514D\u961F\u9996\u963B\u585E."}),"\n",(0,c.jsx)(n.li,{children:"\u5408\u7528\u7684\u60C5\u51B5\u4E0B\u5229\u7528\u5176\u4ED6\u4F20\u8F93\u673A\u5236."}),"\n",(0,c.jsx)(n.li,{children:"\u5BF9\u4E8E\u65E0\u7EBF\u8BBE\u5907, \u6CE8\u610F\u8282\u80FD:\n\u6D88\u9664\u5468\u671F\u6027\u65E0\u6548\u6570\u636E, \u51CF\u5C11\u5197\u4F59\u6570\u636E, \u6D88\u9664\u4E0D\u5FC5\u8981\u7684\u957F\u8FDE\u63A5."}),"\n"]}),"\n",(0,c.jsx)(n.h2,{id:"references",children:"References"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://hpbn.co/websocket",children:"WebSocket Guide"})}),"\n",(0,c.jsx)(n.li,{children:(0,c.jsx)(n.a,{href:"https://ably.com/blog/websockets-vs-long-polling",children:"WebSocket vs Long Polling"})}),"\n"]})]})}function h(e={}){let{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},30416(e,n,s){s.d(n,{R:()=>r,x:()=>i});var t=s(59471);let c={},o=t.createContext(c);function r(e){let n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);